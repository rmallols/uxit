/* Minified js files! 2013-11-05 */
function ErrorController($scope,$routeParams,i18nService){"use strict";$scope.errorTitle=i18nService($routeParams.title,$routeParams.targetId),$scope.showPortalHomeButton="true"===$routeParams.showPortalHomeButton,$scope.goToPortalHome=function(){location.href=$routeParams.portalId}}function LoginController($scope,$routeParams,globalMsgService){"use strict";$scope.error=$routeParams.error,$routeParams.error&&setTimeout(function(){globalMsgService.show("Invalid credentials"),$scope.$apply()},100)}function PortalController($scope,$routeParams,portalService,roleService,sessionService,userService,pageService,tagService,i18nService,availableAppsService,metaService){"use strict";$scope.isAdmin=function(){return roleService.hasAdminRole(sessionService.getUserSession())},userService.loadUsers(null),pageService.loadPages(null),roleService.loadRoles(null),tagService.loadTags(null),i18nService.loadLanguages(null),availableAppsService.loadAvailableApps(null),sessionService.loadUserSession(function(userSession){userSession&&userSession.language&&i18nService.changeLanguage(userSession.language)}),portalService.loadPortal($routeParams.page,function(){portalService.setHeader(),metaService.setWindowDimensions(),portalService.trackAnalytics()})}COMPONENTS.directive("login",["sessionService",function(sessionService){"use strict";return{restrict:"E",replace:!0,templateUrl:"login.html",scope:{},link:function(scope){scope.userSession=sessionService.getUserSession(),scope.logout=function(){sessionService.logout()}}}}]),COMPONENTS.directive("pages",["$rootScope","portalService","pageService","rowService","appService","roleService","sessionService","styleService",function($rootScope,portalService,pageService,rowService,appService,roleService,sessionService,styleService){"use strict";return{restrict:"E",replace:!0,templateUrl:"pages.html",link:function(scope){function isAppSortAndResizeAllowed(){return scope.isAdmin()&&!appService.isFullscreen()}$rootScope.$on("portalLoaded",function(){scope.portal=portalService.getPortal()}),scope.setPagesStyles=function(){return scope.portal?styleService.getNormalizedStyles(scope.portal.styles,null):null},scope.getCurrentUserAdminAccessStyleClass=function(){return roleService.getCurrentUserAdminAccessStyleClass()},scope.isAdmin=function(){return roleService.hasAdminRole(sessionService.getUserSession())},scope.isAppSortAllowed=function(){return isAppSortAndResizeAllowed()},scope.isAppResizeAllowed=function(){return isAppSortAndResizeAllowed()}}}}]),function(){"use strict";COMPONENTS.directive("addAppPanel",["$rootScope","availableAppsService","undeployService","constantsService","addAppService","statsService","keyboardService",function($rootScope,availableAppsService,undeployService,constantsService,addAppService,statsService,keyboardService){return{restrict:"E",transclude:!0,templateUrl:"addAppPanel.html",replace:!0,link:function(scope,element){function registerKeyboardEvents(){keyboardService.register(["tab","down"],directiveId,function(){activeAppId=activeAppId<scope.availableApps.model.length-1?activeAppId+1:0,scope.$apply()}),keyboardService.register(["shift+tab","up"],directiveId,function(){activeAppId=activeAppId>0?activeAppId-1:scope.availableApps.model.length-1,scope.$apply()}),keyboardService.register("enter",directiveId,function(){scope.showExpandedView(scope.availableApps.model[activeAppId])})}var activeAppId=0,collapsedState="collapsed",expandedState="expanded",directiveId="addAppPanel";scope.showExpandedView=function(availableApp){function getStats(){var filter={cond:{targetId:scope.highlight._id}};statsService.loadStats(constantsService.collections.comments,filter,function(stats){scope.highlight.stats=stats})}scope.onAddedComment=function(){getStats()},scope.highlight=availableApp,scope.highlight.collection=constantsService.collections.availableApps,element.attr("state",expandedState),getStats()},scope.hideExpandedView=function(){scope.highlight=null,element.attr("state",collapsedState)},scope.toggleExpandedView=function(availableApp){scope.highlight&&scope.highlight.id===availableApp.id?scope.hideExpandedView():scope.showExpandedView(availableApp)},scope.getBlockStyleClass=function(appId){return element.attr("state")===expandedState&&scope.highlight&&appId===scope.highlight.id?"highlight":""},scope.getAppClasses=function(appId){return appId===activeAppId?"hoverState":""},scope.undeploy=function(){undeployService.undeploy(scope.highlight),scope.hideExpandedView(),availableAppsService.loadAvailableApps(function(availableApps){scope.availableApps=availableApps})},scope.onAvailableAppDeployed=function(){availableAppsService.loadAvailableApps(function(availableApps){scope.availableApps=availableApps})},scope.collection=constantsService.collections.comments,scope.availableApps=availableAppsService.getAvailableApps(),scope.availableApps||$rootScope.$on("availableAppsLoaded",function(){scope.availableApps=availableAppsService.getAvailableApps()}),registerKeyboardEvents()}}}])}(),function(){"use strict";COMPONENTS.directive("adminPanel",["$rootScope","$location","portalService","addAppService","mediaService","sessionService","keyboardService","$timeout",function($rootScope,$location,portalService,addAppService,mediaService,sessionService,keyboardService,$timeout){return{restrict:"E",transclude:!0,templateUrl:"adminPanel.html",replace:!0,scope:{},link:function(scope,element){function toggle(tabIndex){tabIndex!==currentTabIndex?show(tabIndex):(hide(),inactiveTab())}function toggleAddAppPanel(){hide(),addAppService.toggleAddAppPanel(),addAppService.isAddAppPanelActive()?keyboardService.register("esc",directiveId,function(){addAppService.hideAddAppPanel(),inactiveTab(),scope.$apply()}):inactiveTab()}function show(tabIndex){currentTabIndex=tabIndex,element.removeClass("hide").addClass("show"),addAppService.isAddAppPanelActive()&&addAppService.hideAddAppPanel(),$location.search({}),registerKeyboardEvents()}function hide(){currentTabIndex=null,element.removeClass("show").addClass("hide"),unregisterKeyboardEvents()}function inactiveTab(){$timeout(function(){scope.activeTab=-1},0)}function registerKeyboardEvents(){keyboardService.register("ctrl+a",directiveId,function(){scope.activeTab=0,toggleAddAppPanel(),scope.$apply()}),keyboardService.register("ctrl+enter",directiveId,function(){scope.onSave(),scope.$apply()}),keyboardService.register("esc",directiveId,function(){scope.onCancel(),scope.$apply()})}function unregisterKeyboardEvents(){keyboardService.unregister("ctrl+a",directiveId),keyboardService.unregister("ctrl+enter",directiveId),keyboardService.unregister("esc",directiveId)}var currentTabIndex,ngStyleAvatarFn,directiveId="adminPanel",userSession=sessionService.getUserSession();ngStyleAvatarFn=function(){return userSession?{backgroundImage:'url("'+mediaService.getDownloadUrl(userSession.media)+'")'}:null},$rootScope.$on("portalLoaded",function(){scope.portal=portalService.getPortal()}),scope.panels=[{title:"adminPanel.addApp",description:"adminPanel.addApp.desc",type:"addApp",ngClass:"addIcon",onTabClicked:toggleAddAppPanel},{title:"adminPanel.settings",description:"adminPanel.settings.desc",type:"editGeneral",ngClass:"settingsIcon",onTabClicked:toggle},{title:"adminPanel.styles",description:"adminPanel.styles.desc",type:"editStyles",ngClass:"stylesIcon",onTabClicked:toggle},{title:"adminPanel.content",description:"adminPanel.content.desc",type:"editContentList",ngClass:"contentIcon hideEditedMark",onTabClicked:toggle},{title:"adminPanel.users",description:"adminPanel.users.desc",type:"editUserList",ngClass:"userIcon hideEditedMark",onTabClicked:toggle},{title:"adminPanel.media",description:"adminPanel.media.desc",type:"editMediaList",ngClass:"mediaIcon hideEditedMark",onTabClicked:toggle},{title:"adminPanel.pages",description:"adminPanel.pages.desc",type:"editPages",ngClass:"pageIcon",onTabClicked:toggle},{title:"tags",description:"adminPanel.tags.desc",type:"editTagList",ngClass:"tagsIcon hideEditedMark",onTabClicked:toggle},{title:"adminPanel.notifications",description:"adminPanel.notifications.desc",type:"editNotifications",ngClass:"notificationsIcon",onTabClicked:toggle},{title:"adminPanel.stats",description:"adminPanel.stats.desc",type:"stats",ngClass:"statsIcon",onTabClicked:toggle},{title:"adminPanel.you",description:"adminPanel.you.desc",type:"editCurrentUser",ngStyle:ngStyleAvatarFn,onTabClicked:toggle}],inactiveTab(),scope.onCancel=function(){hide(),inactiveTab()},scope.onSave=function(){portalService.updatePortal(function(){hide(),inactiveTab()})}}}}])}(),COMPONENTS.directive("createContent",["tagService",function(tagService){"use strict";return{restrict:"A",replace:!0,templateUrl:"editContent.html",scope:{content:"=model"},link:function(scope){scope.availableTags=tagService.getTags()}}}]),COMPONENTS.directive("createMedia",["tagService",function(tagService){"use strict";return{restrict:"A",replace:!0,templateUrl:"createMedia.html",scope:{media:"=model"},link:function(scope){scope.multipleFilesUploaded=!1,scope.media=[],scope.availableTags=tagService.getTags(),scope.onUpload=function(uploadedMedia){scope.multipleFilesUploaded=uploadedMedia.length>1,scope.media=uploadedMedia},scope.getMultipleFilesUploadedNames=function(){var multipleFilesUploadedNames="";return scope.multipleFilesUploaded&&scope.media.forEach(function(media){multipleFilesUploadedNames+=media.name+", "}),multipleFilesUploadedNames}}}}]),function(){"use strict";function createTag(){return{restrict:"A",replace:!1,templateUrl:"editTag.html",scope:{tag:"=model"}}}var createTagArgs=[createTag];COMPONENTS.directive("createTag",createTagArgs),COMPONENTS.directive("createTags",createTagArgs)}(),function(){"use strict";function createUser(mediaService,roleService,tagService,i18nService){return{restrict:"A",replace:!0,templateUrl:"editUser.html",scope:{user:"=model",onLayer:"="},link:function(scope){scope.availableTags=tagService.getTags(),scope.roles=roleService.getRoles(),scope.languages=i18nService.getLanguages(),scope.defaultAvatarUrl=mediaService.getDefaultAvatarUrl(),scope.languages=$.extend(!0,[],i18nService.getLanguages()),scope.languages.unshift({code:"",text:i18nService("editUser.language.inheritBrowser")}),scope.user={role:1,language:scope.languages[0].code,media:{}}}}}var createUserArgs=["mediaService","roleService","tagService","i18nService",createUser];COMPONENTS.directive("createUser",createUserArgs),COMPONENTS.directive("createUsers",createUserArgs)}(),function(){"use strict";COMPONENTS.directive("edit",["$rootScope","$compile","portalService","validationService","keyboardService","stringService",function($rootScope,$compile,portalService,validationService,keyboardService,stringService){return{restrict:"E",require:"ngModel",transclude:!0,templateUrl:"edit.html",replace:!0,scope:{model:"=ngModel",internalData:"=",panels:"=",activeTab:"=",limitLayerHeight:"@",onSave:"&",onChange:"&",onCancel:"&"},link:function(scope,element,attrs){function save(){var processedPanels=0;scope.panels.forEach(function(panel){panel.onLayer.save(function(){processedPanels+=1,processedPanels===scope.panels.length&&scope.onSave()})})}function setPristine(){formObjs.forEach(function(formObj){formObj.$dirty=!1,formObj.$pristine=!0})}function updateFormObjs(){scope.panels.forEach(function(panel){formObjs.push(scope[panel.type])})}function registerKeyboardEvents(){keyboardService.register("left",directiveId,function(){var newActiveTab=scope.activeTab>0?scope.activeTab-1:scope.panels.length-1;scope.clickTab(newActiveTab),scope.$apply()}),keyboardService.register("right",directiveId,function(){var newActiveTab=scope.activeTab<scope.panels.length-1?scope.activeTab+1:0;scope.clickTab(newActiveTab),scope.$apply()})}function setTempScrollingStyleClass(){var scrollingStyleClass="scrolling";element.addClass(scrollingStyleClass),setTimeout(function(){element.removeClass(scrollingStyleClass)},window.speed)}function createEditLayer(panel){var htmlElm,directiveElement;panel.onLayer={},panel.onLayer.save=function(callback){callback()},htmlElm=getEditLayerHtmlElm(panel,i),directiveElement=$compile(htmlElm)(scope),panel.active&&(scope.activePanel=panel),layersWrapper.append(directiveElement),i+=1}function getEditLayerHtmlElm(panel,index){var directiveName,htmlElm;return htmlElm=$('<div id="'+panel.type+scope.$id+'" model="model" internal-data="internalData" on-layer="panels['+index+'].onLayer" on-cancel="onCancel()" on-change="onChange()" ux-show="isLayerShown('+index+')" persist="true" ng-style="getLayerHeight()"config="panels['+index+'].config"></div>'),panel.appBridge?(directiveName="app-bridge",htmlElm.attr("src",panel.src),htmlElm.attr("view",panel.view)):directiveName=stringService.toSnakeCase(panel.type),htmlElm.attr(directiveName,""),htmlElm.wrap('<li class="layer" ng-form name="'+panel.type+'"></li>'),htmlElm.parent()}var directiveId="edit"+(attrs.type?"-"+attrs.type:""),i=0,pristineModel={},pristineInternalData={},formObjs=[],layersWrapper=$("> .content.level1 > ul",element);scope.showIfMultipleTabs=function(){return scope.panels.length>1},scope.getLayerHeight=function(){return scope.limitLayerHeight?{height:.5*$(window).height()}:null},scope.cancel=function(){$.extend(!0,scope.model,pristineModel),$.extend(!0,scope.internalData,pristineInternalData),scope.onCancel&&scope.onCancel(),updateFormObjs(),setPristine()},scope.save=function(){updateFormObjs(),validationService.isFormValid(formObjs)&&scope.onSave?(save(),$.extend(!0,pristineModel,scope.model),$.extend(!0,pristineInternalData,scope.internalData),setPristine()):validationService.setFocusOnFirstError(element)},scope.clickTab=function(tabIndex){scope.activeTab=tabIndex,scope.panels[tabIndex].onTabClicked&&scope.panels[tabIndex].onTabClicked(tabIndex),layersWrapper.css("margin-left","-"+100*tabIndex+"%"),setTempScrollingStyleClass()},scope.getTabClasses=function(panel,tabIndex){return tabIndex===scope.activeTab?"active "+panel.ngClass:panel.ngClass},scope.isLayerShown=function(tabIndex){return tabIndex===scope.activeTab},scope.isEditedMarkVisible=function(panelForm){return scope.activeTab>=0&&panelForm.$dirty},scope.getEditedMarkColor=function(panelForm){return panelForm.$valid?"valid":"invalid"},scope.$watch("model",function(newVal){newVal&&$.extend(!0,pristineModel,scope.model)}),scope.$watch("internalData",function(newVal){newVal&&$.extend(!0,pristineInternalData,scope.internalData)}),scope.$watch("panels",function(){scope.tabWidth=100/scope.panels.length,scope.panels[0].active=!0,angular.forEach(scope.panels,function(panel){createEditLayer(panel)})}),registerKeyboardEvents()}}}])}(),COMPONENTS.directive("editAppGeneral",["i18nService",function(i18nService){"use strict";return{restrict:"A",replace:!0,templateUrl:"editAppGeneral.html",scope:{model:"=",onLayer:"="},link:function(scope){scope.aligns=[{id:"left",text:i18nService("editApp.alignLeft")},{id:"center",text:i18nService("editApp.alignCenter")},{id:"right",text:i18nService("editApp.alignRight")}],scope.model.align||(scope.model.align=scope.aligns[0].id)}}}]),COMPONENTS.directive("editAppStyles",[function(){"use strict";return{restrict:"A",replace:!0,templateUrl:"editAppStyles.html",scope:{model:"=",onLayer:"="}}}]),function(){"use strict";COMPONENTS.directive("editBox",["editBoxUtilsService","keyboardService",function(editBoxUtilsService,keyboardService){return{restrict:"E",transclude:!0,templateUrl:"editBox.html",replace:!0,scope:{model:"=",internalData:"=",panels:"=",target:"=",arrowPos:"=",onSave:"&",onChange:"&",onCancel:"&",onClose:"&"},link:function(scope,element){function registerKeyboardEvents(){keyboardService.register("ctrl+enter",directiveId,function(){scope.save(),scope.$apply()}),keyboardService.register("esc",directiveId,function(){scope.cancel(),scope.$apply()})}var arrowPosOptions={top:"top",right:"right",bottom:"bottom",left:"left"},directiveId="editBox";scope.activeTab=0,scope.getStyles=function(){var topPos=scope.target.coordinates.top+scope.target.coordinates.height/2,leftPos=scope.arrowPos===arrowPosOptions.left?scope.target.coordinates.width+scope.target.coordinates.left:-(element.width()+scope.target.coordinates.width)+scope.target.coordinates.left;return{top:topPos,left:leftPos}},scope.change=function(){scope.onChange&&scope.onChange()},scope.save=function(){editBoxUtilsService.hideEditBox(scope.target.id),scope.onSave&&scope.onSave(scope.model,scope.$id),scope.onClose&&scope.onClose()},scope.cancel=function(){editBoxUtilsService.hideEditBox(scope.target.id),scope.onCancel&&scope.onCancel(),scope.onClose&&scope.onClose()},registerKeyboardEvents()}}}])}(),COMPONENTS.directive("editContent",["contentService","tagService",function(contentService,tagService){"use strict";return{restrict:"A",replace:!1,templateUrl:"editContent.html",scope:{content:"=model",onLayer:"="},link:function(scope){scope.availableTags=tagService.getTags(),scope.onLayer.save=function(callback){contentService.updateContent(scope.content,function(){callback()})}}}}]),COMPONENTS.directive("editContentList",[function(){"use strict";return{restrict:"A",replace:!1,templateUrl:"editContentList.html",scope:{},controller:["$scope",function($scope){$scope.config={editable:!0,selectable:!0,multiSelectable:!0,deletable:!0,creatable:!0}}]}}]),COMPONENTS.directive("editCurrentUser",["$rootScope","userService","sessionService",function($rootScope,userService,sessionService){"use strict";return{restrict:"A",replace:!1,templateUrl:"editCurrentUser.html",scope:{model:"=",onLayer:"="},link:function(scope){scope.userSession=sessionService.getUserSession(),scope.onLayer.save=function(callback){userService.updateUser(scope.userSession,function(){callback()})},scope.logout=function(){sessionService.logout()}}}}]),function(COMPONENTS){"use strict";COMPONENTS.directive("editGeneral",["portalService","mediaService","metaService",function(portalService,mediaService,metaService){return{restrict:"A",replace:!0,templateUrl:"editGeneral.html",scope:{model:"="},link:function(scope){scope.$watch("model.title",function(){portalService.setHeader()}),scope.level2Tabs=[{title:"editGeneral.general",styleClass:"settingsIcon"},{title:"editGeneral.app",styleClass:"appIcon"},{title:"editGeneral.comments",styleClass:"commentsIcon"},{title:"editGeneral.email",styleClass:"notificationsIcon"},{title:"editGeneral.analytics",styleClass:"statsIcon"}],scope.defaultFaviconUrl=metaService.getDefaultFaviconUrl(),mediaService.getMedia(scope.model.faviconId,null,function(favicon){scope.favicon=favicon}),scope.updateFavicon=function(newFavicon){scope.model.faviconId=newFavicon[0]._id}}}}])}(window.COMPONENTS),COMPONENTS.directive("editMedia",["mediaService","tagService",function(mediaService,tagService){"use strict";return{restrict:"A",replace:!0,templateUrl:"editMedia.html",scope:{media:"=model",onLayer:"="},link:function(scope){scope.availableTags=tagService.getTags(),scope.onLayer.save=function(callback){mediaService.updateMedia(scope.media,function(){callback()})},scope.onUpload=function(uploadedMedia){scope.media.name="",setTimeout(function(){scope.media.name=uploadedMedia[0].name,scope.$apply()},0)}}}}]),COMPONENTS.directive("editMediaList",[function(){"use strict";return{restrict:"A",replace:!1,templateUrl:"editMediaList.html",scope:{},controller:["$scope",function($scope){$scope.config={editable:!0,selectable:!0,multiSelectable:!0,uploadable:!0,deletable:!0,creatable:!0}}]}}]),function(COMPONENTS){"use strict";COMPONENTS.directive("editNotifications",["emailService","stdService","userService","liveMessageService",function(emailService,stdService,userService,liveMessageService){return{restrict:"A",replace:!0,templateUrl:"editNotifications.html",scope:{model:"=",onLayer:"="},link:function(scope){function sendEmail(callback){if(scope.model.notifications.email&&scope.model.notifications.email.subject&&scope.model.notifications.email.text&&scope.model.notifications.email.selectedUsers.length>0){var data={subject:scope.model.notifications.email.subject,text:scope.model.notifications.email.text,to:scope.model.notifications.email.selectedUsers.join(",")};emailService.sendEmail(data,function(result){result?callback():stdService.error("There was an error sending the e-mail")})}callback()}function sendLiveMessage(callback){if(scope.model.notifications.liveMessage&&scope.model.notifications.liveMessage.subject&&scope.model.notifications.liveMessage.text){var data={text:scope.model.notifications.liveMessage.subject,details:scope.model.notifications.liveMessage.text};liveMessageService.sendPublicMessage(data,function(result){result?callback():stdService.error("There was an error sending the live message")})}callback()}scope.usersList=userService.getUsers(),scope.level2Tabs=[{title:"editNotifications.email",styleClass:"notificationsIcon"},{title:"editNotifications.liveMessage",styleClass:"infoIcon"}],scope.onLayer.save=function(callback){sendEmail(function(){sendLiveMessage(function(){scope.model.notifications={},callback()})})}}}}])}(window.COMPONENTS),function(COMPONENTS){"use strict";COMPONENTS.directive("editPages",["$rootScope","$routeParams","$location","portalService","pageService","validationService","$timeout","stringService","timerService","stdService","arrayService","constantsService","i18nService","i18nDbService",function($rootScope,$routeParams,$location,portalService,pageService,validationService,$timeout,stringService,timerService,stdService,arrayService,constantsService,i18nService,i18nDbService){return{restrict:"A",replace:!0,templateUrl:"editPages.html",scope:{onLayer:"="},link:function(scope){function getCurrentPageIndex(){var i,currentPage=pageService.getCurrentPage();for(i=0;i<scope.pages.length&&scope.pages[i]._id!==currentPage._id;i+=1);return i}function savePages(callback){function registerAndFinish(){processedPages+=1,processedPages===scope.pages.length&&callback()}function saveCallback(page){saveItems(page),registerAndFinish()}function createPage(data,page){delete data.added,pageService.createPage(data,function(){saveCallback(page)})}function deletePage(data,page){delete data.deleted,pageService.deletePage(page._id,function(){saveCallback(page)})}function updatePage(data,page){delete data.updated,pageService.updatePage(page._id,data,function(){saveCallback(page)})}function saveItems(parentItem){var items=parentItem?parentItem.items:scope.items;items.forEach(function(page){var data=$.extend(!0,{},page);data.parentPageId=parentItem?parentItem._id:null,delete data.areSubItemsHidden,delete data._id,delete data.items,data.added?createPage(data,page):data.deleted?deletePage(data,page):data.updated?updatePage(data,page):saveCallback(page)})}var processedPages=0;saveItems(null)}scope.updateSelectedPageUrl=function(){var url;scope.selectedPage&&(url=stringService.replaceToken(i18nDbService.getI18nProperty(scope.selectedPage.text).text," ","-"),scope.selectedPage.url=stringService.toCamelCase(url)),scope.registerSelectedPageChange()},scope.registerSelectedPageChange=function(){scope.selectedPage&&(scope.selectedPage.updated=!0)},scope.onAddPage=function($page){$page.type=scope.pageTypes[0].id,$timeout(function(){scope.updateSelectedPageUrl()},0)},scope.onLayer.save=function(callback){savePages(function(){var currentPageIndex=getCurrentPageIndex();$location.path($routeParams.portal+"/"+scope.pages[currentPageIndex].url),callback()})},scope.pageTypes=[{id:constantsService.pageTypes.apps,text:constantsService.pageTypes.apps},{id:constantsService.pageTypes.externalLink,text:constantsService.pageTypes.externalLink}],scope.targets=[{id:"_blank",text:i18nService("editPages.target.newTab")},{id:"_self",text:i18nService("editPages.target.sameTab")}],scope.level2Tabs=[{title:"General"},{title:"Section 2"},{title:"Section 3"}]}}}])}(window.COMPONENTS),COMPONENTS.directive("editStyles",[function(){"use strict";return{restrict:"A",replace:!0,templateUrl:"editStyles.html",scope:{model:"=",onLayer:"="},link:function(scope){scope.level2Tabs=[{title:"editStyles.portal",styleClass:"webIcon"},{title:"editStyles.app",styleClass:"appIcon"}]}}}]),COMPONENTS.directive("editTag",["tagService",function(tagService){"use strict";return{restrict:"A",replace:!1,templateUrl:"editTag.html",scope:{tag:"=model",onLayer:"="},link:function(scope){scope.onLayer.save=function(callback){tagService.updateTag(scope.tag,function(){callback()})}}}}]),COMPONENTS.directive("editTagList",[function(){"use strict";return{restrict:"A",replace:!1,templateUrl:"editTagList.html",scope:{},controller:["$scope",function($scope){$scope.config={editable:!0,selectable:!0,multiSelectable:!0,deletable:!0,creatable:!0}}]}}]),COMPONENTS.directive("editUser",["$routeParams","userService","mediaService","tagService","roleService","i18nService",function($routeParams,userService,mediaService,tagService,roleService,i18nService){"use strict";return{restrict:"A",replace:!1,templateUrl:"editUser.html",scope:{user:"=model",onLayer:"="},link:function(scope){scope.availableTags=tagService.getTags(),scope.roles=roleService.getRoles(),scope.languages=$.extend(!0,[],i18nService.getLanguages()),scope.languages.unshift({code:"",text:i18nService("editUser.language.inheritBrowser")}),scope.clickToChangePassword=!0,scope.defaultAvatarUrl=mediaService.getDefaultAvatarUrl(),scope.user&&(scope.user.media||(scope.user.media={})),scope.onLayer.save=function(callback){userService.updateUser(scope.user,function(result){callback(result)})}}}}]),COMPONENTS.directive("editUserList",[function(){"use strict";return{restrict:"A",replace:!1,templateUrl:"editUserList.html",scope:{},controller:["$scope",function($scope){$scope.config={editable:!0,selectable:!0,multiSelectable:!0,deletable:!0,creatable:!0}}]}}]),COMPONENTS.directive("stats",["$rootScope","statsService","roleService","constantsService",function($rootScope,statsService,roleService,constantsService){"use strict";return{restrict:"A",replace:!1,templateUrl:"stats.html",scope:{},link:function(scope){function normalizeTimeTmpDelete(stats){stats.forEach(function(stat){stat["create.date"]||(stat["create.date"]="2013-04-01T22:00:00.000Z")})}function normalizeUserData(stats){var normalizedData=[];return stats.forEach(function(stat){normalizedData.push({label:stat.create.author?stat.create.author.fullName:void 0,value:stat.count})}),normalizedData}function normalizeUsersPerRoleData(stats){var roleObj,normalizedData=[];return stats.forEach(function(stat){roleObj=roleService.getRole(stat.role),normalizedData.push({label:roleObj?roleObj.title:"undefined",value:stat.count})}),normalizedData}var filter;statsService.loadStats(constantsService.collections.content,{},function(stats){normalizeTimeTmpDelete(stats),scope.newsPerDay=stats}),statsService.loadStats(constantsService.collections.users,{},function(stats){normalizeTimeTmpDelete(stats),scope.usersPerDay=stats}),filter={groupBy:"create.authorId"},statsService.loadStats(constantsService.collections.content,filter,function(stats){scope.contentPerUser=normalizeUserData(stats)}),filter={groupBy:"role"},statsService.loadStats(constantsService.collections.users,filter,function(stats){scope.usersPerRole=normalizeUsersPerRoleData(stats)}),filter={groupBy:"create.authorId"},statsService.loadStats(constantsService.collections.comments,filter,function(stats){scope.commentsPerUser=normalizeUserData(stats)})}}}]),COMPONENTS.directive("styles",[function(){"use strict";return{restrict:"A",replace:!0,templateUrl:"styles.html",scope:{model:"=styles"},link:function(){}}}]),COMPONENTS.directive("verticalTabs",[function(){"use strict";return{restrict:"A",replace:!0,transclude:!0,template:'<ul class="tabs level2"><li class="button {{tab.styleClass}}" ng-repeat="tab in tabs" ng-class="isCurrentLayer($index)" ng-click="setCurrentLayer($index)"><label i18n="{{tab.title}}"></label></li></ul>',scope:{tabs:"=verticalTabs"},link:function(scope){scope.isCurrentLayer=function(layer){return layer===scope.activePanel?"active":null},scope.setCurrentLayer=function(tabIndex){scope.activePanel=tabIndex,$(".content.level2 > ul").css("top","-"+100*tabIndex+"%")},scope.activePanel=0}}}]),function(){"use strict";COMPONENTS.directive("app",["$rootScope","$compile","portalService","styleService","appService","availableAppsService","constantsService","stringService","roleService",function($rootScope,$compile,portalService,styleService,appService,availableAppsService,constantsService,stringService,roleService){return{restrict:"A",replace:!0,templateUrl:"app.html",scope:{_id:"=app",type:"=",model:"=",width:"=",templateApp:"@"},controller:["$scope",function($scope){$scope.view="view",$scope.internalData={},$scope.onEvent={}}],link:function(scope,element){function initModel(){var availableApps;availableApps=availableAppsService.getAvailableApps(),scope.appInfo=getModelFromIndex(availableApps,scope.type),!scope.model&&scope.appInfo&&(scope.model=scope.appInfo.defaultModel||{})}function getModelFromIndex(array,matcher){return array?array.model[array.index[matcher]]:null}var hasWidthChanged=!1;element.addClass(scope.type),scope.setAppStyles=function(){var portal=portalService.getPortal();if(scope.model&&portal){var styles=styleService.getNormalizedStyles(portal.app.styles,null);return styles=styleService.getNormalizedStyles(scope.model.styles,styles)}return null},scope.isTitleVisible=function(){var portal=portalService.getPortal();return scope.model&&void 0!==scope.model.showTitle?scope.model.showTitle:portal.app?portal.app.showTitle:!1},scope.removeApp=function(){element.hide("explode",{direction:"horizontal"},window.speed,function(){appService.isFullscreen()&&appService.disableFullscreen(element,scope.onEvent.resize),appService.deleteApp(element,scope.$parent.$index),$(this).remove()})},scope.getCurrentUserAdminAccessStyleClass=function(){return roleService.getCurrentUserAdminAccessStyleClass()},scope.$watch("type",function(newVal){newVal&&initModel()}),scope.$watch("width",function(newVal){newVal&&(hasWidthChanged?appService.triggerOnResizeEvent(scope.onEvent.resize):hasWidthChanged=!0)}),$rootScope.$on(constantsService.collections.availableApps+"Undeployed",function(event,type){type===scope.type&&scope.removeApp()}),element.mouseenter(function(){element.addClass("hover")}),element.mouseleave(function(){element.removeClass("hover")})}}}])}(),function(){"use strict";COMPONENTS.directive("appBridge",["$injector","$compile","$timeout","$templateCache","stringService",function($injector,$compile,$timeout,$templateCache,sS){return{restrict:"A",replace:!0,scope:{model:"=",internalData:"=",config:"=",onLayer:"=",onEvent:"=",src:"@",view:"@"},link:function(scope,element){function inheritParentScopeModel(){childScope.internalData=scope.internalData,childScope.model=scope.model,childScope.onLayer=scope.onLayer,childScope.src=scope.src,childScope.view=scope.view,childScope.onEvent=scope.onEvent}function executeServiceMethod(src,view){var appElm=compileTemplate(src,view);manageServiceFns(src,view,appElm)}function compileTemplate(src,view){var templateId=src+sS.capitalize(view)+".html",appElm=$($templateCache.get(templateId));return element.html(appElm),$compile(appElm)(childScope),appElm}function manageServiceFns(src,view,appElm){var appService=$injector.get(src+"Service");defineViewFn(appService,view,appElm),defineOnLayerSaveFn(appService,view),defineOnResizeFn(appService,appElm)}function defineOnLayerSaveFn(appService,view){var onSaveFn="on"+sS.capitalize(view)+"Save";childScope.onLayer&&childScope.onLayer.save&&appService[onSaveFn]&&(childScope.onLayer.save=function(callback){appService[onSaveFn](childScope,function(){callback()})})}function defineViewFn(appService,view,appElm){appService[view]&&appService[view](childScope,appElm)}function defineOnResizeFn(appService,appElm){childScope.onEvent&&(childScope.onEvent.resize=function(){var onResizeFn="onResize";appService[onResizeFn]&&appService[onResizeFn](childScope,appElm)})}var childScope=scope.$new(!0);$timeout(function(){inheritParentScopeModel(),childScope.src&&childScope.view&&executeServiceMethod(childScope.src,childScope.view)})}}}])}(),function(){"use strict";
COMPONENTS.directive("appHeader",["$rootScope","$location","appService","portalService","pageService","roleService","sessionService","stringService","editBoxUtilsService",function($rootScope,$location,appService,portalService,pageService,roleService,sessionService,stringService,editBoxUtilsService){return{restrict:"A",replace:!0,templateUrl:"appHeader.html",link:function(scope,element){function getEditPanels(){return scope.appInfo.editPanels?getCustomEditPanels():getDefaultEditPanels()}function getDefaultEditPanels(){var panels=[];return scope.appInfo.noCustomEditPanel||panels.push({title:"Edit",type:scope.type+"Edit",appBridge:!0,src:scope.type,view:"edit"}),panels.push({title:"Edit App",type:"editAppGeneral"},{title:"Styles setup",type:"editAppStyles"}),panels}function getCustomEditPanels(){var panelType,defaultEditPanels,panels=[];return scope.appInfo.editPanels.forEach(function(panel){panelType=scope.type+stringService.capitalize(panel.type),panels.push({title:panel.title,type:panelType,styleClass:panel.type,appBridge:!0,src:scope.type,view:panel.type})}),defaultEditPanels=getDefaultEditPanels(),defaultEditPanels.forEach(function(panel){panels.push(panel)}),panels}function enableFullscreen(){appService.enableFullscreen(appElm,scope._id,scope.width,scope.onEvent.resize)}function disableFullscreen(){appService.disableFullscreen(appElm,scope.onEvent.resize)}function manageFullscreenFromSearch(){Number($location.search()._id)===scope._id?enableFullscreen():$location.search()._id||disableFullscreen()}function toggleHeader(){$(".app").not(appElm).removeClass("enabledHeader"),appElm.toggleClass("enabledHeader")}function hideHeader(){appElm.removeClass("enabledHeader")}var appElm=element.parent(),userSession=sessionService.getUserSession();scope.showHeader=function(){return userSession},scope.showEditActions=function(){return userSession&&roleService.hasCreatorRole(userSession)},scope.showAdminActions=function(){return userSession&&roleService.hasAdminRole(userSession)},scope.toggleHeader=function(){toggleHeader()},scope.isAdmin=function(){return roleService.hasAdminRole(userSession)},scope.getAppHelpText=function(){if(scope.model&&scope.appInfo&&scope.appInfo.desc){var title="<h6>"+(scope.model.title||scope.appInfo.title)+" app</h6>",desc=scope.appInfo.desc;return title+desc}return null},scope.toggleFullscreen=function(){appService.isFullscreen()?disableFullscreen():enableFullscreen(),hideHeader()},scope.showEditTemplate=function(){var targetObj=$("> .header > .actions > .editIcon",element);scope.panels=getEditPanels(),scope.onSave=function(){scope.onLayer&&scope.onLayer.save&&scope.onLayer.save(),pageService.updateCurrentPage(null),portalService.updatePortal(null)},editBoxUtilsService.showEditBox(scope,targetObj,targetObj)},$rootScope.$on("onWindowResized",function(){appService.triggerOnResizeEvent(scope.onEvent.resize)}),scope.isTemplateFullscreen=portalService.isTemplateFullscreen(),$rootScope.$on("onPortalSaved",function(){scope.isTemplateFullscreen=portalService.isTemplateFullscreen()}),manageFullscreenFromSearch(),scope.$on("$routeUpdate",function(){manageFullscreenFromSearch()})}}}])}(),function(){COMPONENTS.directive("bannerCanvas",["$compile","timerService","arrayService","keyboardService","roleService","sessionService",function($compile,timerService,arrayService,keyboardService,roleService,sessionService){"use strict";return{restrict:"A",replace:!0,templateUrl:"bannerCanvas.html",scope:{model:"=ngModel",onChange:"&"},link:function(scope,element){function createGrid(){for(var colPos,rowPos,i=0;totalCols>i;i++)colPos=(i+1)*gridSize,gridElm.append('<div class="ruler col" style="top: 0; left: '+colPos+'px"></div>');for(var j=0;totalRows>j;j++)rowPos=(j+1)*gridSize,gridElm.append('<div class="ruler row" style="top: '+rowPos+'px; left: 0"></div>')}function createImage(){createItem("image","/client/images/logo.svg")}function createText(){createItem("text","Ouuuh Yeaaah!")}function createItem(type,value){var itemId=timerService.getRandomNumber(),itemSize=2*gridSize,topPos=Math.floor(Math.random()*totalRows-1)*gridSize,leftPos=Math.floor(Math.random()*totalCols-1)*gridSize;scope.items.index[itemId]=scope.items.data.length,scope.items.data.push({id:itemId,type:type,value:value,size:{width:itemSize,height:itemSize},position:{top:topPos>0?topPos:0,left:leftPos>0?leftPos:0}}),propagateChanges()}function registerKeyboardEvents(){keyboardService.register("del",directiveId,function(){deleteSelectedItems(),scope.$apply()})}function deleteSelectedItems(){$(".bannerItem.active").each(function(){var itemId=$(this).attr("id"),itemIndex=scope.items.index[itemId];delete scope.items.index[itemId],arrayService.delete(scope.items.data,itemIndex),updateIndexes()}),propagateChanges()}function updateIndexes(){angular.forEach(scope.items.data,function(item,$index){scope.items.index[item.id]=$index})}function propagateChanges(){scope.onChange&&scope.onChange()}var gridElm=$(" > .grid",element),directiveId="bannerCanvas",gridSize=50,totalCols=Math.floor(element.width()/gridSize),totalRows=Math.floor(element.height()/gridSize),userSession=sessionService.getUserSession(),isCreator=roleService.hasCreatorRole(userSession);createGrid(),registerKeyboardEvents(),scope.model||(scope.model=[]),scope.items={index:{},data:scope.model},scope.addImage=function(){createImage()},scope.addText=function(){createText()},scope.onItemChange=function(){propagateChanges()},scope.isReadOnly=function(){return!isCreator||element.attr("readonly")||element.attr("disabled")}}}}])}(),function(){COMPONENTS.directive("bannerItem",["$rootScope","$timeout","mediaService","editBoxUtilsService","domService",function($rootScope,$timeout,mediaService,editBoxUtilsService,domService){"use strict";return{restrict:"A",replace:!0,scope:{item:"=data",overflowVisible:"=",onItemChange:"&onChange",readOnly:"="},templateUrl:"bannerItem.html",link:function(scope,element){function defineListeners(){setDraggable(),setResizable(),element.click(onClickFn),inputElm.focus(onFocusFn),inputElm.blur(onBlurFn),scope.editItem=onEditItemFn}function setDraggable(){element.draggable({grid:[50,50],start:function(){select()},stop:function(){setModelCoordinatesFromDom(),propagateChanges()}})}function setResizable(){originalBoxSize=getBoxSize(),element.resizable({grid:50,handles:"ne, nw, se, sw",resize:function(){var newBoxSize=getBoxSize(),newFontSize=newBoxSize/originalBoxSize*100;element.css("font-size",newFontSize+"%")},stop:function(){setModelCoordinatesFromDom(),propagateChanges()}})}function onClickFn(){select()}function onFocusFn(){element.addClass("active")}function onBlurFn(){unselect()}function onEditItemFn(){keepItemSelected=!0;var defaultPanels=[{title:"Select media",type:"selectMedia",config:{editSize:!1}}];scope.internalData={},scope.panels=defaultPanels,scope.onChange=function(model,id,selectedMedia){scope.item.value=mediaService.getDownloadUrl(selectedMedia)},scope.onSave=function(){propagateChanges()},scope.onClose=function(){keepItemSelected=!1,unselect(),hideOverflow()},showOverflow(),editBoxUtilsService.showEditBox(scope,editButtonElm,editButtonElm)}function setDomCoordinatesFromModel(){element.css("width",scope.item.size.width-horizontalBorderWidth),element.css("height",scope.item.size.height-verticalBorderWidth),element.css("top",scope.item.position.top),element.css("left",scope.item.position.left)}function setModelCoordinatesFromDom(){scope.item.size.width=parseInt(element.css("width"),10)+horizontalBorderWidth,scope.item.size.height=parseInt(element.css("height"),10)+verticalBorderWidth,scope.item.position.top=parseInt(element.css("top"),10),scope.item.position.left=parseInt(element.css("left"),10),$rootScope.$$phase||scope.$apply()}function select(){inputElm.addClass("forceVisible"),inputElm.focus()}function unselect(){$timeout(function(){keepItemSelected||(element.removeClass("active"),inputElm.removeClass("forceVisible"),setModelCoordinatesFromDom())},150)}function getBoxSize(){return element.width()*element.height()}function showOverflow(){scope.overflowVisible=!0}function hideOverflow(){scope.overflowVisible=!1}function propagateChanges(){scope.onItemChange&&scope.onItemChange()}var originalBoxSize,inputElm=$(" > input.selectHandler",element),editButtonElm=$(" > button.edit",element),keepItemSelected=!1,borderWidth=domService.getObjBorderWidth(element),horizontalBorderWidth=borderWidth.left+borderWidth.right,verticalBorderWidth=borderWidth.top+borderWidth.bottom;setDomCoordinatesFromModel(),scope.readOnly||defineListeners()}}}])}(),COMPONENTS.directive("lineChart",["sessionService",function(sessionService){"use strict";return{restrict:"E",replace:!0,template:' <div class="lineChart chart" ng-style="getChartSize()" ng-show="data.length > 0"></div>',scope:{data:"="},link:function(scope,element){var elmWidth=element.width();scope.$watch("data",function(newVal,oldVal){sessionService.isUserLogged()&&newVal&&newVal!==oldVal&&(element.html(""),scope.data.length>0&&new Morris.Line({element:element,data:scope.data,xkey:"create.date",ykeys:["count"],labels:["count"],lineColors:["#32b4e4"]}))},!0),scope.getChartSize=function(){return{width:elmWidth,height:.45*elmWidth}}}}}]),COMPONENTS.directive("pieChart",["sessionService",function(sessionService){"use strict";return{restrict:"E",replace:!0,template:' <div class="pieChart chart" ng-style="getChartSize()" ng-show="data.length > 0"></div>',scope:{data:"="},link:function(scope,element){var elmWidth=element.width();scope.$watch("data",function(newVal,oldVal){sessionService.isUserLogged()&&newVal&&newVal!==oldVal&&(element.html(""),scope.data.length>0&&new Morris.Donut({element:element,data:scope.data}))},!0),scope.getChartSize=function(){var boxSize=.6*elmWidth,marginLeft=(elmWidth-boxSize)/2;return{width:boxSize,height:boxSize,marginLeft:marginLeft}}}}}]),function(){"use strict";COMPONENTS.directive("comment",["$compile","portalService","dateService","objectService","mediaService","commentsService","constantsService","tooltipService","sessionService",function($compile,portalService,dateService,objectService,mediaService,commentsService,constantsService,tooltipService,sessionService){return{restrict:"A",replace:!0,scope:{comment:"="},templateUrl:"comment.html",link:function(scope,element){function deleteComment(comment){commentsService.deleteComment(comment._id,function(){comment.deleted=!0})}function deleteCommentRecursively(comment){comment.comments&&comment.comments.length&&comment.comments.forEach(function(comment){deleteCommentRecursively(comment)}),deleteComment(comment)}function isSelfActionAllowed(){return scope.isLoggedUser&&scope.comment.create.author._id===sessionService.getUserSession()._id}var repliesHtml='<comments target-id="comment._id" parent-comment="comment" hide-add="hideAdd" placeholder="comments.addReply.placeholder"></comments>';$(".repliesWrapper",element).replaceWith($compile(repliesHtml)(scope)),scope.hideAdd=!0,scope.comment.isEditable=!1,scope.isLoggedUser=sessionService.isUserLogged(),scope.isSelfActionAllowed=isSelfActionAllowed(),scope.getDownloadUrl=function(media){return media?mediaService.getDownloadUrl(media):!1},scope.getFormattedDate=function(){return dateService.getFormattedDate(scope.comment.create.date)},scope.showRatings=function(){return objectService.isEmpty(scope.allowRatings)?portalService.getPortal().comments.allowRatings:scope.allowRatings},scope.toggleReply=function(){scope.hideAdd=scope.hideAdd!==!0},scope.toggleEdit=function(){scope.comment.isEditable=scope.comment.isEditable!==!0},scope.updateComment=function(){commentsService.updateComment(scope.comment._id,{text:scope.comment.text})},scope.deleteComment=function(){deleteCommentRecursively(scope.comment),tooltipService.hide()}}}}])}(),function(){"use strict";COMPONENTS.directive("comments",["commentsService","sessionService","mediaService",function(commentsService,sessionService,mediaService){return{restrict:"E",replace:!0,scope:{targetId:"=",onAdd:"=",allowRatings:"=",parentComment:"=",hideAdd:"=",placeholder:"@"},templateUrl:"comments.html",link:function(scope){scope.loggedUser=sessionService.isUserLogged(),scope.$watch("targetId",function(newVal){newVal&&commentsService.loadComments(scope.targetId,function(comments){scope.comments=comments.results,scope.parentComment&&(scope.parentComment.comments=scope.comments)})}),scope.createComment=function(){commentsService.createComment(scope.newCommentText,scope.targetId,function(newComment){scope.newCommentText="",sessionService.addSessionDataToModel(newComment),scope.comments.push(newComment),void 0!==scope.hideAdd&&(scope.hideAdd=!0),scope.onAdd&&scope.onAdd()})},scope.getUserAvatarUrl=function(){return sessionService.isUserLogged()?mediaService.getDownloadUrl(sessionService.getUserSession().media):!1}}}}])}(),function(){"use strict";COMPONENTS.directive("contentEditable",["caretService","roleService","sessionService","mediaService","contentEditableService","contentEditableRichContentService","contentEditableSelectMediaService",function(caretService,roleService,sessionService,mediaService,contentEditableService,contentEditableRichContentService,contentEditableSelectMediaService){return{priority:-1,require:"ngModel",scope:{contentEditable:"=",content:"=ngModel",customPanels:"=panels",options:"=",placeholder:"@",onBlur:"&",uxChange:"&"},replace:!0,templateUrl:"contentEditable.html",link:function(scope,element,attrs,ngModelCtrl){var cEDomObj=$(" > .editableArea > [contenteditable]",element),userSession=sessionService.getUserSession();scope.isCreator=function(){return roleService.hasCreatorRole(userSession)},scope.onKeyup=function(){contentEditableService.updateValue(scope,cEDomObj,ngModelCtrl),scope.showEditBox()},scope.isEditable=function(){var hasRights=void 0!==scope.contentEditable?scope.contentEditable:scope.isCreator();return hasRights&&!element.attr("readonly")&&!element.attr("disabled")},scope.$watch("content",function(){cEDomObj.is(":focus")||(cEDomObj.html(scope.content?scope.content:""),contentEditableService.compileElement(scope,$("a, img",cEDomObj))),contentEditableService.handlePlaceholder(scope)}),scope.showEditBox=function(){contentEditableRichContentService.showEditBox(scope,cEDomObj,ngModelCtrl)},scope.showEditBox2=function(sMDomObj){contentEditableSelectMediaService.showEditBox(scope,cEDomObj,sMDomObj,ngModelCtrl)},scope.onClose=function(){scope.showActions=!1},scope.$watch("newMedia",function(newVal){var imageId,imageObj,downloadUrl=mediaService.getDownloadUrl(newVal);newVal&&newVal._id&&(imageId=caretService.insertImage(downloadUrl,cEDomObj,"onMediaClick"),imageObj=$("#"+imageId,cEDomObj),contentEditableService.compileElement(scope,imageObj),contentEditableService.updateValue(scope,cEDomObj,ngModelCtrl))}),cEDomObj.focus(function(){scope.showActions=!0}),scope.onMediaClick=function(mediaId){var imageObj=$("#"+mediaId,cEDomObj);scope.showEditBox2(imageObj)},cEDomObj.blur(function(){contentEditableService.propagateChanges(scope)}),scope.options&&scope.options.allowMultiLine===!1&&cEDomObj.keypress(function(e){return 13!==e.which})}}}])}(),function(){COMPONENTS.directive("richContent",["pageService","constantsService","textSelectionService","stringService","i18nService",function(pageService,constantsService,textSelectionService,stringService,i18nService){"use strict";return{restrict:"A",replace:!0,templateUrl:"richContent.html",scope:{model:"=",config:"=",onChange:"&"},link:function(scope){function getSelectedHeading(){var headingId=textSelectionService.getSelectedHeadingId();headingId&&(scope.heading=headingId)}function getSelectedLink(){var linkId=textSelectionService.getSelectedLinkId();stringService.isExternalUrl(linkId)?(scope.externalLink=linkId,scope.linkType=scope.linkTypes[1].id):(scope.internalLink=linkId,scope.linkType=scope.linkTypes[0].id)}function setLink(link,target){link&&textSelectionService.setLink({id:link,href:link,title:'<a href="'+link+'" target="'+target+'">'+link+"</a>",target:target})}function setHeading(heading){textSelectionService.setHeading(heading)}function setHeadingOptions(){scope.headingOptions=[{value:"normal",text:"Normal"},{value:"heading1",text:"Heading 1"},{value:"heading2",text:"Heading 2"},{value:"heading3",text:"Heading 3"}]}function getPagesList(){scope.pagesList=pageService.getPages()}scope.linkTypes=[{id:"internal",text:i18nService("richContent.link.internal")},{id:"external",text:i18nService("richContent.link.external")}],scope.propagateChanges=function(){scope.onChange&&scope.onChange()},scope.setHeading=function(){setHeading(scope.heading)},scope.setInternalLink=function(){setLink(scope.internalLink,"_self")},scope.setExternalLink=function(){setLink(stringService.normalizeExternalUrl(scope.externalLink),"_blank")},setHeadingOptions(),getSelectedHeading(),getSelectedLink(),getPagesList()}}}])}(),function(){COMPONENTS.directive("selectMedia",["i18nService",function(i18nService){"use strict";return{restrict:"A",replace:!0,templateUrl:"selectMedia.html",scope:{internalData:"=",config:"=",onChange:"="},link:function(scope){scope.internalData.mediaSizes=[{id:"original",text:i18nService("selectMedia.size.original")},{id:"small",text:i18nService("selectMedia.size.small")},{id:"medium",text:i18nService("selectMedia.size.medium")},{id:"big",text:i18nService("selectMedia.size.big")}],scope.propagateChanges=function(media){scope.onChange&&scope.onChange(media)},scope.onMediaChange=function(media){scope.propagateChanges(media)}}}}])}(),function(){COMPONENTS.directive("toggleStyle",["$timeout",function($timeout){"use strict";return{restrict:"A",replace:!0,template:'<button ng-click="toggleState()" ng-class="{active:isActive()}" on-change="onChange($data)"></button>',scope:{model:"=ngModel",onChange:"&"},link:function(scope,element,attrs){scope.toggleState=function(){scope.model=scope.isActive()?attrs.inactiveWhen||"":attrs.activeWhen,$timeout(function(){scope.onChange&&scope.onChange()},0)},scope.isActive=function(){return scope.model===attrs.activeWhen}}}}])}(),COMPONENTS.directive("globalMsg",["globalMsgService","domService",function(globalMsgService,domService){"use strict";return{restrict:"A",replace:!0,scope:{},template:'<div id="globalMsg" ng-class="getActiveStyleClass()"><div class="text"><label>{{globalMsg.text}}</label> <a href="#" ng-show="globalMsg.details" ng-click="toggleDetails()">[Details]</a><div class="details" ng-show="isDetailsVisible"><label>{{globalMsg.details}}</label></div></div><div class="actions"><button class="removeIcon" ng-click="hide()"></button></div></div>',link:function(scope){globalMsgService.onShow(function(text,details){scope.globalMsg||(scope.globalMsg={text:text,details:details},domService.removeLoadingFeedback($("body")))}),globalMsgService.onHide(function(){delete scope.globalMsg}),scope.isDetailsVisible=!1,scope.hide=function(){globalMsgService.hide()},scope.getActiveStyleClass=function(){return scope.globalMsg?"active":""},scope.toggleDetails=function(){scope.isDetailsVisible=scope.isDetailsVisible===!1}}}}]),function(){"use strict";COMPONENTS.directive("backupTitle",["$rootScope","$compile",function($rootScope,$compile){return{restrict:"A",compile:function(tElement,tAttrs){return tElement.attr("title",tAttrs.backupTitle),tElement.removeAttr("backup-title"),function(scope,element){element.data("backup-title",!0),$compile(element)(scope)}}}}]),COMPONENTS.directive("title",["$rootScope","$compile","tooltipService",function($rootScope,$compile,tooltipService){return{restrict:"A",priority:-1,compile:function(){return function(scope,element,attrs){function initialize(title,customOptions,isHtml){var options={fadeInTime:0,fadeOutTime:0,smartPlacement:!0,mouseOnToPopup:!0};angular.extend(options,customOptions),tooltipService.initialize(element,title,options,isHtml)}function showConfirmMessage(){var labelHtml='<label i18n="'+(attrs.confirmText||"areYouSure")+'"></label>',ngClickFn="executeConfirmAction('"+attrs.confirmAction+"')",buttonHtml='<button class="okIcon" ng-click="'+ngClickFn+'"></button>',messageHtml='<div class="confirmText">'+labelHtml+buttonHtml+"</div>",messageObj=$compile($(messageHtml))(scope),customOptions={manual:!0};scope.$apply(),tooltipService.hide(),initialize(messageObj,customOptions,!0),tooltipService.show(element),isDialog=!0}var isDialog=!1;element.data("backup-title")&&element.attr("backup-title",attrs.title),scope.executeConfirmAction=function(actionToExecute){scope.$eval(actionToExecute)},attrs.$observe("title",function(newVal){initialize(newVal)}),attrs.$observe("confirmAction",function(newVal){newVal&&element.click(function(){showConfirmMessage()})}),tooltipService.onClose(element,function(){isDialog&&(isDialog=!1,initialize(attrs.title),$rootScope.$$phase||scope.$apply())}),$rootScope.$on("languageChanged",function(){initialize(attrs.title)})}}}}])}(),function(){"use strict";COMPONENTS.directive("i18n",["$rootScope","i18nService",function($rootScope,i18nService){return{restrict:"A",replace:!0,scope:{i18n:"@"},template:"<label>{{label}}</label>",link:function(scope){function setLabelValue(){scope.label=i18nService(scope.i18n)}scope.$watch("i18n",function(){setLabelValue()}),$rootScope.$on("languageChanged",function(){setLabelValue()})}}}])}(),function(){"use strict";COMPONENTS.directive("i18nDb",["$rootScope","i18nService","i18nDbService",function($rootScope,i18nService,i18nDbService){return{restrict:"A",replace:!0,scope:{i18nDb:"="},template:'<label ng-bind-html-unsafe="label.text"></label>',link:function(scope){function updateLabel(){scope.i18nDb&&(scope.label=i18nDbService.getI18nProperty(scope.i18nDb))}updateLabel(),scope.$watch("i18nDb",function(){updateLabel()}),$rootScope.$on("languageChanged",function(){updateLabel()})}}}])}(),function(){"use strict";COMPONENTS.directive("i18nDbInput",["$rootScope","$compile","i18nService","i18nDbService","stringService","objectService",function($rootScope,$compile,i18nService,i18nDbService,stringService,objectService){var i18nPreffix="_i18n_";return{priority:1e3,restrict:"A",replace:!0,transclude:"element",controller:["$scope","$element","$attrs","$transclude","$compile",function($scope,$element,$attrs,$transclude,$compile){this.i18nNgModel=stringService.replaceToken(i18nPreffix+$attrs.ngModel,"\\.","_"),$element.removeAttr("i18n-db-input"),$element.attr("ng-model",this.i18nNgModel+".text"),$compile($element)($scope)}],template:"<input />",link:function(scope,element,attrs,controller){function updateModel(newVal){currentLanguage=i18nService.getCurrentLanguage(),hasI18nStructure=i18nDbService.hasI18nStructure(newVal),setOriginalModelPointers(newVal,hasI18nStructure),hasI18nStructure||initI18nStructure(newVal),updateNgModel(newVal),hasI18nStructure=!0}function updateNgModel(newVal){currentLanguage===defaultLanguage||creatingFromCustomLanguage?updateEditableNgModel(defaultLanguage):i18nDbService.hasI18nStructure(newVal)?updateEditableNgModel(currentLanguage):updateReadonlyNgModel()}function updateEditableNgModel(language){scope[controller.i18nNgModel]=originalModelLeafPointer[language],isDisabled=!1,element.removeAttr("readonly")}function updateReadonlyNgModel(){scope[controller.i18nNgModel]=originalModelLeafPointer[defaultLanguage],isDisabled=!0,element.attr("readonly","readonly")}function initLeafStructure(){originalModelParentLeafPointer[leafProp]={},originalModelParentLeafPointer[leafProp][defaultLanguage]={},originalModelLeafPointer=originalModelParentLeafPointer[leafProp]}function initDefaultLanguageStructure(newVal){originalModelLeafPointer[defaultLanguage]={},originalModelLeafPointer[defaultLanguage].text=newVal}function initI18nStructure(newVal){objectService.isObject(newVal)?creatingFromCustomLanguage=!1:(initLeafStructure(),initDefaultLanguageStructure(newVal),currentLanguage!==defaultLanguage&&(creatingFromCustomLanguage=!0))}function setOriginalModelPointers(newVal,hasI18nStructure){hasI18nStructure?setOriginalModelModifiedPointers(newVal):setOriginalModelInitPointers()}function setOriginalModelInitPointers(){scope[ngModelLevels[0]]||(scope[ngModelLevels[0]]={}),scope[i18nPreffix+ngModelLevels[0]]={},originalModelLeafPointer=scope[ngModelLevels[0]];for(var i=1;i<ngModelLevels.length;i+=1)originalModelLeafPointer[ngModelLevels[i]]||(originalModelLeafPointer[ngModelLevels[i]]={}),originalModelParentLeafPointer=originalModelLeafPointer,originalModelLeafPointer=originalModelLeafPointer[ngModelLevels[i]],i===ngModelLevels.length-1&&(leafProp=ngModelLevels[i])}function setOriginalModelModifiedPointers(newVal){originalModelLeafPointer=newVal}var hasI18nStructure,isDisabled,originalModelLeafPointer,originalModelParentLeafPointer,leafProp,currentLanguage,creatingFromCustomLanguage,defaultLanguage=i18nService.getDefaultLanguage(),ngModelLevels=attrs.ngModel.split(".");setTimeout(function(){element.click(function(){currentLanguage=i18nService.getCurrentLanguage(),isDisabled&&(isDisabled=!1,$(this).removeAttr("readonly"),originalModelLeafPointer[currentLanguage]={},originalModelLeafPointer[currentLanguage].text=originalModelLeafPointer[defaultLanguage].text,scope[controller.i18nNgModel]=originalModelLeafPointer[currentLanguage],scope.$apply())})}),scope.$watch(attrs.ngModel,function(newVal){updateModel(newVal)}),$rootScope.$on("languageChanged",function(e,newLanguage){currentLanguage=newLanguage,updateNgModel(scope.$eval(attrs.ngModel))})}}}])}(),COMPONENTS.directive("autoComplete",["$rootScope","tagService","constantsService","i18nService","i18nDbService",function($rootScope,tagService,constantsService,i18nService,i18nDbService){"use strict";return{restrict:"E",replace:!0,template:'<div class="autoCompleteContainer"><input type="hidden" /></div>',require:"?ngModel",scope:{model:"=ngModel",options:"=ngOptions",multiple:"@",placeholder:"@",labelKey:"@",valueKey:"@",onChange:"=uxChange"},link:function(scope,element,attrs,ctrl){function onChange(e){e.added&&e.added.newItem?(delete e.added.newItem,tagService.createTag(e.added.text,function(newTag){e.val[e.val.length-1]=newTag[attrs.valueKey],updateModel(e.val)})):updateModel(e.val.length>0?e.val:void 0),scope.onChange&&scope.onChange()}function regenerateComponent(){scope.model&&ctrl.$setViewValue(scope.model);var setup=getSetup();autoCompleteObj.select2(setup).select2("val",scope.model)}function getSetup(){return{data:{results:scope.options,text:getText},multiple:"true"===attrs.multiple,placeholder:i18nService(attrs.placeholder),minimumInputLength:0,id:getId,createSearchChoice:createSearchChoice,initSelection:initSelection,formatResult:formatResult,formatSelection:formatSelection}}function updateModel(newVal){scope.model=newVal,ctrl.$setViewValue(scope.model),$rootScope.$$phase||scope.$apply()}function getText(item){var labelKey=i18nDbService.getI18nProperty(item[attrs.labelKey]).text;return labelKey||""}function getId(item){return item[attrs.valueKey]}function createSearchChoice(term,data){if(0===$(data).filter(function(){var labelKey=i18nDbService.getI18nProperty(this[attrs.labelKey]).text;return 0===parseInt(labelKey.localeCompare(term),10)}).length){var choiceObj={};return choiceObj.newItem=!0,choiceObj[attrs.valueKey]=term,choiceObj[attrs.labelKey]=term,choiceObj}return null}function initSelection(element,callback){var id,data=[],ids=element.val().split(",");$(ids).each(function(){id=this,$(scope.options).each(function(){0===parseInt(id.localeCompare(""+this[attrs.valueKey]),10)&&("true"===attrs.multiple?data.push(this):data=this)})}),callback(data)}function formatResult(item){var labelKey=i18nDbService.getI18nProperty(item[attrs.labelKey]).text,htmlMarkup="<label>"+labelKey+"</label>";return item.newItem&&(htmlMarkup+=" <i>(New item)</i>"),htmlMarkup}function formatSelection(item){return i18nDbService.getI18nProperty(item[attrs.labelKey]).text}var autoCompleteObj=$(' > input[type="hidden"]',element);attrs.valueKey||(attrs.valueKey="_id"),autoCompleteObj.on("change",function(e){onChange(e)}),scope.$watch("options",function(){regenerateComponent()},!0)}}}]),COMPONENTS.directive("checkbox",["$rootScope","$timeout",function($rootScope,$timeout){"use strict";return{require:"ngModel",restrict:"A",replace:!0,template:'<div class="checkContainer"><input tabindex="{{tabindex}}" type="checkbox" id="checkbox{{$id}}"><label for="checkbox{{$id}}" ng-show="label" title="{{title}}" i18n-title><label i18n="{{label}}"></label></label></div>',scope:{ngModel:"=",ngClick:"&ngClick",label:"@",tabindex:"@",title:"@",blockUpdateModel:"@"},link:function(scope,element,attrs,ngModelCtrl){function updateState(newState){externalModelChange||("true"!==scope.blockUpdateModel&&(scope.ngModel=newState,ngModelCtrl.$setViewValue(scope.ngModel)),$rootScope.$$phase||scope.$apply(),scope.ngClick&&scope.ngClick())}var externalModelChange=!1;$timeout(function(){element.iCheck({checkboxClass:"check icheckbox_square-blue",increaseArea:"20%"}),scope.ngModel?element.iCheck("check"):element.iCheck("uncheck")},0),scope.$watch("ngModel",function(newVal){externalModelChange=!0,element.iCheck(newVal?"check":"uncheck"),setTimeout(function(){externalModelChange=!1},0)}),element.on("ifChecked",function(){updateState(!0)}),element.on("ifUnchecked",function(){updateState(!1)})}}}]),COMPONENTS.directive("colorPicker",["styleService","i18nService",function(styleService,i18nService){"use strict";return{require:"ngModel",restrict:"A",replace:!0,template:'<div class="colorPicker"><input type="text" placeholder="{{getI18nPlaceholder()}}"/><div class="transparentToggle" checkbox ng-model="isTransparent" label="colorPicker.transparent" ng-click="toggleTransparent()" /></div>',scope:{model:"=ngModel",placeholder:"@",onChange:"&"},link:function(scope,element,attrs,ngModelCtrl){function setTransparentColor(){scope.isTransparent=!0,scope.model="transparent",inputElm.attr("readonly","readonly")}function removeTransparentColor(){scope.isTransparent=!1,scope.model="",inputElm.removeAttr("readonly")}var rgbObj=null,inputElm=$(' > input[type="text"]',element);scope.model&&("transparent"===scope.model&&(scope.isTransparent=!0),rgbObj=styleService.rgbStrToRgbObj(scope.model),rgbObj&&(scope.model=styleService.rgbObjToHexStr(rgbObj))),inputElm.minicolors({letterCase:"uppercase",animationSpeed:0,showSpeed:0,hideSpeed:0,show:function(){removeTransparentColor(),$(this).focus()},changeDelay:10,change:function(hex){scope.model||(scope.model=""),hex.toLowerCase()!==scope.model.toLowerCase()&&ngModelCtrl.$setViewValue(scope.model),scope.model=hex,scope.$apply()}}),scope.$watch("model",function(newVal){if(scope.isTransparent){try{inputElm.minicolors("value","")}catch(ex){}setTransparentColor()}else try{inputElm.minicolors("value",newVal)}catch(ex){}}),inputElm.blur(function(){scope.onChange&&scope.onChange()}),scope.getI18nPlaceholder=function(){return i18nService(scope.placeholder)},scope.toggleTransparent=function(){scope.isTransparent?setTransparentColor():removeTransparentColor(),scope.$apply()}}}}]),function(){"use strict";COMPONENTS.directive("fileUploader",["$rootScope","stdService",function($rootScope,stdService){return{restrict:"E",replace:!0,templateUrl:"fileUploader.html",scope:{model:"=ngModel",endpoint:"@",onUpload:"&",defaultMediaUrl:"=",multiple:"@",preview:"@"},link:function(scope,element){function success(file){scope.model&&(scope.model=file[0]),$rootScope.$$phase||scope.$apply(),scope.onUpload&&scope.onUpload({$uploadedFile:file})}scope.selectFile=function(){$('input[type="file"]',element).click()},scope.submit=function(){return element.ajaxSubmit({error:function(xhr){stdService.error("Error uploading file",xhr)},success:function(uploadedFile){success(uploadedFile)}}),!1}}}}])}(),function(){"use strict";COMPONENTS.directive("password",[function(){return{restrict:"A",require:"ngModel",replace:!0,templateUrl:"password.html",scope:{model:"=ngModel",clickToChange:"="},link:function(scope){scope.togglePassword=function(){scope.changePasswordActive=scope.changePasswordActive!==!0,scope.hangePasswordActive||(scope.model=null)}}}}])}(),COMPONENTS.directive("radio",["$rootScope","$timeout",function($rootScope,$timeout){"use strict";
return{require:"ngModel",restrict:"A",replace:!0,template:'<div class="checkContainer"><input tabindex="{{tabindex}}" type="radio" id="radio{{$id}}" name="{{name}}"><label for="radio{{$id}}" ng-show="label" title="{{title}}" i18n-title><label i18n="{{label}}"></label></label></div>',scope:{ngModel:"=",name:"@",label:"@",tabindex:"@",title:"@"},link:function(scope,element,attrs,ngModelCtrl){function updateState(newState){newState&&!externalModelChange&&("true"!==scope.blockUpdateModel&&(scope.ngModel=newState,ngModelCtrl.$setViewValue(scope.ngModel)),scope.ngClick&&scope.ngClick(),$rootScope.$$phase||scope.$apply())}var externalModelChange=!1;$timeout(function(){element.iCheck({radioClass:"check iradio_square-blue",increaseArea:"20%"})},0),scope.ngModel===attrs.value&&$(" > input",element).attr("checked",!0),element.on("ifChecked",function(){updateState(attrs.value)})}}}]),COMPONENTS.directive("rating",["rateService","sessionService",function(rateService,sessionService){"use strict";return{restrict:"A",replace:!0,scope:{rating:"=",targetId:"=",targetAuthorId:"=",targetCollection:"@",starSize:"@height"},templateUrl:"rating.html",link:function(scope){function isRatingAllowed(){var isUserLogged=sessionService.isUserLogged(),isSessionUserTargetUser=isUserLogged&&scope.targetAuthorId===sessionService.getUserSession()._id;return isUserLogged&&(!scope.targetAuthorId||!isSessionUserTargetUser)}function setRatingAllowed(){ratingAllowed=isRatingAllowed()}function initRating(){scope.normalizedRating=[],scope.rateOnHover=0,normalizeRating()}function normalizeRating(){var i,maxRate=5;for(i=0;maxRate>i;i+=1)scope.normalizedRating[i]=scope.rating>i&&scope.rating>=i+1?"full":scope.rating>i?"half":"none"}var ratingAllowed;scope.$watch("rating",function(){initRating()}),scope.$watch("targetId",function(){initRating()}),scope.$watch("targetAuthorId",function(){setRatingAllowed()}),scope.hoverRate=function(rating){ratingAllowed&&(scope.rateOnHover=rating)},scope.clearHoverRate=function(){scope.rateOnHover=0},scope.getStarStyleClass=function(rating,desc){var hover=rating<=scope.rateOnHover?"hoverState":"";return desc+"-rated "+hover},scope.rate=function(rating){ratingAllowed&&rateService.rate(rating,scope.targetId,scope.targetCollection,function(avgRating){scope.rating=avgRating.avgRating,normalizeRating()})},scope.getStarSize=function(){var defaultSize=24;return{width:scope.starSize||defaultSize,height:scope.starSize||defaultSize}}}}}]),COMPONENTS.directive("contentList",["constantsService",function(constantsService){"use strict";return{restrict:"E",replace:!0,templateUrl:"contentList.html",scope:{_id:"=id",config:"="},link:function(scope){scope.items=[],scope.collection=constantsService.collections.content,scope.searchTargets=["title","summary","content"],scope.onEditPanels=[{title:"Edit content",type:"editContent"}],scope.template='<h3><a href="#"><label i18n-db="item.title"></label></a></h3><div class="summary" i18n-db="item.summary"></div><div list-expanded-view><div class="content" i18n-db="item.content"></div></div>{{item.update.date}}'}}}]),function(){COMPONENTS.directive("createItem",["$compile",function($compile){return{restrict:"A",replace:!1,template:"<div></div>",scope:{internalData:"=",onLayer:"=",onCreate:"&"},link:function(scope,element){var collection=scope.internalData.collection,layerElm=$("<div create-"+collection+' model="internalData.data" on-layer="onLayer"></div>');element.html(layerElm),$compile(layerElm)(scope)}}}])}(),function(){COMPONENTS.directive("createItemButton",["$injector","crudService","editBoxUtilsService",function($injector,crudService,editBoxUtilsService){return{restrict:"A",scope:{collection:"=",onCreatePanels:"=",onCreate:"&"},link:function(scope,element){function createItem(){scope.panels=getCreatePanels(),scope.internalData={collection:scope.collection,data:{}},scope.onSave=function(){scope.onCreate({$item:scope.internalData.data})},editBoxUtilsService.showEditBox(scope,element,element)}function getCreatePanels(){var panels;return panels=scope.onCreatePanels?scope.onCreatePanels:[{title:"Create item",type:"createItem"}]}scope.createItem=function(){createItem()}}}}])}(),function(Math,Number,COMPONENTS){"use strict";COMPONENTS.directive("list",["$rootScope","$location","$compile","$timeout","rowService","listService","listSelectService","roleService","sessionService","objectService","tooltipService",function($rootScope,$location,$compile,$timeout,rowService,listService,listSelectService,roleService,sessionService,objectService,tooltipService){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"list.html",scope:{items:"=list",collection:"=",config:"=",projection:"=",currentPage:"=",transcludedData:"=",onCreatePanels:"=",onEditPanels:"=",template:"=",onSelect:"&",onCreate:"&",onEdit:"&",onDelete:"&",onSearch:"&",dbSource:"@"},link:function(scope,element){function allowIfHasAdminRole(action){return isAdmin()?action:!1}function isAdmin(){var userSession=sessionService.getUserSession();return roleService.hasAdminRole(userSession)}function getItemsHeight(){var rowSlots=rowService.getMaxSlots(),itemsPerFile=Math.floor(rowSlots/scope.colWidth);return element.width()/itemsPerFile}scope.isPageActionsTop=function(){var pageActionPos=listService.getDefaultValue("pageActionPos",scope.config),normalizedPageActionPos=Number(pageActionPos);return 0===normalizedPageActionPos||2===normalizedPageActionPos},scope.isPageActionsBottom=function(){var pageActionPos=listService.getDefaultValue("pageActionPos",scope.config),normalizedPageActionPos=Number(pageActionPos);return 1===normalizedPageActionPos||2===normalizedPageActionPos},scope.select=function(item){listSelectService.selectItem(scope,item)},scope.unselect=function(item){listSelectService.unselectItem(scope,item)},scope.clickOnItem=function(item,$index,$event,editOnSelect){listSelectService.clickOnItem(scope,element,item,$index,$event,editOnSelect)},scope.getWrapperClass=function(){var isSelectable=scope.isSelectable()?"selectable":"",isEditable=scope.isEditable()?"editable":"";return isSelectable+" "+isEditable},scope.getItemStyleClasses=function(item){var colWidthStyleClass,maxColSize=rowService.getMaxSlots(),viewMode=scope.detailId?"detailView":"listView",itemClassesObj={};return scope.colWidth=scope.config.columns?Math.floor(maxColSize/scope.config.columns):maxColSize,colWidthStyleClass="large-"+scope.colWidth,itemClassesObj[colWidthStyleClass]=!0,itemClassesObj.active=item.isSelected,itemClassesObj[viewMode]=!0,itemClassesObj.boxedItems=scope.config.boxedItems,itemClassesObj.multiSelectable=scope.isMultiSelectable(),itemClassesObj},scope.createItem=function(item){scope.onCreate({$item:item})},scope.deleteItem=function(id){listSelectService.dropFromSelectedList(scope,id),tooltipService.hide(),scope.onDelete({$id:id})},scope.deleteDetailId=function(){$location.search("detailId",null)},scope.isSearchable=function(){return listService.getDefaultValue("searchable",scope.config)},scope.isSelectable=function(){return scope.isSingleSelectable()||scope.isMultiSelectable()},scope.isSingleSelectable=function(){return allowIfHasAdminRole(scope.config.selectable)},scope.isMultiSelectable=function(){return allowIfHasAdminRole(scope.config.multiSelectable)},scope.isEditable=function(){return allowIfHasAdminRole(scope.config.editable)},scope.isDeletable=function(){return allowIfHasAdminRole(scope.config.deletable)},scope.isCreatable=function(){return allowIfHasAdminRole(scope.config.creatable)},scope.getFilter=function(){return"true"==scope.dbSource?"":scope.searchText},scope.executeSearch=function(){scope.onSearch({$text:scope.searchText})},scope.setItemHeight=function(){return scope.config.boxedItems?{height:getItemsHeight()}:{}},scope.page=0,void 0!==scope.currentPage&&(scope.currentPage=scope.page),listService.setDetailId(scope,$location.search().detailId),scope.$on("$routeUpdate",function(){listService.setDetailId(scope,$location.search().detailId)})}}}])}(window.Math,window.Number,window.COMPONENTS),function(Number){"use strict";COMPONENTS.directive("listActions",["arrayService","listService",function(arrayService,listService){return{restrict:"A",replace:!0,templateUrl:"listActions.html",link:function(scope){function selectAll(){scope.items.forEach(function(item){scope.select(item)})}function unselectAll(){scope.items.forEach(function(item){scope.unselect(item)})}function deleteSelected(){var selectedIds=arrayService.copy(scope.selectedIds);selectedIds.forEach(function(id){scope.deleteItem(id)})}scope.getPrevPage=function(){scope.currentPage-=1,scope.loadList()},scope.getNextPage=function(){scope.currentPage+=1,scope.loadList()},scope.showPrevPageLink=function(){return listService.getDefaultValue("pageSize",scope.config)&&scope.currentPage>0},scope.showNextPageLink=function(){var pageSize=Number(listService.getDefaultValue("pageSize",scope.config));return(scope.currentPage+1)*pageSize<scope.totalSize},scope.toggleSelectAll=function(){scope.selectedIds&&scope.items.length===scope.selectedIds.length?unselectAll():selectAll()},scope.deleteSelected=function(){deleteSelected()}}}}])}(window.Number),function(Math,Number,COMPONENTS){"use strict";COMPONENTS.directive("listDb",["$rootScope","$location","rowService","listService","listDbService",function($rootScope,$location,rowService,listService,listDbService){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"listDb.html",scope:{_id:"=id",collection:"=",exportedItems:"=list",config:"=",projection:"=",searchTargets:"=",template:"=",transcludedData:"=",onCreatePanels:"=",onEditPanels:"=",onSelect:"&"},link:function(scope){function loadList(){var options={collection:scope.collection,searchText:scope.searchText,searchTargets:scope.searchTargets,currentPage:scope.currentPage,pageSize:listService.getDefaultValue("pageSize",scope.config),skip:listService.getDefaultValue("skip",scope.config),sort:listService.getDefaultValue("sort",scope.config),projection:scope.projection};listDbService.loadList(options,function(list){scope.totalSize=list.totalSize,scope.items=list.results,scope.exportedItems&&(scope.exportedItems=scope.items)})}scope.currentPage=0,scope.searchText="",scope.loadList=function(){loadList()},scope.createItem=function(item){listDbService.createItem(scope.collection,item)},scope.deleteItem=function(id){listDbService.deleteItem(scope.collection,id),scope.loadList()},scope.onSearch=function($text){scope.searchText=$text,scope.loadList()},scope.selectItem=function(item){scope.onSelect({$item:item})},scope.$watch("collection",function(){scope.loadList(),$rootScope.$on(scope.collection+"Changed",function(){scope.loadList()})})}}}])}(window.Math,window.Number,window.COMPONENTS),COMPONENTS.directive("listEdit",["rowService","tagService",function(rowService,tagService){"use strict";return{restrict:"A",replace:!1,templateUrl:"listEdit.html",link:function(scope){scope.availableTags=tagService.getTags(),scope.sortTypes={field:[{id:"create.date",text:"Create date"},{id:"update.date",text:"Update date"},{id:"create.author",text:"Create author"},{id:"update.author",text:"Update author"}],order:[{id:"1",text:"Asc"},{id:"-1",text:"Desc"}]},scope.model.sort||(scope.model.sort={field:scope.sortTypes.field[0].id,order:scope.sortTypes.order[1].id}),scope.columnOptions=[];for(var index=0;index<rowService.getMaxSlots();index+=1)scope.columnOptions.push({value:index+1,text:index+1});scope.model.columns||(scope.model.columns=1)}}}]),function(){"use strict";COMPONENTS.directive("listExpandedView",[function(){return{restrict:"A",replace:!0,transclude:!0,template:'<div ng-show="detailId"><div ng-transclude></div></div>'}}])}(),COMPONENTS.directive("mediaList",["$rootScope","mediaService","constantsService",function($rootScope,mediaService,constantsService){"use strict";return{restrict:"E",replace:!0,scope:{config:"=",onSelect:"&"},templateUrl:"mediaList.html",link:function(scope){scope.items=[],scope.collection=constantsService.collections.media,scope.projection={data:0},scope.searchTargets=["name"],scope.onEditPanels=[{title:"Edit media",type:"editMedia"}],scope.template='<img ng-src="{{transcludedData.getDownloadUrl(item)}}" title="{{transcludedData.getMediaTitle(item)}}" class="cursorPointer" edit-on-click="true" />',scope.$watch("config",function(newConfig){newConfig.boxedItems=!0,newConfig&&!newConfig.columns&&(newConfig.columns=4)}),scope.onUpload=function(){$rootScope.$broadcast("mediaChanged","create"),scope.$apply()},scope.selectItem=function(item){scope.onSelect({$item:item})},scope.transcludedData={},scope.transcludedData.getDownloadUrl=function(media){return mediaService.getDownloadUrl(media)},scope.transcludedData.getMediaTitle=function(media){return mediaService.getMediaHtmlDetails(media)}}}}]),function(COMPONENTS){"use strict";COMPONENTS.directive("nestedItems",["$compile",function($compile){return{restrict:"E",replace:!0,transclude:!0,terminal:!0,scope:{items:"=",selectedItem:"=",onSelect:"&",onAdd:"&",onDelete:"&",sortableOptions:"="},link:function(scope,element){function emitFn(fn,item){scope[fn]&&scope[fn]({$item:item})}scope.selectItem=function(item){emitFn("onSelect",item)},scope.addItem=function(item){emitFn("onAdd",item)},scope.deleteItem=function(item){emitFn("onDelete",item)},scope.emitSelect=function(item){emitFn("onSelect",item)},scope.emitAdd=function(item){emitFn("onAdd",item)},scope.emitDelete=function(item){emitFn("onDelete",item)},scope.toggleSubItems=function(item){item.areSubItemsHidden=item.areSubItemsHidden!==!0},scope.getToggleSubItemsIcon=function(item){return item.areSubItemsHidden!==!0?"downIcon":"rightIcon"},scope.$watch("sortableOptions",function(newVal){if(newVal){var template='<ul ui-sortable="sortableOptions" ng-model="items" class="items"><li ng-repeat="item in items" class="item" ng-class="{hasSubItems:item.items.length}"ng-show="!item.deleted"><div class="box" ng-class="{selected:item._id == selectedItem._id, collapsed:item.areSubItemsHidden}"><div class="sortingBox"></div><button class="toggleSubItems small" ng-click="toggleSubItems(item)" ng-show="item.items.length" ng-class="getToggleSubItemsIcon(item)"></button><div ng-click="selectItem(item)"><label i18n-db="item.text"></label></div><div class="actions"><button class="addIcon" ng-click="addItem(item)"></button><button class="removeIcon" ng-click="deleteItem(item)"></button></div></div><div class="subItemsContainer" ng-class="{hasSubItems:item.items.length}" ng-show="!item.areSubItemsHidden"><nested-items items="item.items" on-select="emitSelect($item)" on-add="emitAdd($item)" on-delete="emitDelete($item)" selected-item="selectedItem" sortable-options="sortableOptions"></nested-items></div></li></ul>';element.append(template),$compile(element.contents())(scope)}})}}}])}(window.COMPONENTS),function(COMPONENTS){"use strict";COMPONENTS.directive("nestedItemsWrapper",["globalMsgService","i18nService","timerService","$timeout",function(globalMsgService,i18nService,timerService,$timeout){return{restrict:"E",replace:!0,template:'<div><nested-items items="items" sortable-options="sortableOptions" selected-item="selectedItem" on-select="onSelectItem($item)" on-add="onAddItem($item)" on-delete="onDeleteItem($item)"></nested-items><button class="addIcon floatRight" ng-click="addRootItem()"></button></div>',scope:{items:"=",selectedItem:"=",onSelect:"&",onAdd:"&"},link:function(scope){function addItem(siblingItems){var newItem={_id:timerService.getRandomNumber(),text:i18nService("editPages.newPage"),items:[],position:scope.items.length,added:!0};siblingItems.push(newItem),scope.onSelectItem(newItem),scope.onAdd&&scope.onAdd({$item:newItem})}function deleteItem(item){item.deleted=!0,item.items&&item.items.forEach(function(item){deleteItem(item)})}function undeleteItem(item){item.deleted=!1,item.items&&item.items.forEach(function(item){undeleteItem(item)})}function getNonDeletedItems(items){var nonDeletedItems=[];return items.forEach(function(item){item.deleted||(nonDeletedItems.push(item),getNonDeletedItems(item.items).forEach(function(item){nonDeletedItems.push(item)}))}),nonDeletedItems}function onUpdate(){$timeout(function(){markAllItemsAsUpdated()},0)}function markAllItemsAsUpdated(items,accumulativeIndex){items?accumulativeIndex+=1:(items=scope.items,accumulativeIndex=0),items.forEach(function(item,index){item.updated=!0,item.position=index+accumulativeIndex,markAllItemsAsUpdated(item.items,item.position)})}scope.sortableOptions={items:"li",connectWith:"[ui-sortable]",placeholder:"sortingPlaceholder",forceHelperSize:!0,forcePlaceholderSize:!0,tolerance:"pointer",cursorAt:{top:0,left:0},handle:".sortingBox",update:onUpdate},scope.onSelectItem=function(item){scope.onSelect&&scope.onSelect({$item:item})},scope.addRootItem=function(){addItem(scope.items)},scope.onAddItem=function(item){addItem(item.items)},scope.onDeleteItem=function(item){var canBeDeleted,nonDeletedItemFound=!1;deleteItem(item),canBeDeleted=getNonDeletedItems(scope.items).length>0,canBeDeleted?item._id===scope.selectedItem._id&&scope.items.forEach(function(item){item.deleted||nonDeletedItemFound||(scope.selectedItem=item,nonDeletedItemFound=!0)}):(undeleteItem(item),globalMsgService.show(i18nService("editPages.cannotDeletePage")))}}}}])}(window.COMPONENTS),function(){"use strict";COMPONENTS.directive("nestedPagesWrapper",["pageService","rowService","$timeout",function(pageService,rowService,$timeout){return{restrict:"E",replace:!0,template:'<div><nested-items-wrapper items="items" on-select="onSelect($item)" selected-item="selectedItem"on-add="onAddPage($item)"></nested-items-wrapper></div>',scope:{pages:"=",items:"=",selectedItem:"=",onAdd:"&"},link:function(scope){function getParentItem(parentId,parentItem){var matchedItem=null,items=parentItem?parentItem.items:scope.items;return items.forEach(function(candidateParentItem){candidateParentItem._id===parentId?matchedItem=candidateParentItem:matchedItem||(matchedItem=getParentItem(parentId,candidateParentItem))}),matchedItem}function normalizeItems(pages){scope.pages=pages,scope.items=[],scope.pages.forEach(function(page){if(page.items=[],page.parentPageId){var parentItem=getParentItem(page.parentPageId);parentItem.items.push(page)}else scope.items.push(page)}),selectFirstPage()}function selectFirstPage(){$timeout(function(){scope.selectedItem=scope.items[0]})}var pages;scope.selectedItem={},scope.onSelect=function(page){scope.selectedItem=page},scope.onAddPage=function(page){page.description="",page.rows=[rowService.getEmptyRow()],scope.onAdd&&scope.onAdd({$page:page})},pages=pageService.getPages(),normalizeItems(pages)}}}])}(),COMPONENTS.directive("tagList",["constantsService",function(constantsService){"use strict";return{restrict:"E",replace:!0,templateUrl:"tagList.html",scope:{config:"="},link:function(scope){scope.items=[],scope.collection=constantsService.collections.tags,scope.searchTargets=["text"],scope.onEditPanels=[{title:"Edit tag",type:"editTag"}]}}}]),COMPONENTS.directive("userList",["$rootScope","mediaService","userService","constantsService","listDbService",function($rootScope,mediaService,userService,constantsService,listDbService){"use strict";return{restrict:"E",replace:!0,templateUrl:"userList.html",scope:{config:"="},link:function(scope){function getUserList(){scope.userList=userService.getUsers()}function loadUserList(){userService.loadUsers(function(users){scope.userList=users})}function onCreate(user){userService.createUser(user,function(){loadUserList()})}function onDelete(userId){listDbService.deleteItem(scope.collection,userId),loadUserList()}function getUserAvatarUrl(item){return item.media?mediaService.getDownloadUrl(item.media):mediaService.getDefaultAvatarUrl()}function getTemplate(){return'<div class="avatar columns large-3"><img ng-src="{{transcludedData.getUserAvatarUrl(item)}}" /></div><div class="columns large-22"><h3><a href="#">{{item.fullName}}</a></h3><div list-expanded-view class="email" ng-bind-html-unsafe="item.email"></div>{{item.create.date}}</div>'}getUserList(),scope.collection=constantsService.collections.users,scope.onEditPanels=[{title:"Edit users",type:"editUser"}],scope.onCreate=onCreate,scope.onDelete=onDelete,scope.transcludedData={},scope.transcludedData.getUserAvatarUrl=getUserAvatarUrl,scope.template=getTemplate(),$rootScope.$on(scope.collection+"Changed",function(){loadUserList()}),scope.config.pageActionPos=0}}}]),function(){"use strict";COMPONENTS.directive("mediaPicker",["$rootScope","editBoxUtilsService","mediaService",function($rootScope,editBoxUtilsService,mediaService){return{restrict:"E",replace:!0,scope:{model:"=ngModel",endpoint:"@",onUpload:"=",onMediaChange:"&onChange",onMediaClose:"&onClose",defaultMediaUrl:"=",preview:"@"},templateUrl:"mediaPicker.html",link:function(scope,element){function success(file){scope.model&&(scope.model=file),$rootScope.$$phase||scope.$apply(),scope.onUpload&&scope.onUpload(file),scope.onMediaChange&&scope.onMediaChange(file)}scope.getDownloadUrl=function(file){return file&&file._id?mediaService.getDownloadUrl(file):scope.defaultMediaUrl?scope.defaultMediaUrl:null},scope.getFileTitle=function(file){return mediaService.getMediaHtmlDetails(file)},scope.selectFromMediaList=function(){scope.panels=[{title:"Media list selection",type:"mediaListPicker"}],scope.internalData={media:scope.model},scope.onChange=function(){success(scope.internalData.media)},scope.onClose=function(){scope.onMediaClose&&scope.onMediaClose()},editBoxUtilsService.showEditBox(scope,element,$("button",element))},scope.deleteSelection=function(){success(null)}}}}]),COMPONENTS.directive("mediaListPicker",[function(){return{restrict:"A",replace:!1,template:'<media-list config="config" on-select="onSelect($item)"></media-list>',scope:{internalData:"=",onChange:"&"},link:function(scope){scope.config={selectable:!0,uploadable:!0,columns:2},scope.onSelect=function($item){scope.internalData.media=$item,scope.onChange&&scope.onChange()}}}}])}(),function(){"use strict";COMPONENTS.directive("resizableApp",["resizableAppService",function(resizableAppService){return{restrict:"A",replace:!1,link:function(scope,element,attrs){function enableResizableApp(){element.resizable({handles:"e, w",start:function(event){resizableAppService.start($(this),event)},resize:function(){resizableAppService.resize($(this))}})}function disableResizableApp(){element.resizable("destroy")}var hasBeenInitialized=!1;attrs.$observe("resizableApp",function(newVal){"true"===newVal?(hasBeenInitialized=!0,enableResizableApp()):hasBeenInitialized&&disableResizableApp()})}}}])}(),function(){"use strict";COMPONENTS.directive("sortableAddApp",["keyboardService","$timeout",function(keyboardService,$timeout){return{restrict:"A",replace:!1,link:function(scope,element){function start(ui){$(ui.helper).css({width:element.outerWidth(),height:element.outerHeight()}),registerKeyboardEvents()}function stop(){unregisterKeyboardEvents()}function registerKeyboardEvents(){keyboardService.register("esc","sortableAddApp",function(){element.trigger("mouseup")})}function unregisterKeyboardEvents(){keyboardService.unregister("esc","sortableAddApp")}$timeout(function(){element.draggable({helper:"clone",connectToSortable:"[sortable-app]",forceHelperSize:!0,tolerance:"pointer",cursorAt:{top:0,left:0},start:function(event,ui){start(ui)},stop:function(){stop()}})},0)}}}])}(),function(){"use strict";COMPONENTS.directive("sortableApp",["pageService","sortableAppService",function(pageService,sortableAppService){return{restrict:"A",replace:!1,link:function(scope,element,attrs){function instantiateSortableApp(){scope.sortableOptions={items:".app",cancel:".content > *",connectWith:"[sortable-app]",placeholder:"sortingPlaceholder",tolerance:"pointer",cursorAt:{top:0,left:0},start:function(event,ui){sortableAppService.start(ui)},update:function(event,ui){sortableAppService.update(ui)},stop:function(){sortableAppService.stop()}}}var sortableWrapElm=element.closest("[sortable-app]");scope.sortableOptions={},instantiateSortableApp(),attrs.$observe("sortableApp",function(newVal){"true"!==newVal?sortableWrapElm.sortable("disable"):sortableWrapElm.sortable("enable")})}}}])}(),function(document){"use strict";COMPONENTS.directive("boxSortable",["keyboardService",function(keyboardService){return{restrict:"A",transclude:!0,template:'<ul class="sortable" ng-transclude></ul>',scope:{onChange:"=uxChange",handle:"@",connectWith:"@"},replace:!0,link:function(scope,element,attrs){var updateFn=function(){scope.onChange&&scope.onChange()},sortingElms=attrs.connectWith?$(attrs.connectWith):element;element.sortable({placeholder:"sortingPlaceholder",forceHelperSize:!0,forcePlaceholderSize:!0,connectWith:attrs.connectWith,tolerance:"pointer",handle:attrs.handle||"",cursorAt:{top:0,left:0},start:function(){sortingElms.addClass("sorting"),keyboardService.register("esc","boxSortable",function(){element.sortable("option","update",function(){return!1}),$(document).trigger("mouseup"),element.sortable("option","update",function(){updateFn()})})},stop:function(){sortingElms.removeClass("sorting"),keyboardService.unregister("esc","boxSortable")},update:updateFn}),element.disableSelection()}}}])}(window.document),function(){COMPONENTS.directive("multipleFiles",[function(){"use strict";return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("multipleFiles",function(newVal){"true"===newVal?element.attr("multiple",""):element.removeAttr("multiple")})}}}])}(),function(){"use strict";function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}var forEach=angular.forEach,events=["change","keyup","blur"];forEach(events,function(event){var directiveName="ux"+capitalize(event);COMPONENTS.directive(directiveName,["$parse",function($parse){return function(scope,elm,attrs){var fn=$parse(attrs[directiveName]);elm.bind(event,function(e){scope.$apply(function(){fn(scope,{$event:e})})})}}])})}(),function(){"use strict";COMPONENTS.directive("uxShow",["constantsService",function(constantsService){return{terminal:!0,transclude:"element",priority:100,restrict:"A",compile:function(tElement,tAttrs,transclude){return function(scope,iElement,iAttr){function showContent(){contentScope=scope.$new(),transclude(contentScope,function(clonedElm){iElement.after(clonedElm),setTimeout(function(){contentElm=iElement.next()},constantsService.keyboardInterval)})}function hideContent(){contentElm&&(contentElm.remove(),contentElm=null),contentScope&&(contentScope.$destroy(),contentScope=null)}var contentElm,contentScope;scope.$watch(iAttr.uxShow,function(expValue){expValue?showContent():hideContent()})}}}}])}(),function(){"use strict";COMPONENTS.directive("uxTransclude",["$compile",function($compile){return{restrict:"A",scope:{template:"=uxTransclude"},link:function(scope,element){var newContent=$(scope.template);element.html(newContent),$compile(newContent)(scope.$parent)}}}])}(),COMPONENTS.directive("emailMandatory",["emailService","validationService",function(emailService,validationService){"use strict";return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var value=scope.$eval(attrs.ngModel),validationTitle="Please enter a valid e-mail",validationKey="emailMandatory",validationFn=function(viewValue){return!viewValue||""===viewValue||emailService.validateEmail(viewValue)};validationService.setupValidation(value,element,ctrl,validationTitle,null,validationKey,validationFn)}}}]),COMPONENTS.directive("mandatory",["validationService",function(validationService){"use strict";return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var value=scope.$eval(attrs.ngModel),validationTitle="This field is required",validationKey="mandatory",validationFn=function(viewValue){return viewValue&&""!==viewValue};validationService.setupValidation(value,element,ctrl,validationTitle,null,validationKey,validationFn)}}}]),COMPONENTS.directive("passwordMandatory",["$compile","validationService",function($compile,validationService){"use strict";return{require:"ngModel",link:function(scope,element,attrs,ctrl){var value=scope.$eval(attrs.ngModel),validationTitle="Password must meet the following requirements",validationKey="passwordMandatory",errorHtmlDetails='<ul><li ng-class="pwdHasLetter">At least <strong>one letter</strong></li><li ng-class="pwdHasNumber">At least <strong>one number</strong></li><li ng-class="pwdValidLength">At least <strong>8 characters long</strong></li></ul>',compiledErrorHtmlDetails=$compile(errorHtmlDetails)(scope),validationFn=function(viewValue){return viewValue?(scope.pwdValidLength=viewValue&&viewValue.length>=8?"valid":void 0,scope.pwdHasLetter=viewValue&&/[A-z]/.test(viewValue)?"valid":void 0,scope.pwdHasNumber=viewValue&&/\d/.test(viewValue)?"valid":void 0,scope.pwdValidLength&&scope.pwdHasLetter&&scope.pwdHasNumber):!0};validationService.setupValidation(value,element,ctrl,validationTitle,compiledErrorHtmlDetails,validationKey,validationFn)}}}]),function(){"use strict";COMPONENTS.factory("ajaxService",["$http","loadingService",function($http,loadingService){function ajax(options){var settings={url:options.url,method:options.method||"GET",data:options?options.data:{}};settings.data&&"GET"===settings.method&&(settings.url=settings.url+"?"+decodeURIComponent($.param(settings.data))),loadingService.start(),$http(settings).success(function(data){options.success&&options.success(data)}).error(function(data){options.error&&options.error(data)}),loadingService.done()}return{ajax:ajax}}])}(),function(){"use strict";COMPONENTS.factory("availableAppsService",["$rootScope","crudService","constantsService",function($rootScope,crudService,constantsService){function loadAvailableApps(callback){var filter={sort:{field:"category",order:"-1"}};crudService.get(constantsService.collections.availableApps,null,filter,function(availableApps){setAvailableApps(availableApps.results),$rootScope.$broadcast("availableAppsLoaded"),callback&&callback(getAvailableApps())})}function getAvailableApps(){return availableApps}function getCategories(){return categories}function setAvailableApps(retrievedAvailableApps){var index=0;availableApps={index:{},model:[]},retrievedAvailableApps.forEach(function(retrievedAvailableApp){categorizeApp(retrievedAvailableApp),availableApps.index[retrievedAvailableApp.id]=index,availableApps.model.push(retrievedAvailableApp),index+=1})}function categorizeApp(availableApp){availableApp.category||(availableApp.category=constantsService.defaultCategory),categories[availableApp.category]||(categories[availableApp.category]=!0,availableApp.firstInCategory=!0)}var availableApps,categories=[];return{loadAvailableApps:loadAvailableApps,getAvailableApps:getAvailableApps,getCategories:getCategories}}])}(),function(){"use strict";COMPONENTS.factory("commentsService",["crudService","constantsService",function(crudService,constantsService){function loadComments(targetId,callback){var filter={q:{targetId:targetId},sort:{field:"create.date",order:"1"}};crudService.get(constantsService.collections.comments,null,filter,function(comments){callback&&callback(comments)})}function createComment(newCommentText,targetId,callback){var data={text:newCommentText,targetId:targetId};crudService.create(constantsService.collections.comments,data,function(newComment){callback&&callback(newComment)})}function updateComment(commentId,data,callback){crudService.update(constantsService.collections.comments,commentId,data,function(updatedComment){callback&&callback(updatedComment)})}function deleteComment(commentId,callback){crudService.delete(constantsService.collections.comments,commentId,function(){callback&&callback()})}return{loadComments:loadComments,createComment:createComment,updateComment:updateComment,deleteComment:deleteComment}}])}(),function(){"use strict";COMPONENTS.factory("constantsService",[function(){return{appKey:"app",appsPath:"/client/apps",defaultCategory:"Others",collections:{portal:"portal",pages:"pages",availableApps:"availableApps",content:"content",media:"media",users:"users",roles:"roles",comments:"comments",ratings:"ratings",tags:"tags",languages:"languages"},roles:{guest:"guest",reader:"reader",creator:"creator",admin:"admin",superAdmin:"superAdmin"},templates:{view:"view",edit:"edit",help:"help"},renderTypes:{dom:"dom",canvas:"canvas"},pageTypes:{apps:"apps",externalLink:"externalLink"},blurOpacity:.3,keyboardInterval:100}
}])}(),function(){"use strict";COMPONENTS.factory("contentService",["crudService","constantsService",function(crudService,constantsService){function createContent(content,callback){var data;content&&(content.title||content.summary||content.content)?(data={title:content.title,summary:content.summary,content:content.content,tags:content.tags},crudService.create(constantsService.collections.content,data,function(newContent){callback&&callback(newContent)})):callback&&callback({})}function updateContent(content,callback){var data;content&&(content.title||content.summary||content.content)?(data={title:content.title,summary:content.summary,content:content.content,tags:content.tags},crudService.update(constantsService.collections.content,content._id,data,function(updatedContent){callback&&callback(updatedContent)})):callback&&callback({})}function getContent(contentId,params,callback){params||(params={}),crudService.get(constantsService.collections.content,contentId,params,function(content){callback&&callback(content)})}return{createContent:createContent,updateContent:updateContent,getContent:getContent}}])}(),function(COMPONENTS){"use strict";COMPONENTS.factory("crudService",["$rootScope","ajaxService","constantsService",function($rootScope,ajaxService,constantsService){function create(collection,data,callback,blockBroadcastEvent){ajaxService.ajax({url:"rest/"+collection+"/create",data:data,method:"POST",success:function(result){blockBroadcastEvent||$rootScope.$broadcast(collection+"Changed","create"),callback&&callback(result)}})}function get(collection,id,data,callback){ajaxService.ajax({url:"rest/"+collection+(id?"/"+id:""),data:data?data:{},method:"GET",success:function(retrievedItem){callback&&callback(retrievedItem)}})}function update(collection,id,data,callback,blockBroadcastEvent){ajaxService.ajax({url:"rest/"+collection+"/"+id+"/update",data:data,method:"PUT",success:function(updatedItem){blockBroadcastEvent||$rootScope.$broadcast(collection+"Changed",id),callback&&callback(updatedItem)}})}function remove(collection,id,callback,blockBroadcastEvent){ajaxService.ajax({url:"rest/"+collection+"/"+id+"/delete",method:"DELETE",success:function(result){blockBroadcastEvent||$rootScope.$broadcast(collection+"Changed",id),callback&&callback(result)}})}function getStats(collection,data,callback){ajaxService.ajax({url:"rest/"+collection+"/getStats",data:data?data:{},method:"GET",success:function(newItem){callback&&callback(newItem)}})}function rate(collection,data,callback){ajaxService.ajax({url:"rest/"+collection+"/rate",data:data,method:"POST",success:function(newItem){callback&&callback(newItem)}})}function undeployApp(id,data,callback,blockBroadcastEvent){ajaxService.ajax({url:"rest/"+constantsService.collections.availableApps+"/"+id+"/undeploy",data:data,method:"POST",success:function(){blockBroadcastEvent||$rootScope.$broadcast(constantsService.collections.availableApps+"Undeployed",data.id),callback&&callback({})}})}return{create:create,get:get,update:update,"delete":remove,getStats:getStats,rate:rate,undeployApp:undeployApp}}])}(window.COMPONENTS),function(COMPONENTS){"use strict";COMPONENTS.factory("dbService",["crudService",function(crudService){function getDatabases(callback){crudService.get(databasesKey,null,null,function(databases){callback&&callback(databases)})}function createDatabase(data,callback){crudService.create(databasesKey,data,function(databases){callback&&callback(databases)})}function updateDatabase(databaseId,data,callback){crudService.update(databasesKey,databaseId,data,function(result){callback&&callback(result)})}function deleteDatabase(databaseId,callback){crudService.delete(databasesKey,databaseId,function(result){callback&&callback(result)})}function getInsensitiveSelector(selector,exact){var regexSelector=exact?"^"+selector+"$":selector;return{$regex:regexSelector,$options:"i"}}function getInexactSelector(selector){return{$regex:"^.*"+selector+".*",$options:"i"}}var databasesKey="databases";return{getDatabases:getDatabases,createDatabase:createDatabase,updateDatabase:updateDatabase,deleteDatabase:deleteDatabase,getInsensitiveSelector:getInsensitiveSelector,getInexactSelector:getInexactSelector}}])}(window.COMPONENTS),function(){"use strict";COMPONENTS.factory("metaService",["$rootScope","pageService","mediaService","i18nDbService","timerService",function($rootScope,pageService,mediaService,i18nDbService,timerService){function setHeader(portalTitle,faviconId){setTitle(portalTitle),setFavicon(faviconId)}function setWindowDimensions(){windowDimensions={width:$(window).width(),height:$(window).height()},$(window).resize(function(){($(this).width()!==windowDimensions.width||$(this).height()!==windowDimensions.height)&&(windowDimensions={width:$(this).width(),height:$(this).height()},$rootScope.$broadcast("onWindowResized",windowDimensions))})}function getWindowDimensions(){return windowDimensions}function trackAnalytics(trackingCode){if(trackingCode){var ga,s,_gaq=_gaq||[];_gaq.push(["_setAccount",trackingCode]),_gaq.push(["_trackPageview"]),ga=document.createElement("script"),ga.type="text/javascript",ga.async=!0,ga.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",s=document.getElementsByTagName("script")[0],s.parentNode.insertBefore(ga,s)}}function getDefaultFaviconUrl(){return"/client/images/favicon.ico"}function setTitle(portalTitle){var currentPage=pageService.getCurrentPage();document.title=i18nDbService.getI18nProperty(currentPage.text).text+" | "+portalTitle}function setDefaultFavicon(){var faviconUrl=getDefaultFaviconUrl();$("#favicon").attr("href",faviconUrl)}function setCustomFavicon(faviconId){mediaService.getMedia(faviconId,null,function(favicon){var faviconUrl=mediaService.getDownloadUrl(favicon)+"?v="+timerService.getRandomNumber();$("#favicon").attr("href",faviconUrl)})}function setFavicon(faviconId){faviconId?setCustomFavicon(faviconId):setDefaultFavicon()}var windowDimensions;return{setHeader:setHeader,setWindowDimensions:setWindowDimensions,getWindowDimensions:getWindowDimensions,getDefaultFaviconUrl:getDefaultFaviconUrl,trackAnalytics:trackAnalytics}}])}(),function(COMPONENTS){"use strict";COMPONENTS.factory("pageService",["$rootScope","crudService","rowService","constantsService",function($rootScope,crudService,rowService,constantsService){function loadPages(callback){var params={sort:{field:"position",order:"1"}};crudService.get(constantsService.collections.pages,null,params,function(returnedPages){pages=returnedPages.results,callback&&callback(getPages())})}function getPages(){return pages}function getPage(url){var matchedPage=null;return pages.forEach(function(page){page.url.toLowerCase()!==url.toLowerCase()||matchedPage||(matchedPage=page)}),matchedPage}function createPage(data,callback){crudService.create(constantsService.collections.pages,data,function(){loadPages(function(){$rootScope.$broadcast(constantsService.collections.pages+"Changed","create"),callback&&callback()})},!0)}function updatePage(pageId,data,callback){crudService.update(constantsService.collections.pages,pageId,data,function(data){loadPages(function(){$rootScope.$broadcast(constantsService.collections.pages+"Changed",pageId),callback&&callback(data)})},!0)}function updateCurrentPage(callback){var currentPage=getCurrentPage();updatePage(currentPage._id,currentPage,function(data){callback&&callback(data)})}function deletePage(pageId,callback){crudService.delete(constantsService.collections.pages,pageId,function(){loadPages(function(){$rootScope.$broadcast(constantsService.collections.pages+"Changed",pageId),callback&&callback()})},!0)}function getCurrentPage(){return currentPage}function setCurrentPage(newCurrentPage){currentPage=newCurrentPage}function isSubPageOf(subPage,page){return subPage.parentPageId===page._id}var pages,currentPage;return{loadPages:loadPages,getPages:getPages,getPage:getPage,createPage:createPage,updatePage:updatePage,updateCurrentPage:updateCurrentPage,deletePage:deletePage,getCurrentPage:getCurrentPage,setCurrentPage:setCurrentPage,isSubPageOf:isSubPageOf}}])}(window.COMPONENTS),function(){"use strict";COMPONENTS.factory("portalService",["$rootScope","pageService","crudService","constantsService","domService","metaService",function($rootScope,pageService,crudService,constantsService,domService,metaService){function loadPortal(pageId,callback){var bodyObj;bodyObj=$("body"),domService.addLoadingFeedback(bodyObj),crudService.get(constantsService.collections.portal,null,null,function(loadedPortal){var pageModel=pageService.getPage(pageId);domService.removeLoadingFeedback(bodyObj),portal=loadedPortal.results[0],updatePageDataFromTemplate(portal,pageModel.rows),pageService.setCurrentPage(pageModel),$rootScope.$broadcast("portalLoaded"),callback&&callback(portal)})}function getPortal(){return portal}function updatePortal(callback){var portalData;portalData=angular.copy(portal),delete portalData.user,updatePageDataFromTemplate(portalData,[]),crudService.update(constantsService.collections.portal,portalData._id,portalData,function(data){$rootScope.$broadcast("onPortalSaved"),setHeader(),callback&&callback(data)})}function updatePageDataFromTemplate(portal,pageData){portal.template.rows[1].columns[0].rows=pageData}function isRealFullscreen(){return"real"===portal.fullscreenMode}function isMaximizedFullscreen(){return"maximized"===portal.fullscreenMode}function isTemplateFullscreen(){return"template"===portal.fullscreenMode}function setHeader(){metaService.setHeader(portal.title,portal.faviconId)}function trackAnalytics(){metaService.trackAnalytics(portal.trackingCode)}var portal={};return{loadPortal:loadPortal,getPortal:getPortal,updatePortal:updatePortal,updatePageDataFromTemplate:updatePageDataFromTemplate,isRealFullscreen:isRealFullscreen,isMaximizedFullscreen:isMaximizedFullscreen,isTemplateFullscreen:isTemplateFullscreen,setHeader:setHeader,trackAnalytics:trackAnalytics}}])}(),function(){"use strict";COMPONENTS.factory("rateService",["crudService","constantsService",function(crudService,constantsService){function rate(rating,targetId,targetCollection,callback){var data={rating:rating,target:{id:targetId,collection:targetCollection}};crudService.rate(constantsService.collections.ratings,data,function(avgRating){callback&&callback(avgRating)})}return{rate:rate}}])}(),function(){"use strict";COMPONENTS.factory("roleService",["$rootScope","sessionService","crudService","constantsService",function($rootScope,sessionService,crudService,constantsService){function loadRoles(callback){var params={sort:{field:"karma",order:"1"}};crudService.get(constantsService.collections.roles,null,params,function(serverRoles){normalizeRoles(serverRoles),callback&&callback(getRoles())})}function getRoles(){return indexBasedRoles}function getRole(karma){return indexBasedRoles[karma]}function hasGuestRole(user){return user&&keyBasedRoles?user.role>=keyBasedRoles[constantsService.roles.guest].karma:!1}function hasReaderRole(user){return user&&keyBasedRoles?user.role>=keyBasedRoles[constantsService.roles.reader].karma:!1}function hasCreatorRole(user){return user&&keyBasedRoles?user.role>=keyBasedRoles[constantsService.roles.creator].karma:!1}function hasAdminRole(user){return user&&keyBasedRoles&&user?user.role>=keyBasedRoles[constantsService.roles.admin].karma:!1}function hasSuperAdminRole(user){return user&&keyBasedRoles&&user?user.role>=keyBasedRoles[constantsService.roles.superAdmin].karma:!1}function getCurrentUserAdminAccessStyleClass(){return hasAdminRole(sessionService.getUserSession())?"adminAccess":""}function normalizeRoles(serverRoles){keyBasedRoles=[],serverRoles.results.forEach(function(serverRole){keyBasedRoles[serverRole.code]={karma:serverRole.karma,title:serverRole.title,description:serverRole.description}}),indexBasedRoles=serverRoles.results}var keyBasedRoles,indexBasedRoles;return{loadRoles:loadRoles,getRoles:getRoles,getRole:getRole,hasGuestRole:hasGuestRole,hasReaderRole:hasReaderRole,hasCreatorRole:hasCreatorRole,hasAdminRole:hasAdminRole,hasSuperAdminRole:hasSuperAdminRole,getCurrentUserAdminAccessStyleClass:getCurrentUserAdminAccessStyleClass}}])}(),function(){"use strict";COMPONENTS.factory("sessionService",["$rootScope","$routeParams","ajaxService","objectService",function($rootScope,$routeParams,ajaxService,objectService){function loadUserSession(callback){ajaxService.ajax({url:"rest/getSession/",method:"POST",data:{},success:function(loadedUserSession){setUserSession(loadedUserSession),callback&&callback(getUserSession())}})}function getUserSession(){return userSession}function addSessionDataToModel(model){model.create.author=getUserSession(),delete model.create.authorId}function isUserLogged(){var userSession=getUserSession();return!objectService.isEmpty(userSession)}function logout(){window.open("logout","_self")}function setUserSession(loadedUserSession){userSession=loadedUserSession?loadedUserSession:null}var userSession;return{loadUserSession:loadUserSession,getUserSession:getUserSession,addSessionDataToModel:addSessionDataToModel,isUserLogged:isUserLogged,logout:logout}}])}(),function(){"use strict";COMPONENTS.factory("statsService",["crudService",function(crudService){function loadStats(collection,filter,callback){crudService.getStats(collection,filter,function(stats){callback&&callback(stats)})}return{loadStats:loadStats}}])}(),function(){"use strict";COMPONENTS.factory("tagService",["crudService","constantsService",function(crudService,constantsService){function loadTags(callback){crudService.get(constantsService.collections.tags,null,{},function(tagsObj){tags=tagsObj.results,callback&&callback(getTags())})}function createTag(text,callback){crudService.create(constantsService.collections.tags,{text:text},function(newTag){callback&&callback(newTag)})}function updateTag(tag,callback){var data={text:tag.text};crudService.update(constantsService.collections.tags,tag._id,data,function(updatedTag){callback&&callback(updatedTag)})}function getTags(){return tags}var tags;return{loadTags:loadTags,createTag:createTag,getTags:getTags,updateTag:updateTag}}])}(),function(){"use strict";COMPONENTS.factory("undeployService",["crudService",function(crudService){function undeploy(appObj,callback){crudService.undeployApp(appObj._id,appObj,function(){callback&&callback()})}return{undeploy:undeploy}}])}(),function(COMPONENTS){"use strict";COMPONENTS.factory("userService",["portalService","sessionService","crudService","$routeParams","constantsService",function(portalService,sessionService,crudService,$routeParams,constantsService){function loadUsers(callback){var params={projection:{password:0}};crudService.get(constantsService.collections.users,null,params,function(returnedUsers){users=returnedUsers.results,callback&&callback(getUsers())})}function getUsers(){return users}function createUser(user,callback){var data;user.fullName||user.email||user.password?(data={fullName:user.fullName,email:user.email,password:user.password,role:user.role,language:user.language,tags:user.tags},data.mediaId=user.media&&user.media._id?user.media._id:null,crudService.create(constantsService.collections.users,data,function(newUser){callback&&callback(newUser)})):callback&&callback({})}function updateUser(user,callback){var data;user.fullName||user.email||user.password?(data={fullName:user.fullName,email:user.email,role:user.role,language:user.language,tags:user.tags},data.mediaId=user.media&&user.media._id?user.media._id:null,user.password&&(data.password=user.password),crudService.update(constantsService.collections.users,user._id,data,function(updatedUser){callback&&callback(updatedUser)})):callback&&callback({})}var users;return{loadUsers:loadUsers,getUsers:getUsers,createUser:createUser,updateUser:updateUser}}])}(window.COMPONENTS),function(){"use strict";COMPONENTS.factory("addAppService",["domService",function(domService){function showAddAppPanel(){var addAppPanelObj=$("#addAppPanel"),wrapperObj=$("ul.pages"),collapsedViewObj=$("> .collapsedView",addAppPanelObj),wrapperMarginLeft=domService.getDomPercent(wrapperObj,"margin-left"),wrapperWidth=domService.getDomPercent(wrapperObj,"width"),addAppPanelWidth=domService.getDomPercent(collapsedViewObj,"width");addAppPanelActive=!0,wrapperObj.animate({width:wrapperWidth-addAppPanelWidth+"%",marginLeft:addAppPanelWidth+wrapperMarginLeft+"%",overflow:"visible"},window.speed,function(){}),addAppPanelObj.attr("state","collapsed")}function hideAddAppPanel(){var addAppPanelObj=$("#addAppPanel"),wrapperObj=$("ul.pages"),collapsedViewObj=$("> .collapsedView",addAppPanelObj),wrapperMarginLeft=domService.getDomPercent(wrapperObj,"margin-left"),wrapperWidth=domService.getDomPercent(wrapperObj,"width"),addAppPanelWidth=domService.getDomPercent(collapsedViewObj,"width");addAppPanelActive&&(addAppPanelActive=!1,wrapperObj.animate({width:wrapperWidth+addAppPanelWidth+"%",marginLeft:wrapperMarginLeft-addAppPanelWidth+"%"},window.speed,function(){}),addAppPanelObj.attr("state","hidden"))}function toggleAddAppPanel(){addAppPanelActive?hideAddAppPanel():showAddAppPanel()}function isAddAppPanelActive(){return addAppPanelActive}var addAppPanelActive=!1;return{showAddAppPanel:showAddAppPanel,hideAddAppPanel:hideAddAppPanel,toggleAddAppPanel:toggleAddAppPanel,isAddAppPanelActive:isAddAppPanelActive}}])}(),function(){"use strict";COMPONENTS.factory("appService",["$rootScope","$location","portalService","pageService","rowService","colService","arrayService","keyboardService",function($rootScope,$location,portalService,pageService,rowService,colService,arrayService,keyboardService){function enableFullscreen(element,_id,currentSize,onResize){isFullscreen()||($("html").addClass("fullscreen"),fullscreen=!0,portalService.isRealFullscreen()?enableRealFullscreen(element,onResize):portalService.isMaximizedFullscreen()?enableMaximizedFullscreen(element,_id):portalService.isTemplateFullscreen()&&enableTemplateFullscreen(element,_id,currentSize),triggerOnResizeEvent(onResize),registerKeyboardEvents(element,onResize))}function disableFullscreen(element,onResize){$("html").removeClass("fullscreen"),fullscreen=!1,portalService.isRealFullscreen()?disableRealFullscreen(element):portalService.isMaximizedFullscreen()?disableMaximizedFullscreen(element):portalService.isTemplateFullscreen()&&disableTemplateFullscreen(element),triggerOnResizeEvent(onResize),unregisterKeyboardEvents()}function isFullscreen(){return fullscreen}function triggerOnResizeEvent(onResizeEvent){onResizeEvent&&setTimeout(function(){onResizeEvent()},100)}function deleteApp(appElm,appIndex){var columnScope=angular.element(appElm.closest(".columns")).scope(),apps=columnScope.column.apps,rowScope=columnScope.$parent,columns=rowScope.row.columns,rows=rowService.getWrappingRows(rowScope,portalService.getPortal().template.rows);arrayService.delete(apps,appIndex),0===apps.length&&(colService.deleteColAndDependencies(columns,columnScope.$index),1!==columns.length||rowService.isTemplateRow(rowScope.row)||rowService.deleteRowAndDependencies(rows,rowScope.$index)),pageService.updateCurrentPage(null),portalService.updatePortal(null)}function enableRealFullscreen(element,onResize){$("html").addClass("appRealFullscreen"),element.addClass("realFullscreen"),element.fullScreen(!0),$(document).bind("fullscreenchange",function(){$(document).fullScreen()||disableFullscreen(element,onResize)})}function disableRealFullscreen(element){$("html").removeClass("appRealFullscreen"),element.removeClass("realFullscreen"),element.fullScreen(!1),$(document).unbind("fullscreenchange")}function enableMaximizedFullscreen(element,_id){$("html").addClass("appMaximizedFullscreen"),element.addClass("maximizedFullscreen"),updateSearchId(_id)}function disableMaximizedFullscreen(element){$("html").removeClass("appMaximizedFullscreen"),element.removeClass("maximizedFullscreen"),updateSearchId(null)}function enableTemplateFullscreen(element,_id,currentSize){var columns=element.closest(".columns");columns.addClass("colFullscreen large-23"),columns.prev(".columns").addClass("colFullscreen"),columns.next(".columns").addClass("colFullscreen"),previousSize=currentSize,$("html").addClass("appTemplateFullscreen"),element.addClass("templateFullscreen"),updateSearchId(_id)}function disableTemplateFullscreen(element){$(".colFullscreen.large-23").removeClass("large-23").addClass("large-"+previousSize),$(".colFullscreen").removeClass("colFullscreen"),$("html").removeClass("appTemplateFullscreen"),element.removeClass("templateFullscreen"),updateSearchId(null)}function registerKeyboardEvents(element,onResize){keyboardService.register("esc",directiveId,function(){disableFullscreen(element,onResize),$rootScope.$apply()})}function unregisterKeyboardEvents(){keyboardService.unregister("esc",directiveId)}function updateSearchId(_id){$location.search("_id",_id)}var fullscreen,previousSize,directiveId="app";return{enableFullscreen:enableFullscreen,disableFullscreen:disableFullscreen,isFullscreen:isFullscreen,triggerOnResizeEvent:triggerOnResizeEvent,deleteApp:deleteApp}}])}(),function(){"use strict";COMPONENTS.factory("resizableAppService",["portalService","pageService","rowService",function(portalService,pageService,rowService){function start(resizingDomObj,event){var row=resizingDomObj.closest(".rows"),size=row.width()/cols;previousSize=resizingDomObj.width(),resizingColumnScope=angular.element(resizingDomObj).scope(),setAffectedColumn(resizingDomObj,event),resizingDomObj.resizable("option","grid",size)}function resize(resizingDomObj){var hasBeenReduced=resizingDomObj.width()<previousSize;affectedColumn&&setNewColSizes(hasBeenReduced),previousSize=resizingDomObj.width(),resizingDomObj.removeAttr("style"),resizingColumnScope.$parent.$apply(),pageService.updateCurrentPage(null),portalService.updatePortal(null)}function setAffectedColumn(resizingDomObj,event){var index=resizingColumnScope.$index;event.clientX>resizingDomObj.offset().left+resizingDomObj.width()/2?setNextAffectedColumn(index):setPrevAffectedColumn(index)}function setNextAffectedColumn(resizingColumnIndex){var nextColumn=resizingColumnScope.$parent.row.columns[resizingColumnIndex+1];affectedColumn=shouldResizeNextColumn(resizingColumnIndex,nextColumn)?nextColumn:resizingColumnScope.$parent.row.columns[resizingColumnIndex+2]}function setPrevAffectedColumn(resizingColumnIndex){var prevColumn=resizingColumnScope.$parent.row.columns[resizingColumnIndex-1];affectedColumn=shouldResizePrevColumn(resizingColumnIndex,prevColumn)?prevColumn:resizingColumnScope.$parent.row.columns[resizingColumnIndex-2]}function shouldResizePrevColumn(resizingColumnIndex,prevColumn){return 1===resizingColumnIndex||prevColumn.size>1}function shouldResizeNextColumn(resizingColumnIndex,nextColumn){return resizingColumnIndex===resizingColumnScope.$parent.row.columns.length-2||nextColumn.size>1}function setNewColSizes(hasBeenReduced){hasBeenReduced&&resizingColumnScope.column.size>1?(resizingColumnScope.column.size=resizingColumnScope.column.size-1,affectedColumn.size=affectedColumn.size+1):affectedColumn.size>1&&(resizingColumnScope.column.size=resizingColumnScope.column.size+1,affectedColumn.size=affectedColumn.size-1)}var previousSize,resizingColumnScope,affectedColumn,cols=rowService.getMaxSlots();return{start:start,resize:resize}}])}(),function(){"use strict";COMPONENTS.factory("sortableAppService",["$rootScope","$timeout","portalService","pageService","rowService","colService","arrayService","keyboardService","timerService",function($rootScope,$timeout,portalService,pageService,rowService,colService,arrayService,keyboardService,timerService){function start(ui){$("html").addClass("sorting"),originalElm=$(ui.item).parent(),isUpdateBlocked=!$(ui.item).hasClass("new"),registerKeyboardEvents()}function update(ui){setOptions(originalElm,$(ui.item)),isUpdateTime()&&(updateIfThereIsSpace(),$rootScope.$$phase||$rootScope.$apply()),isUpdateBlocked=!1}function stop(){unregisterKeyboardEvents(),$("html").removeClass("sorting")}function isUpdateTime(){return colService.areSameCol(options.originalCol,options.dropCol)||!isUpdateBlocked||options.isNewItem}function registerKeyboardEvents(){keyboardService.register("esc","sortableApp",function(){$("[sortable-app]").trigger("mouseup")})}function unregisterKeyboardEvents(){keyboardService.unregister("esc","sortableApp")}function updateIfThereIsSpace(){rowService.isAvailableSpaceInRow(options.dropRow,options.dropCol,options.affectedDropCol)?$timeout(function(){executeUpdate()},0):blockUpdate()}function setOptions(originalElm,droppedElm){var wrappingRows=portalService.getPortal().template.rows;return options={},options.isNewItem=void 0!==droppedElm.attr("sortable-add-app"),options.wrapperOriginalRowScope=angular.element(originalElm.closest(".rows")).scope(),options.wrapperDropRowScope=angular.element(droppedElm.closest(".rows")).scope(),options.originalRows=rowService.getWrappingRows(options.wrapperOriginalRowScope,wrappingRows),options.dropRows=rowService.getWrappingRows(options.wrapperDropRowScope,wrappingRows),options.droppedElm=droppedElm,options.originalColIndex=originalElm.closest(".columns").prevAll(".columns").size(),options.dropColIndex=droppedElm.closest(".columns").prevAll(".columns").size(),options.originalRowIndex=originalElm.closest(".rows").prevAll(".rows").size(),options.originalAppIndex=originalElm.prevAll(".app").size(),options.dropRowIndex=droppedElm.closest(".rows").prevAll(".rows").size(),options.dropAppIndex=droppedElm.prevAll(".app").size(),options.originalRow=originalElm.closest(".rows").scope().row,options.dropRow=droppedElm.closest(".rows").scope().row,options.dropCol=options.dropRow.columns[options.dropColIndex],options.originalCol=options.originalRow.columns[options.originalColIndex],options.elmHasChangedRow=options.originalRow.$$hashKey!==options.dropRow.$$hashKey,options.affectedDropCol=colService.getAffectedCol(options.dropRow.columns,options.dropColIndex),options.affectedOriginalCol=options.elmHasChangedRow?colService.getAffectedCol(options.originalRow.columns,options.originalColIndex):options.affectedDropCol,options}function blockUpdate(){deleteNewDroppedElm(options.dropCol,options.droppedElm,options.dropAppIndex),$timeout(function(){arrayService.delete(options.dropCol.apps,options.dropAppIndex)})}function executeUpdate(){options.isNewItem&&deleteNewDroppedElm(options.dropCol,options.droppedElm,options.dropAppIndex),updateConsideringRowChange(),decorateDropRow(),deleteGhostApp(),pageService.updateCurrentPage(null),portalService.updatePortal(null)}function updateConsideringRowChange(){(options.isNewItem||1===options.dropCol.apps.length||0===options.originalCol.apps.length)&&(options.isNewItem||options.elmHasChangedRow?updateWithRowChange():updateWithoutRowChange())}function updateWithRowChange(){rowService.isDropRowEmpty(options.dropRow)&&!rowService.isTemplateRow(options.wrapperDropRowScope.row)&&addEmptyRows(),options.affectedDropCol&&options.dropCol.apps.length>0?updateWithRowChangeNonEmptyOriginalColumn():options.affectedOriginalCol&&updateWithRowChangeEmptyOriginalColumn()}function updateWithRowChangeEmptyOriginalColumn(){var availableWidth=options.affectedOriginalCol.size+options.originalCol.size;options.affectedOriginalCol.size=availableWidth+1}function updateWithRowChangeNonEmptyOriginalColumn(){var availableWidth=options.dropCol.size+options.affectedDropCol.size;options.dropCol.size=Math.ceil(availableWidth/2)+1,options.affectedDropCol.size=Math.floor(availableWidth/2)-1,options.affectedOriginalCol&&!options.originalCol.apps.length&&(availableWidth=options.affectedOriginalCol.size+options.originalCol.size,options.affectedOriginalCol.size=availableWidth+1)}function updateWithoutRowChange(){options.affectedDropCol&&options.originalCol.apps.length?updateWithoutRowChangeNonEmptyOriginalColumn():updateWithoutRowChangeEmptyOriginalColumn()}function updateWithoutRowChangeEmptyOriginalColumn(){var availableWidth=options.dropCol.size+options.originalCol.size;options.dropCol.size=availableWidth+1}function updateWithoutRowChangeNonEmptyOriginalColumn(){var availableWidth=options.dropCol.size+options.affectedDropCol.size;options.affectedDropCol.$$hashKey!==options.dropCol.$$hashKey&&(options.dropCol.size=Math.ceil(availableWidth/2)+1,options.affectedDropCol.size=Math.floor(availableWidth/2)-1)}function addEmptyRows(){rowService.addEmptyRow(options.dropRows,options.dropRowIndex),rowService.addEmptyRow(options.dropRows,options.dropRowIndex+2),options.dropRowIndex<options.originalRowIndex&&(options.originalRowIndex+=2)}function decorateDropRow(){1===options.dropCol.apps.length&&colService.addEmptyCols(options.dropRow,options.dropCol,options.dropColIndex),colService.normalizeEmptyCols(options.originalRow),rowService.isOriginalRowEmpty(options.originalRow)&&!rowService.isTemplateRow(options.wrapperOriginalRowScope.row)&&rowService.deleteRowAndDependencies(options.originalRows,options.originalRowIndex)}function deleteGhostApp(){options.droppedElm.siblings("[app]:not(:empty)").size()+1>options.dropCol.apps.length&&options.droppedElm.remove()}function deleteNewDroppedElm(dropCol,droppedElm,dropAppIndex){dropCol.apps.forEach(function(item,index){item||arrayService.delete(dropCol.apps,index)}),arrayService.add(dropCol.apps,{type:droppedElm.attr("type"),id:timerService.getRandomNumber()},dropAppIndex),droppedElm.remove()}var originalElm,options,isUpdateBlocked=!1;return{start:start,update:update,stop:stop}}])}(),function(){"use strict";COMPONENTS.factory("emailService",["ajaxService",function(ajaxService){function validateEmail(email){var re=/\S+@\S+\.\S+/;return re.test(email)}function sendEmail(data,callback){ajaxService.ajax({url:"rest/sendEmail",method:"POST",data:data,success:function(response){callback&&callback(response)}})}return{validateEmail:validateEmail,sendEmail:sendEmail}}])}(),function(io){"use strict";COMPONENTS.factory("liveMessageService",[function(){function sendPublicMessage(data,callback){socket.emit("publicMessage",data,function(result){callback&&callback(result)})}var socket=io.connect(window.location.origin);return socket.on("publicMessageReceived",function(data){alert("msg received"+data.text+" - "+data.details)}),{sendPublicMessage:sendPublicMessage}}])}(window.io),function(){"use strict";COMPONENTS.factory("contentEditableRichContentService",["contentEditableService","editBoxUtilsService","textSelectionService","tooltipService","styleService",function(contentEditableService,editBoxUtilsService,textSelectionService,tooltipService,styleService){function showEditBox(cEScope,cEDomObj,ngModelCtrl){if(cEScope.isEditable()&&textSelectionService.isSelection()){var selectedTextDomObj=textSelectionService.getSelectedTextDomObj(),defaultPanels=[{title:"Content",type:"richContent"}];cEScope.model=styleService.getComputedStyleInRange(cEDomObj,selectedTextDomObj),forceTextSelection(),cEScope.panels=cEScope.customPanels?cEScope.customPanels:defaultPanels,cEScope.onSave=function(){onSaveEditBox(cEScope,cEDomObj,ngModelCtrl)},cEScope.onCancel=function(){onCancelEditBox(cEScope)},cEScope.onChange=function(){onChangeEditBox(cEScope,cEDomObj,ngModelCtrl,cEScope.model)},editBoxUtilsService.showEditBox(cEScope,cEDomObj,selectedTextDomObj),cEScope.showActions=!0}}function onSaveEditBox(cEScope,cEDomObj,ngModelCtrl){setLinkTitles(cEScope),textSelectionService.removeSelection(),contentEditableService.updateValue(cEScope,cEDomObj,ngModelCtrl),contentEditableService.propagateChanges(cEScope)}function onCancelEditBox(cEScope){textSelectionService.removeSelection(),contentEditableService.propagateChanges(cEScope)}function onChangeEditBox(cEScope,cEDomObj,ngModelCtrl,styles){textSelectionService.restoreSelection(),textSelectionService.setStylesToSelection(styles),contentEditableService.updateValue(cEScope,cEDomObj,ngModelCtrl)}function forceTextSelection(){textSelectionService.setFakeSelection(),textSelectionService.saveSelection()}function setLinkTitles(cEScope){var selLinkDomObj=textSelectionService.getSelectedLink(),newTitle=selLinkDomObj.attr("title");
selLinkDomObj.size()&&(tooltipService.exists(selLinkDomObj)?updateLinkTitle(selLinkDomObj,newTitle):contentEditableService.compileElement(cEScope,selLinkDomObj),tooltipService.backupTitle(selLinkDomObj,newTitle))}function updateLinkTitle(linkObj,newTitle){tooltipService.setTitle(newTitle,linkObj,!0),linkObj.removeAttr("title")}return{showEditBox:showEditBox}}])}(),function(){"use strict";COMPONENTS.factory("contentEditableSelectMediaService",["contentEditableService","editBoxUtilsService","mediaService",function(contentEditableService,editBoxUtilsService,mediaService){function showEditBox(cEScope,cEDomObj,sMDomObj,ngModelCtrl){var defaultPanels=[{title:"Select media",type:"selectMedia"}];cEScope.isEditable()&&(unselectItem($("img.active",cEDomObj)),editBoxUtilsService.hideEditBox(cEScope.$id),cEScope.internalData={mediaSize:getMediaSize(sMDomObj)},selectItem(sMDomObj),cEScope.panels=defaultPanels,cEScope.onSave=function(){onSaveEditBox(cEScope,cEDomObj,sMDomObj,ngModelCtrl)},cEScope.onCancel=function(){onCancelEditBox(sMDomObj)},cEScope.onChange=function(model,id,sMData){onChangeEditBox(cEScope,sMDomObj,sMData)},editBoxUtilsService.showEditBox(cEScope,cEDomObj,sMDomObj),cEScope.showActions=!0)}function onSaveEditBox(cEScope,cEDomObj,sMDomObj,ngModelCtrl){unselectItem(sMDomObj),contentEditableService.updateValue(cEScope,cEDomObj,ngModelCtrl),contentEditableService.propagateChanges(cEScope)}function onCancelEditBox(sMDomObj){unselectItem(sMDomObj)}function onChangeEditBox(cEScope,sMDomObj,sMData){setMediaSrc(sMDomObj,sMData),setMediaSize(sMDomObj,cEScope.internalData.mediaSize)}function selectItem(domObj){domObj.addClass("active")}function unselectItem(domObj){domObj.removeClass("active")}function setMediaSrc(sMDomObj,sMData){sMData&&sMDomObj.attr("src",mediaService.getDownloadUrl(sMData))}function setMediaSize(sMDomObj,mediaSize){sMDomObj.attr("size",mediaSize)}function getMediaSize(sMDomObj){return sMDomObj.attr("size")}return{showEditBox:showEditBox}}])}(),function(){"use strict";COMPONENTS.factory("contentEditableService",["$compile","$timeout","editBoxUtilsService",function($compile,$timeout,editBoxUtilsService){function updateValue(cEScope,cEDomObj,ngModelCtrl){"<br>"===cEDomObj.html()&&cEDomObj.html(""),cEScope.content=cEDomObj.html(),handlePlaceholder(cEScope),ngModelCtrl.$setViewValue(cEScope.content),cEScope.uxChange&&cEScope.uxChange()}function propagateChanges(cEScope){$timeout(function(){editBoxUtilsService.isAnyEditBoxVisible()||(cEScope.showActions=!1,cEScope.onBlur&&cEScope.onBlur())},250)}function handlePlaceholder(cEScope){cEScope.showPlaceholder=void 0===cEScope.content||""===cEScope.content}function compileElement(cEScope,elmObj){$compile(elmObj)(cEScope)}return{updateValue:updateValue,propagateChanges:propagateChanges,handlePlaceholder:handlePlaceholder,compileElement:compileElement}}])}(),function(){"use strict";COMPONENTS.factory("globalMsgService",[function(){function show(text,details){onShowObservers.forEach(function(onShowObserver){onShowObserver(text,details)})}function hide(){onHideObservers.forEach(function(onHideObserver){onHideObserver()})}function onShow(observer){onShowObservers.push(observer)}function onHide(observer){onHideObservers.push(observer)}var onShowObservers=[],onHideObservers=[];return{show:show,hide:hide,onShow:onShow,onHide:onHide}}])}(),function(){"use strict";COMPONENTS.factory("loadingService",[function(){function start(){NProgress.start()}function done(){NProgress.done()}return NProgress.configure({trickleRate:.1,trickleSpeed:0}),{start:start,done:done}}])}(),function(){"use strict";COMPONENTS.factory("stdService",["globalMsgService",function(globalMsgService){function warn(text,details){console.warn("[WARN] "+text,details)}function error(text,details){console.error("[ERROR] "+text,details),globalMsgService.show(text,details)}function todo(text){console.log("[TODO] "+text)}return{warn:warn,error:error,todo:todo}}])}(),function(){"use strict";COMPONENTS.factory("tooltipService",["i18nService","i18nDbService",function(i18nService,i18nDbService){function initialize(element,title,customOptions,isHtml){element.powerTip(customOptions),setTitle(title,element,isHtml),element.removeAttr("title")}function show(element){exists(element)&&$.powerTip.show(element)}function hide(){try{$.powerTip.hide(null,!0)}catch(e){}}function onClose(element,callback){element.on({powerTipClose:function(){callback&&callback()}})}function getDefaults(){return{smartPlacement:!0,fadeInTime:0,fadeOutTime:0,closeDelay:200,mouseOnToPopup:!0}}function exists(element){return element.data("powertip")}function backupTitle(element,title){element.attr("backup-title",title)}function setTitle(newTitle,element,isHtml){var hasI18nTitle=element.attr("i18n-title"),hasI18nDbTitle=element.attr("i18n-db-title");if(isHtml)element.data("powertip",newTitle);else if(void 0!==hasI18nTitle)element.data("powertip",i18nService(newTitle));else if(void 0!==hasI18nDbTitle)try{element.data("powertip",i18nDbService.getI18nProperty(jQuery.parseJSON(newTitle)).text)}catch(ex){element.data("powertip",newTitle)}else element.data("powertip",newTitle)}return{initialize:initialize,show:show,hide:hide,onClose:onClose,getDefaults:getDefaults,exists:exists,backupTitle:backupTitle}}])}(),function(){"use strict";COMPONENTS.factory("i18nDbService",["i18nService","objectService",function(i18nService,objectService){function getI18nProperty(obj){var currentLanguage=i18nService.getCurrentLanguage(),defaultLanguage=i18nService.getDefaultLanguage();return obj&&objectService.isObject(obj)?obj[currentLanguage]||obj[defaultLanguage]:{text:obj}}function hasI18nStructure(obj){var currentLanguage=i18nService.getCurrentLanguage();return obj&&void 0!==obj[currentLanguage]}function setInitI18nStructure(obj){var objText=obj;return obj={},obj[i18nService.getDefaultLanguage()]={text:objText},obj}return{getI18nProperty:getI18nProperty,hasI18nStructure:hasI18nStructure,setInitI18nStructure:setInitI18nStructure}}])}(),function(){"use strict";COMPONENTS.factory("i18nService",["$rootScope","crudService","constantsService",function($rootScope,crudService,constantsService){function getBrowserLanguage(){return(navigator.language||navigator.userLanguage).split("-")[0]}function i18n(){return $.i18n.prop.apply($.i18n,arguments)}var languages,userLanguage=getBrowserLanguage(),defaultLanguage="en",settings={name:"messages",path:"/client/messages/",mode:"map",language:userLanguage,callback:function(){}};return $.i18n.properties(settings),i18n.loadLanguages=function(callback){crudService.get(constantsService.collections.languages,null,{},function(loadedLanguages){languages=loadedLanguages.results,callback&&callback(i18n.getLanguages())})},i18n.getLanguages=function(){return languages},i18n.getCurrentLanguage=function(){return settings.language},i18n.getDefaultLanguage=function(){return defaultLanguage},i18n.changeLanguage=function(langCode){langCode!==settings.language&&(settings.language=langCode,$.i18n.properties(settings),$rootScope.$broadcast("languageChanged",langCode))},i18n}])}(),function(){"use strict";COMPONENTS.factory("colService",["$rootScope","rowService","arrayService",function($rootScope,rowService,arrayService){function normalizeEmptyCols(row){for(var i=0;i<row.columns.length;i+=1)normalizeEmptyCol(row.columns,i)&&normalizeEmptyCols(row);1===row.columns.length&&(row.columns[0].size=rowService.getMaxSlots())}function addEmptyCols(dropRow,dropCol,dropColIndex){arrayService.add(dropRow.columns,getEmptyCol(),dropColIndex),arrayService.add(dropRow.columns,getEmptyCol(),dropColIndex+2),dropCol.size=dropCol.size-=2}function deleteColAndDependencies(columns,columnIndex){var availableWidth,affectedCol=getAffectedCol(columns,columnIndex);affectedCol&&(availableWidth=columns[columnIndex].size+affectedCol.size,affectedCol.size=availableWidth+1),arrayService.delete(columns,columnIndex),arrayService.delete(columns,columnIndex),affectedCol||(columns[0].size=rowService.getMaxSlots())}function getAffectedCol(columns,dropColIndex){var affectedDropCol;return affectedDropCol=getAffectedNextCol(columns,dropColIndex),affectedDropCol||(affectedDropCol=getAffectedPrevCol(columns,dropColIndex)),affectedDropCol}function getEmptyCol(){return{size:1,apps:[]}}function areSameCol(column1,column2){return column1.$$hashKey===column2.$$hashKey}function getAffectedNextCol(columns,dropColIndex){var affectedDropCol,i;for(i=dropColIndex+1;i<columns.length;i+=1)if(columns[i].size>=3){affectedDropCol=columns[i];break}return affectedDropCol}function getAffectedPrevCol(columns,dropColIndex){var affectedDropCol,i;for(i=dropColIndex-1;i>=0;i-=1)if(columns[i].size>=3){affectedDropCol=columns[i];break}return affectedDropCol}function normalizeEmptyCol(cols,colIndex){var col=cols[colIndex],nextCol=cols[colIndex+1];return 0===col.apps.length&&col.size>1&&(col.size=1),nextCol&&0===col.apps.length&&0===nextCol.apps.length?(arrayService.delete(cols,colIndex),!0):null}return{normalizeEmptyCols:normalizeEmptyCols,addEmptyCols:addEmptyCols,deleteColAndDependencies:deleteColAndDependencies,getAffectedCol:getAffectedCol,getEmptyCol:getEmptyCol,areSameCol:areSameCol}}])}(),function(){"use strict";COMPONENTS.factory("rowService",["arrayService",function(arrayService){function getMaxSlots(){return maxSlots}function isAvailableSpaceInRow(dropRow,dropCol,affectedDropCol){return affectedDropCol||1===dropRow.columns.length||dropCol.apps.length>1}function isOriginalRowEmpty(originalRow){return 1===originalRow.columns.length&&0===originalRow.columns[0].apps.length}function isDropRowEmpty(dropRow){return 1===dropRow.columns.length&&1===dropRow.columns[0].apps.length}function addRowAndDependencies(rows,newRowPos){var newRow={columns:[{size:1,apps:[]},{size:getMaxSlots()-2,apps:[{type:"menuApp"}]},{size:1,apps:[]}]};arrayService.add(rows,newRow,newRowPos),addEmptyRow(rows,newRowPos+1)}function addEmptyRow(rows,dropRowIndex){arrayService.add(rows,getEmptyRow(),dropRowIndex)}function getEmptyRow(){return{columns:[{size:getMaxSlots(),apps:[]}]}}function deleteRowAndDependencies(rows,rowIndex){rows.length>1&&arrayService.delete(rows,rowIndex),rows.length>1&&arrayService.delete(rows,rowIndex)}function getWrappingRows(rowScope,rows){return rowScope.row.template?rows:rows[1].columns[0].rows}function isTemplateRow(row){return row.template}var maxSlots=25;return{getMaxSlots:getMaxSlots,isAvailableSpaceInRow:isAvailableSpaceInRow,isOriginalRowEmpty:isOriginalRowEmpty,isDropRowEmpty:isDropRowEmpty,addRowAndDependencies:addRowAndDependencies,addEmptyRow:addEmptyRow,getEmptyRow:getEmptyRow,deleteRowAndDependencies:deleteRowAndDependencies,getWrappingRows:getWrappingRows,isTemplateRow:isTemplateRow}}])}(),function(){"use strict";COMPONENTS.factory("listDbService",["$injector","crudService","dbService","i18nService","stringService",function($injector,crudService,dbService,i18nService,stringService){function loadList(options,callback){var filter={q:{$and:[{$or:getFilterOptions(options.searchText,options.searchTargets)},{$or:getTagOptions(options.tags)}]},currentPage:options.currentPage,pageSize:options.pageSize,skip:options.skip,sort:options.sort,projection:options.projection};crudService.get(options.collection,null,filter,function(list){callback&&callback(list)})}function createItem(collection,item){var collectionService=$injector.get(collection+"Service"),createFn="create"+stringService.capitalize(collection);collectionService[createFn]?collectionService[createFn](item):crudService.create(collection,item)}function deleteItem(collection,itemId){crudService.delete(collection,itemId,null)}function getFilterOptions(searchText,searchTargets){var filterOptions=[],currentLanguage=i18nService.getCurrentLanguage(),inexactSelector=dbService.getInexactSelector(searchText);return searchTargets.forEach(function(searchTarget){var i18nSearchTarget,filterOption={},i18nFilterOption={};filterOption[searchTarget]=inexactSelector,filterOptions.push(filterOption),i18nSearchTarget=searchTarget+"."+currentLanguage+".text",i18nFilterOption[i18nSearchTarget]=inexactSelector,filterOptions.push(i18nFilterOption)}),filterOptions}function getTagOptions(tags){var tagOptions=[];return tags&&tags.forEach(function(tag){tagOptions[tagOptions.length]={tag:tag}}),tagOptions}return{loadList:loadList,createItem:createItem,deleteItem:deleteItem}}])}(),function(){"use strict";COMPONENTS.factory("listSelectService",["$rootScope","$location","listService","editBoxUtilsService","arrayService",function($rootScope,$location,listService,editBoxUtilsService,arrayService){function clickOnItem(listScope,element,item,$index,$event,editOnSelect){listScope.isSelectable()||listScope.isEditable()?handleDefaultSelectionMechanism(listScope,element,item,editOnSelect,$event):handleNavigationMechanism(listScope,item),handleCustomSelectionMechanism(listScope,item,$index)}function selectItem(listScope,item){listScope.isMultiSelectable()?(listScope.selectedIds||(listScope.selectedIds=[]),item.isSelected||listScope.selectedIds.push(item._id)):listScope.isSingleSelectable()&&(listScope.selectedIds=item._id,listScope.lastSelectedItem&&(listScope.lastSelectedItem.isSelected=!1)),listScope.lastSelectedItem=item,item.isSelected=!0,$rootScope.$$phase||listScope.$apply()}function unselectItem(listScope,item){listScope.isMultiSelectable()?item.isSelected&&dropFromSelectedList(listScope,item._id):listScope.isSingleSelectable()&&(listScope.selectedIds=null),item.isSelected=!1,$rootScope.$$phase||listScope.$apply()}function dropFromSelectedList(listScope,id){var itemSelectedPos=getItemSelectedPos(listScope,id);void 0!==itemSelectedPos&&arrayService.delete(listScope.selectedIds,itemSelectedPos)}function handleDefaultSelectionMechanism(listScope,element,item,editOnSelect,$event){item.isSelected?$event&&editBoxUtilsService.isEditBoxClicked($event)||(listScope.unselect(item),listScope.isEditable()&&hideEditBox()):(listScope.select(item),listScope.isEditable()&&editOnSelect&&showEditBox(listScope,element,item))}function handleCustomSelectionMechanism(listScope,item){listScope.onSelect({$item:item})}function handleNavigationMechanism(listScope,item){listService.setDetailId(listScope,item._id),$location.search("detailId",item._id)}function getItemSelectedPos(listScope,itemId){var i,itemSelectedPos=null;if(listScope.selectedIds)for(i=0;i<listScope.selectedIds.length;i+=1)if(listScope.selectedIds[i]===itemId){itemSelectedPos=i;break}return itemSelectedPos}function showEditBox(listScope,element,item){var targetObj=$("#"+item._id+" > *:first-child",element);hideEditBox(),listScope.panels=listScope.onEditPanels,listScope.model=item,listScope.onSave=function(){listScope.onEdit({$item:listScope.model})},listScope.onClose=function(){listScope.unselect(item)},editBoxUtilsService.showEditBox(listScope,targetObj,targetObj)}function hideEditBox(){editBoxUtilsService.hideEditBox(null)}return{clickOnItem:clickOnItem,selectItem:selectItem,unselectItem:unselectItem,dropFromSelectedList:dropFromSelectedList}}])}(),function(){"use strict";COMPONENTS.factory("listService",[function(){function getDefaultValue(prop,config){return void 0!==config[prop]?config[prop]:defaultOptions[prop]}function setDetailId(listScope,detailId){listScope.detailId=detailId}var defaultOptions={pageSize:10,skip:0,pageActionPos:2,searchable:!0,sort:{field:"create.date",order:"1"}};return{setDetailId:setDetailId,getDefaultValue:getDefaultValue}}])}(),function(Array){"use strict";COMPONENTS.factory("arrayService",[function(){function isArray(obj){return obj instanceof Array}function add(array,element,index){return array.splice(index,0,element),array}function copy(sourceArray,startIndex,length){var i,destArray=[];for(startIndex=startIndex||0,length=length||sourceArray.length,i=startIndex;startIndex+length>i;i+=1)destArray.push(sourceArray[i]);return destArray}function move(array,oldIndex,newIndex){if(newIndex>=array.length)for(var k=newIndex-array.length;(k-=1)+1;)array.push(void 0);return array.splice(newIndex,0,array.splice(oldIndex,1)[0]),array}function remove(array,index){return array.splice(index,1),array}return{isArray:isArray,add:add,copy:copy,move:move,"delete":remove}}])}(window.Array),function(){"use strict";COMPONENTS.factory("canvasService",[function(){function getCoordinates(canvasObj,canvasElm){var scaleX=canvasElm.scaleX||1,scaleY=canvasElm.scaleY||1,canvasElmWidth=canvasElm.width*scaleX,canvasElmHeight=canvasElm.height*scaleY;return{top:canvasObj.offset().top+canvasElm.top-canvasElmHeight/2,left:canvasElm.left-canvasElmWidth/2,width:canvasElmWidth,height:canvasElmHeight}}return{getCoordinates:getCoordinates}}])}(),function(){"use strict";COMPONENTS.factory("caretService",["timerService",function(timerService){function insertImage(url,contentEditableObj,onClickFn){var id=timerService.getRandomNumber(),clickFn=onClickFn?'ng-click="'+onClickFn+"("+id+")":"";return insertHtml('<img id="'+id+'" src="'+url+'" '+clickFn+'"/>',contentEditableObj),id}function insertHtml(html,contentEditableObj){contentEditableObj.focus(),pasteHtml(html,!1)}function pasteHtml(html,selectPastedContent){var sel,range;if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0),range.deleteContents();var el=document.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=document.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);var firstNode=frag.firstChild;range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),selectPastedContent?range.setStartBefore(firstNode):range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else if((sel=document.selection)&&"Control"!=sel.type){var originalRange=sel.createRange();originalRange.collapse(!0),sel.createRange().pasteHTML(html),range=sel.createRange(),range.setEndPoint("StartToStart",originalRange),range.select()}}return{insertImage:insertImage}}])}(),function(COMPONENTS){"use strict";COMPONENTS.factory("dateService",[function(){function getFormattedDate(date){function normalizeDateToken(token){return("0"+token).slice(-2)}var dateObj,day,month,year;return dateObj=new Date(date),day=normalizeDateToken(dateObj.getDate()),month=normalizeDateToken(dateObj.getMonth()+1),year=dateObj.getFullYear(),day+"-"+month+"-"+year}return{getFormattedDate:getFormattedDate}}])}(window.COMPONENTS),function(){"use strict";COMPONENTS.factory("domService",[function(){function getCoordinates(obj){return{top:obj.position().top,left:obj.position().left,width:obj.outerWidth(),height:obj.outerHeight()}}function getObjPadding(obj){return{top:parseInt(obj.css("paddingTop"),10),right:parseInt(obj.css("paddingRight"),10),bottom:parseInt(obj.css("paddingBottom"),10),left:parseInt(obj.css("paddingLeft"),10)}}function getObjBorderWidth(obj){return{top:parseInt(obj.css("borderTopWidth"),10),right:parseInt(obj.css("borderRightWidth"),10),bottom:parseInt(obj.css("borderBottomWidth"),10),left:parseInt(obj.css("borderLeftWidth"),10)}}function getElementType(obj){return obj[0].tagName.toLowerCase()}function getDomPercent(dest,cssProperty){return dest instanceof jQuery||(dest=$(dest)),Math.round(100*parseInt(dest.css(cssProperty),10)/$("html").width())}function addLoadingFeedback(domObject){domObject.addClass("loading")}function removeLoadingFeedback(domObject){domObject.removeClass("loading")}function convertDomObjToStr(domObj){return $("<div>").append(domObj.clone()).html()}return{getCoordinates:getCoordinates,getObjPadding:getObjPadding,getObjBorderWidth:getObjBorderWidth,getElementType:getElementType,getDomPercent:getDomPercent,addLoadingFeedback:addLoadingFeedback,removeLoadingFeedback:removeLoadingFeedback,convertDomObjToStr:convertDomObjToStr}}])}(),function(){"use strict";COMPONENTS.factory("editBoxUtilsService",["$compile","domService","keyboardService",function($compile,domService,keyboardService){function showEditBox(scope,element,selectedDomObj){function setTargetSettings(){element.parent().css("position","relative"),scope.target={id:scope.$id,element:element,coordinates:selectedDomObj?domService.getCoordinates(selectedDomObj):domService.getCoordinates(element)}}function setArrowPos(){function isTargetObjLeftPlaced(){return selectedDomObj.offset().left+scope.target.coordinates.width/2<$(window).width()/2}scope.arrowPos=isTargetObjLeftPlaced()?"left":"right"}function addEditBoxToDom(){scope.model||(scope.model={});var editBoxObj,parentEditBoxObj;editBoxObj=$('<edit-box model="model" panels="panels" arrow-pos="arrowPos" internal-data="internalData" on-save="onSave()" on-change="onChange()" on-cancel="onCancel()" on-close="onClose()" target="target"></edit-box>'),parentEditBoxObj=element.closest(".editBox"),parentEditBoxObj.size()&&editBoxObj.addClass("child"),element.after(editBoxObj),$compile(editBoxObj)(scope)}function safeUnblockEditBox(){setTimeout(function(){isMoving||unblockHideEditBox()},100)}isEditBoxVisible(element)||(setTargetSettings(),setArrowPos(),blockHideEditBox(),addEditBoxToDom(),safeUnblockEditBox())}function hideEditBox(textBoxId){function unregisterKeyboardEvents(){keyboardService.unregister("esc",serviceId),keyboardService.unregister("left","edit"),keyboardService.unregister("right","edit")}isHideActionBlocked||(textBoxId?$("#editBox"+textBoxId).remove():$(".editBox").remove()),unregisterKeyboardEvents()}function isAnyEditBoxVisible(){return $(".editBox").size()>0}function isEditBoxClicked(event){return $(event.target).closest(".editBox").size()>0}function blockHideEditBox(){isHideActionBlocked=!0}function unblockHideEditBox(){isHideActionBlocked=!1}function isEditBoxVisible(element){return element.next(".editBox").size()>0}var isHideActionBlocked=!1,isMoving=!1,serviceId="editBoxUtilsService";return{showEditBox:showEditBox,hideEditBox:hideEditBox,isAnyEditBoxVisible:isAnyEditBoxVisible,isEditBoxClicked:isEditBoxClicked,blockHideEditBox:blockHideEditBox,unblockHideEditBox:unblockHideEditBox}}])}(),function(Mousetrap){"use strict";COMPONENTS.factory("keyboardService",["arrayService","stringService","constantsService",function(arrayService,stringService,constantsService){function register(shortcut,source,bindFn){function stackAndBind(shortcut,source,bindFn){var normalizedShortcut=normalizeShortcut(shortcut);bindFns[normalizedShortcut]||(bindFns[normalizedShortcut]=[]),bindFns[normalizedShortcut].push({fn:bindFn,source:source}),bind(normalizedShortcut,bindFn)}arrayService.isArray(shortcut)?shortcut.forEach(function(shortcutInstance){stackAndBind(shortcutInstance,source,bindFn)}):stackAndBind(shortcut,source,bindFn)}function unregister(shortcut,source){function unstackAndUnbind(shortcut,source){var normalizedShortcut=normalizeShortcut(shortcut),bindFnsShortcut=bindFns[normalizedShortcut];bindFnsShortcut&&bindFnsShortcut[bindFnsShortcut.length-1]&&source===bindFnsShortcut[bindFnsShortcut.length-1].source&&(arrayService.delete(bindFnsShortcut,bindFnsShortcut.length-1),unbind(normalizedShortcut))}arrayService.isArray(shortcut)?shortcut.forEach(function(shortcutInstance){unstackAndUnbind(shortcutInstance,source)}):unstackAndUnbind(shortcut,source)}function bind(shortcut,bindFn){var normalizedBindFn=function(){return blockShortcut||(bindFn(),blockShortcut=!0,setTimeout(function(){blockShortcut=!1},constantsService.keyboardInterval)),!1};Mousetrap.bind(shortcut,normalizedBindFn)}function unbind(shortcut){var bindFnsShortcut=bindFns[shortcut];Mousetrap.unbind(shortcut),bindFnsShortcut.length&&bind(shortcut,bindFnsShortcut[bindFnsShortcut.length-1].fn)}function normalizeShortcut(shortcut){return stringService.replaceToken(shortcut," ","")}var bindFns=[],blockShortcut=!1;return{register:register,unregister:unregister}}])}(window.Mousetrap),function(){"use strict";COMPONENTS.factory("mediaService",["crudService","constantsService",function(crudService,constantsService){function createMedia(mediaList,callback){var processedItems=0;mediaList.forEach(function(media){media.tags=mediaList.tags,updateMedia(media,function(newMedia){processedItems+=1,callback&&processedItems===mediaList.length&&callback(newMedia)})})}function updateMedia(media,callback){var data;media?(data={name:media.name,tags:media.tags},crudService.update(constantsService.collections.media,media._id,data,function(newMedia){callback&&callback(newMedia)})):callback&&callback({})}function getMedia(mediaId,params,callback){params||(params={}),params.projection={data:0},crudService.get(constantsService.collections.media,mediaId,params,function(media){callback&&callback(media)})}function getDownloadUrl(media){return media&&media._id?"media/"+media._id+"/"+media.name:null}function getMediaHtmlDetails(media){function getFriendlyMediaSize(size){function normalizeDecimals(size){return Math.floor(10*size)/10}var friendlyMediaSize,gB=1073741824,mB=1048576,kB=1024;return friendlyMediaSize=size>gB?normalizeDecimals(size/gB)+" GB":size>mB?normalizeDecimals(size/mB)+" MB":size>kB?normalizeDecimals(size/kB)+" KB":size+" bytes"}if(media&&media._id){var downloadUrl=getDownloadUrl(media),size=getFriendlyMediaSize(media.size),dimensions=media.width+"x"+media.height;return'<a href="'+downloadUrl+'" target="_blank">'+media.name+"</a><br/>("+dimensions+", "+size+")"}}function getDefaultAvatarUrl(){return"/client/images/user.svg"}return{createMedia:createMedia,updateMedia:updateMedia,getMedia:getMedia,getDownloadUrl:getDownloadUrl,getMediaHtmlDetails:getMediaHtmlDetails,getDefaultAvatarUrl:getDefaultAvatarUrl}}])}(),function(){"use strict";COMPONENTS.factory("objectService",[function(){function isObject(item){return"object"==typeof item}function isEmpty(object){var hasOwnProperty=Object.prototype.hasOwnProperty;if(null===object||void 0===object)return!0;if(object.length&&object.length>0)return!1;if(0===object.length)return!0;for(var key in object)if(hasOwnProperty.call(object,key))return!1;return!0}return{isObject:isObject,isEmpty:isEmpty}}])}(),function(){"use strict";COMPONENTS.factory("stringService",[function(){function replaceToken(string,sourceToken,targetToken){var re=new RegExp(sourceToken,"g");return string?string.replace(re,targetToken):""}function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}function decapitalize(string){return string.charAt(0).toLowerCase()+string.slice(1)}function toSnakeCase(string){return string.replace(/[A-Z]/g,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()})}function toCamelCase(string){return string.replace(/([\:\-\_]+(.))/g,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter}).replace(/^moz([A-Z])/,"Moz$1")}function trim(string){return $.trim(string)}function isExternalUrl(url){var expression=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,regex=new RegExp(expression);return url?null!==url.match(regex):!1}function normalizeExternalUrl(url){return url.indexOf("http://")<0?"http://"+url:url}return{replaceToken:replaceToken,capitalize:capitalize,decapitalize:decapitalize,toSnakeCase:toSnakeCase,toCamelCase:toCamelCase,trim:trim,isExternalUrl:isExternalUrl,normalizeExternalUrl:normalizeExternalUrl}}])}(),function(){"use strict";COMPONENTS.factory("styleService",["stringService",function(stringService){function getNormalizedStyles(sourceMdl,destMdl){var styleKey,styleValue;destMdl||(destMdl={});for(styleKey in sourceMdl)sourceMdl.hasOwnProperty(styleKey)&&(styleValue=sourceMdl[styleKey],styleValue&&(destMdl[styleKey]=sourceMdl[styleKey]));return destMdl}function getComputedStyleInRange(rootObj,leafObj){for(var styleObj,stylePropArray,stylePropIndex,styleKeyValueArray,stylesArrayIndex,normalizedKey,normalizedValue,stylesArray=[],stylesObj={};leafObj[0]!==rootObj[0];){if(styleObj={},void 0!==leafObj.attr("style")){stylePropArray=leafObj.attr("style").split(";");for(stylePropIndex in stylePropArray)stylePropArray.hasOwnProperty(stylePropIndex)&&(styleKeyValueArray=stylePropArray[stylePropIndex].split(":"),""!==styleKeyValueArray[0]&&void 0!==styleKeyValueArray[0]&&(normalizedKey=stringService.trim(stringService.toCamelCase(styleKeyValueArray[0])),normalizedValue=stringService.trim(styleKeyValueArray[1]),styleObj[normalizedKey]=normalizedValue));stylesArray.unshift(styleObj)}leafObj=leafObj.parent()}for(stylesArrayIndex in stylesArray)stylesArray.hasOwnProperty(stylesArrayIndex)&&(stylesObj=$.extend(!0,stylesObj,stylesArray[stylesArrayIndex]));return stylesObj}function rgbStrToRgbObj(rgbStr){var beginIdx=rgbStr.indexOf("(")+1,endIdx=rgbStr.indexOf(")")-rgbStr.indexOf("(")-1,rgbArray=rgbStr.substr(beginIdx,endIdx).split(",");return 3===rgbArray.length?{r:Number(stringService.trim(rgbArray[0])),g:Number(stringService.trim(rgbArray[1])),b:Number(stringService.trim(rgbArray[2]))}:null}function rgbObjToHexStr(rgbObj){function componentToHex(c){var hex=c.toString(16);return 1===hex.length?"0"+hex:hex}return("#"+componentToHex(rgbObj.r)+componentToHex(rgbObj.g)+componentToHex(rgbObj.b)).toUpperCase()}return{getNormalizedStyles:getNormalizedStyles,getComputedStyleInRange:getComputedStyleInRange,rgbStrToRgbObj:rgbStrToRgbObj,rgbObjToHexStr:rgbObjToHexStr}}])}(),function(){"use strict";COMPONENTS.factory("textSelectionService",[function(){function saveSelection(){savedSel=rangyPlgn.saveSelection()}function setFakeSelection(){var selectedTextDomObj=getSelectedTextDomObj();selectedTextDomObj.attr("fakeSelection","true")}function getSelectedTextDomObj(){rangyPlgn.init();var randomCssClass="rangyTemp_"+ +new Date,classApplier=rangyPlgn.createCssClassApplier(randomCssClass,!0);return classApplier.applyToSelection(),$("."+randomCssClass).removeClass(randomCssClass)}function isSelection(){var sel=rangyPlgn.getSelection();return sel._ranges.length>0&&sel._ranges[0].startOffset!=sel._ranges[0].endOffset}function isFakeSelection(){return $("[fakeSelection]").size()>0}function setStylesToSelection(styles){var selectedTextDomObj=getSelectedTextDomObj();selectedTextDomObj.css(styles)}function restoreSelection(){savedSel&&rangyPlgn.restoreSelection(savedSel),saveSelection()}function setLink(linkOptions){setDomObj("a",keys.link,linkOptions)}function setHeading(headingType){setDomObj("div",keys.heading,{id:headingType})}function getSelectedHeadingId(){return getSelectedId(keys.heading)}function getSelectedLink(){return getSelectedTextDomObj().closest("."+keys.link)}function getSelectedLinkId(){return getSelectedId(keys.link)}function removeSelection(){var sel=rangyPlgn.getSelection();if(isSelection()||isFakeSelection()){sel.removeAllRanges();var fakeSelectionObj=$("[fakeSelection]");""===fakeSelectionObj.attr("style")?fakeSelectionObj.replaceWith(fakeSelectionObj.html()):fakeSelectionObj.removeAttr("fakeSelection")}}function getSelectedId(key){return getSelectedTextDomObj().closest("."+key).attr("id")}function setDomObj(type,key,options){restoreSelection();var existingLinkObj=getSelectedTextDomObj().closest("."+key),existsLink=existingLinkObj.length>0;if(existsLink)existingLinkObj.attr(options);else{var classApplier=rangyPlgn.createCssClassApplier(key,{elementTagName:type,elementProperties:options});classApplier.applyToSelection()}restoreSelection()}var savedSel=!1,rangyPlgn=rangy,keys={link:"link",heading:"heading"};return{saveSelection:saveSelection,setFakeSelection:setFakeSelection,getSelectedTextDomObj:getSelectedTextDomObj,isSelection:isSelection,isFakeSelection:isFakeSelection,setStylesToSelection:setStylesToSelection,restoreSelection:restoreSelection,removeSelection:removeSelection,setLink:setLink,setHeading:setHeading,getSelectedLink:getSelectedLink,getSelectedHeadingId:getSelectedHeadingId,getSelectedLinkId:getSelectedLinkId}}])}(),function(clearInterval){"use strict";COMPONENTS.factory("timerService",[function(){function updateInterval(transitionTimer,method,timer){return clearInterval(transitionTimer),transitionTimer=setInterval(method,timer)}function getRandomNumber(){var now=new Date;return now.getTime()}return{updateInterval:updateInterval,getRandomNumber:getRandomNumber}}])}(window.clearInterval),function(undefined){"use strict";COMPONENTS.factory("validationService",[function(){function isFormValid(formObjs){function validateForm(formObj){return formObj.$pristine||formObj.$dirty&&formObj.$valid
}var isValid=!0;return $.isArray(formObjs)?formObjs.forEach(function(formObj){isValid*=validateForm(formObj)}):isValid=validateForm(formObjs),isValid}function setFocusOnFirstError(wrapperObj){$(".ng-invalid[ng-model]:first",wrapperObj).focus().addClass("forceMessage")}function setupValidation(defValue,element,ctrl,errorTitle,errorHtmlDetails,validationKey,validationFn){function addHelpMessage(inputObj,errorTitle,errorHtmlDetails){inputObj.data("decorated")||(inputObj.wrap('<div class="positionRelative"></div>'),inputObj.after('<div class="input-help"></div>'),setHelpMessageContent(inputObj,errorTitle,errorHtmlDetails)),inputObj.data("decorated",!0)}function updateHelpMessage(inputObj,errorTitle,errorHtmlDetails){setHelpMessageContent(inputObj,errorTitle,errorHtmlDetails)}function setHelpMessageContent(inputObj,errorTitle,errorHtmlDetails){var detailsObj,inputHelpObj=inputObj.next(".input-help");inputHelpObj.empty(),inputHelpObj.prepend('<div class="title">'+errorTitle+"</div>"),errorHtmlDetails&&(detailsObj=$('<div class="details"></div>'),inputHelpObj.append(detailsObj),detailsObj.html(errorHtmlDetails))}addHelpMessage(element,errorTitle,errorHtmlDetails),ctrl.$setValidity(validationKey,validationFn(defValue));var validator=function(newValue){return validationFn(newValue)?(ctrl.$setValidity(validationKey,!0),newValue):(ctrl.$setValidity(validationKey,!1),updateHelpMessage(element,errorTitle,errorHtmlDetails),undefined)};ctrl.$formatters.push(validator),ctrl.$parsers.unshift(validator)}return{isFormValid:isFormValid,setFocusOnFirstError:setFocusOnFirstError,setupValidation:setupValidation}}])}(window.undefined),function(window,angular){"use strict";angular.module("errorModule",["components"]).config(["$httpProvider","$provide",function($httpProvider,$provide){$provide.provider("$exceptionHandler",function(){this.$get=["stdService",function(stdService){return function(exception){stdService.error(exception.message,exception.stack)}}]}),$provide.factory("customHttpErrorInterceptor",["stdService","globalMsgService",function(stdService){function success(response){return response}function error(response){stdService.error(response.data)}return function(promise){return promise.then(success,error)}}]),$httpProvider.responseInterceptors.push("customHttpErrorInterceptor")}])}(window,window.angular),angular.module("templates-main",["bannerAppEdit.html","bannerAppHelp.html","bannerAppView.html","contentListAppAdd.html","contentListAppEdit.html","contentListAppHelp.html","contentListAppView.html","iframeAppEdit.html","iframeAppHelp.html","iframeAppView.html","imageAppEdit.html","imageAppHelp.html","imageAppView.html","languageSelectAppEdit.html","languageSelectAppHelp.html","languageSelectAppView.html","linksAppEdit.html","linksAppHelp.html","linksAppView.html","loginAppEdit.html","loginAppHelp.html","loginAppView.html","mapAppEdit.html","mapAppHelp.html","mapAppView.html","mediaCarouselAppEdit.html","mediaCarouselAppHelp.html","mediaCarouselAppSelectMedia.html","mediaCarouselAppView.html","mediaListAppAdd.html","mediaListAppEdit.html","mediaListAppHelp.html","mediaListAppView.html","menuAppEdit.html","menuAppHelp.html","menuAppView.html","portalsAdminAppCreateDb.html","portalsAdminAppEditDb.html","portalsAdminAppHelp.html","portalsAdminAppView.html","example.html","slidesAppEdit.html","slidesAppHelp.html","slidesAppView.html","socialAppEdit.html","socialAppHelp.html","socialAppView.html","staticContentAppAdd.html","staticContentAppEdit.html","staticContentAppHelp.html","staticContentAppSelectContent.html","staticContentAppView.html","userListAppAdd.html","userListAppEdit.html","userListAppHelp.html","userListAppView.html","videoAppEdit.html","videoAppHelp.html","videoAppView.html","webGlAppEdit.html","webGlAppHelp.html","webGlAppView.html","addAppPanel.html","adminPanel.html","createMedia.html","edit.html","editAppGeneral.html","editAppStyles.html","editBox.html","editContent.html","editContentList.html","editCurrentUser.html","editGeneral.html","editMedia.html","editMediaList.html","editNotifications.html","editPages.html","editStyles.html","editTag.html","editTagList.html","editUser.html","editUserList.html","stats.html","styles.html","app.html","appHeader.html","bannerCanvas.html","bannerItem.html","comment.html","comments.html","contentEditable.html","richContent.html","selectMedia.html","fileUploader.html","password.html","rating.html","contentList.html","list.html","listDb.html","mediaList.html","tagList.html","userList.html","login.html","mediaPicker.html","pages.html","errorPage.html","loginPage.html","portalPage.html","listActions.html","listEdit.html"]),angular.module("bannerAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("bannerAppEdit.html","<div>Test edit page</div>")}]),angular.module("bannerAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("bannerAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("bannerAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("bannerAppView.html",'<div>\n    <div banner-canvas ng-model="model.items" on-change="onModelChange()"></div>\n</div>')}]),angular.module("contentListAppAdd.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentListAppAdd.html",'<div>\n    <div create-content model="content"></div>\n</div>')}]),angular.module("contentListAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentListAppEdit.html","<div list-edit></div>")}]),angular.module("contentListAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentListAppHelp.html","<b>This is</b>The HELP! page of CONTENT LIST :)")}]),angular.module("contentListAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentListAppView.html",'<div>\n    <content-list id="_id" config="model"></content-list>\n</div>')}]),angular.module("iframeAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("iframeAppEdit.html",'<div>\n    <div>URL: <input type="text" ng-model="internalData.url"></textarea></div>\n    <div>Height: <input type="text" ng-model="internalData.height"></textarea></div>\n</div>')}]),angular.module("iframeAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("iframeAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("iframeAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("iframeAppView.html",'<div>\n    <iframe width="100%" ng-show="model.url" height="{{model.height}}" src="{{model.url}}" frameborder="0"\n            allowfullscreen></iframe>\n    <div ng-show="!model.url"><i>There isn\'t any content to show</i></div>\n</div>')}]),angular.module("imageAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("imageAppEdit.html",'<div>\n    <media-list config="config" on-select="onSelect($item)"></media-list>\n</div>')}]),angular.module("imageAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("imageAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("imageAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("imageAppView.html",'<div>\n    <img ux-show="model.mediaId" ng-src="{{getDownloadUrl()}}" title="{{getMediaTitle()}}" />\n    <div ux-show="!model.mediaId"><em>Please select an image from the gallery</em></div>\n</div>')}]),angular.module("languageSelectAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("languageSelectAppEdit.html","<div>\n    Hello edit!\n</div>")}]),angular.module("languageSelectAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("languageSelectAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("languageSelectAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("languageSelectAppView.html",'<div>\n    <div ng-repeat="language in languages" class="flag {{language.code}}" ng-click="selectLanguage(language.code)"\n         ng-class="{current: isCurrentLanguage(language.code)}" title="{{language.text}}">\n        <img ng-src="/client/images/flags/{{language.code}}.svg" />\n     </div>\n</div>')}]),angular.module("linksAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("linksAppEdit.html",'<div><h6>Text</h6></div>\n<div><h6>URL<h6></div>\n<ul sortable="model.links">\n	<li ng-repeat="link in model.links" class="cf">\n		<div><input type="text" ng-model="link.text"/></div>\n		<div><input type="text" ng-model="link.url"/></div>\n		<div><button class="removeIcon" ng-click="removeItemFromModel($index, model.links)">Remove</button></div>\n	</li>\n</ul>\n<div class="actions">\n	<button class="addIcon" ng-click="addItemToModel(model.links)">+</button>\n</div>\n')}]),angular.module("linksAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("linksAppHelp.html","<b>This is</b>The HELP! page :) of the Links app\n<ul>\n	<li>V1</li>\n	<li>V2</li>\n	<li>V3</li>\n</ul>")}]),angular.module("linksAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("linksAppView.html",'<div>\n    <div ng-repeat="link in model.links"><a href="{{link.url}}" target="_blank">{{link.text}}</a></div>\n</div>\n')}]),angular.module("loginAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("loginAppEdit.html",'Video ID:\n<input type="text" ng-model="model.videoId"></textarea>\nHeight:\n<input type="text" ng-model="model.height"></textarea>\n')}]),angular.module("loginAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("loginAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("loginAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("loginAppView.html","<div>\n    <login></login>\n</div>")}]),angular.module("mapAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mapAppEdit.html",'<div>\n    Height:\n    <input type="text" ng-model="model.height"></textarea>\n    Map URL:\n    <input type="text" ng-model="model.url"></textarea>\n</div>\n')}]),angular.module("mapAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mapAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("mapAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mapAppView.html",'<iframe width="100%" height="{{model.height}}" frameborder="0" scrolling="no" marginheight="0"\n        marginwidth="0" src="{{model.url}}&amp;output=embed"></iframe>\n')}]),angular.module("mediaCarouselAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaCarouselAppEdit.html",'<div>\n     <label>Time between slides (milliseconds):<input type="text" ng-model="model.timer"/></label>\n    <label>\n        Legend pos:\n        <select ng-model="model.navigationPos" ng-options="obj.value as obj.text for obj in navigationPos"></select>\n    </label>\n</div>')}]),angular.module("mediaCarouselAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaCarouselAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("mediaCarouselAppSelectMedia.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaCarouselAppSelectMedia.html",'<div>\n    <div edit-media-list selected="model.selectedMedia"></div>\n</div>')}]),angular.module("mediaCarouselAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaCarouselAppView.html",'<div>\n    <div class="navigationContainer {{model.navigationPos}}">\n        <div class="navigatorOverlay"></div>\n        <div class="navigator cf" ng-style="setNavigatorCenterPos()">\n            <img class="mediaThumbnail" ng-repeat="media in internalData.mediaList" ng-click="internalData.goToMedia($index)"\n                 ng-class="getMediaThumbnailSelectedClass($index)" ng-src="{{getDownloadUrl($index)}}" />\n        </div>\n    </div>\n    <img ng-src="{{getDownloadUrl(internalData.currentMediaIndex)}}" />\n</div>')}]),angular.module("mediaListAppAdd.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaListAppAdd.html",'<div>\n    <div create-media model="media"></div>\n</div>')}]),angular.module("mediaListAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaListAppEdit.html","<div list-edit></div>")}]),angular.module("mediaListAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaListAppHelp.html","<b>This is</b>The HELP! page of CONTENT LIST :)")}]),angular.module("mediaListAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaListAppView.html",'<div>\n    <media-list config="model"></media-list>\n</div>')}]),angular.module("menuAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menuAppEdit.html",'<!--<div><h6>Text</h6></div>\n<div><h6>Page<h6></div>\n<div><h6>Layout<h6></div>\n<ul sortable=model.pages">\n	<li ng-repeat="page in edit.portal.pages" class="cf page">\n		<div><input type="text" ng-model="page.text"></div>\n		<div><input type="text" ng-model="page.page"/></div>\n		<div class="actions">\n			<button class="changeLayout">L</button>\n			<button class="remove" ng-click="removeItemFromModel($index, edit.portal.pages)"></button>\n		</div>\n	</li>\n</ul>\n<div class="actions">\n	<button class="add" ng-click="addItemToModel(edit.portal.pages)">+</button>\n</div>-->\n')}]),angular.module("menuAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menuAppHelp.html","<b>This is</b>The HELP! page :) <h6>of the Menu app</h6>\n<ul>\n	<li>V4</li>\n	<li>V5</li>\n	<li>V6</li>\n</ul>")}]),angular.module("menuAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menuAppView.html",'<div>\n    <ul class="pagesMenu">\n        <li ng-repeat="page in pages" class="page" ng-class="getPageStyleClass(page)" ng-show="!page.parentPageId">\n            <h6>\n                <a href="{{getPageUrl(page)}}" target="{{getPageTarget(page)}}" title="{{page.description}}" i18n-db-title>\n                    <button class="toggleSubPages downIcon small" ng-show="hasSubPages(page)"></button>\n                    <label i18n-db="page.text"></label>\n                </a>\n            </h6>\n            <div class="subPagesMenuContainer">\n                <ul class="subPagesMenu" ng-show="page.hasSubPages">\n                    <li ng-repeat="subPage in pages" class="page" ng-class="getPageStyleClass(subPage)"\n                        ux-show="isSubPageOf(subPage, page)">\n                        <h6>\n                            <a href="{{getPageUrl(subPage)}}" target="{{getPageTarget(subPage)}}" title="{{subPage.description}}">\n                                <label i18n-db="subPage.text"></label>\n                            </a>\n                        </h6>\n                    </li>\n                </ul>\n            </div>\n        </li>\n    </ul>\n</div>')}]),angular.module("portalsAdminAppCreateDb.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portalsAdminAppCreateDb.html",'<div>\n    <div class="columns large-10">Database name:<br/>(Without spaces)</div>\n    <div class="columns large-15">\n        <input type="text" ng-model="internalData.data.name" />\n    </div>\n</div>')}]),angular.module("portalsAdminAppEditDb.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portalsAdminAppEditDb.html",'<div>\n    <div class="columns large-10">Database name:<br/>(Without spaces)</div>\n    <div class="columns large-15">\n        <input type="text" ng-model="model.name" />\n    </div>\n</div>')}]),angular.module("portalsAdminAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portalsAdminAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("portalsAdminAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portalsAdminAppView.html",'<div>\n    <div list="databases" config="config" transcluded-data="transcludedData"\n         template="template" internal-data="internalData"\n         on-create-panels="onCreatePanels" on-edit-panels="onEditPanels"\n         on-create="onCreate($item)" on-edit="onEdit($item)" on-delete="onDelete($id)"></div>\n</div>')}]),angular.module("example.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("example.html",'<!doctype html>\n<html lang="en">\n\n	<head>\n		<meta charset="utf-8">\n\n		<title>reveal.js - Markdown Demo</title>\n\n		<link rel="stylesheet" href="../../css/reveal.css">\n		<link rel="stylesheet" href="../../css/theme/default.css" id="theme">\n	</head>\n\n	<body>\n\n		<div class="reveal">\n\n			<div class="slides">\n\n                <!-- Use external markdown resource, separate slides by three newlines; vertical slides by two newlines -->\n                <section data-markdown="example.md" data-separator="^\\n\\n\\n" data-vertical="^\\n\\n"></section>\n\n                <!-- Slides are separated by three dashes (quick \'n dirty regular expression) -->\n                <section data-markdown data-separator="---">\n                    <script type="text/template">\n                        ## Demo 1\n                        Slide 1\n                        ---\n                        ## Demo 1\n                        Slide 2\n                        ---\n                        ## Demo 1\n                        Slide 3\n                    </script>\n                </section>\n\n                <!-- Slides are separated by newline + three dashes + newline, vertical slides identical but two dashes -->\n                <section data-markdown data-separator="^\\n---\\n$" data-vertical="^\\n--\\n$">\n                    <script type="text/template">\n                        ## Demo 2\n                        Slide 1.1\n\n                        --\n\n                        ## Demo 2\n                        Slide 1.2\n\n                        ---\n\n                        ## Demo 2\n                        Slide 2\n                    </script>\n                </section>\n\n                <!-- No "extra" slides, since there are no separators defined (so they\'ll become horizontal rulers) -->\n                <section data-markdown>\n                    <script type="text/template">\n                        A\n\n                        ---\n\n                        B\n\n                        ---\n\n                        C\n                    </script>\n                </section>\n\n            </div>\n		</div>\n\n		<script src="../../lib/js/head.min.js"></script>\n		<script src="../../js/reveal.js"></script>\n\n		<script>\n\n			Reveal.initialize({\n				controls: true,\n				progress: true,\n				history: true,\n				center: true,\n\n				theme: Reveal.getQueryHash().theme,\n				transition: Reveal.getQueryHash().transition || \'default\',\n\n				// Optional libraries used to extend on reveal.js\n				dependencies: [\n					{ src: \'../../lib/js/classList.js\', condition: function() { return !document.body.classList; } },\n'+"					{ src: 'marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },\n                    { src: 'markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },\n					{ src: '../notes/notes.js' }\n				]\n			});\n\n		</script>\n\n	</body>\n</html>\n")}]),angular.module("slidesAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("slidesAppEdit.html","<div>\n    Hello edit!\n</div>")}]),angular.module("slidesAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("slidesAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("slidesAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("slidesAppView.html",'<div>\n    <div class="reveal">\n        <div class="slides">\n            <section ng-repeat="slide in model.slides" ng-show="show">\n                <div ng-bind-html-unsafe="slide.content"></div>\n            </section>\n        </div>\n    </div>\n</div>')}]),angular.module("socialAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("socialAppEdit.html",'<div>\n    <div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.show.email" label="Show e-mail?"/>\n        </div>\n        <div class="columns large-25">\n            <input type="text" ng-model="model.email" ng-show="model.show.email" />\n        </div>\n    </div>\n    <div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.show.facebook" label="Show Facebook?"/></div>\n        <div class="columns large-25">\n            <input type="text" ng-model="model.facebook" ng-show="model.show.facebook" />\n        </div>\n    </div>\n    <div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.show.twitter" label="Show Twitter?"/>\n        </div>\n        <div class="columns large-25">\n            <input type="text" ng-model="model.twitter" ng-show="model.show.twitter" />\n        </div>\n    </div>\n    <div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.show.linkedIn" label="Show LinkedIn?"/>\n        </div>\n        <div class="columns large-25">\n            <input type="text" ng-model="model.linkedIn" ng-show="model.show.linkedIn" />\n        </div>\n    </div>\n    <div class="columns large-25">\n        Icon size:\n        <select ng-model="model.iconSize" ng-options="obj.id as obj.text for obj in internalData.iconSizes"></select>\n    </div>\n</div>')}]),angular.module("socialAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("socialAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("socialAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("socialAppView.html",'<div>\n    <div class="item" ng-class="model.iconSize" ng-show="model.show.email">\n       <a ng-href="mailto:{{model.email}}" target="_blank"><img src="/client/images/email2.svg" title="e-mail" /></a>\n    </div>\n    <div class="item" ng-class="model.iconSize" ng-show="model.show.facebook">\n        <a ng-href="{{model.facebook}}" target="_blank"><img src="/client/images/facebook.svg" title="Facebook" /></a>\n    </div>\n    <div class="item" ng-class="model.iconSize" ng-show="model.show.twitter">\n        <a ng-href="{{model.twitter}}" target="_blank"><img src="/client/images/twitter.svg" title="Twitter" /></a>\n    </div>\n    <div class="item" ng-class="model.iconSize" ng-show="model.show.linkedIn">\n        <a ng-href="{{model.linkedIn}}" target="_blank"><img src="/client/images/linkedin.svg" title="LinkedIn" /></a>\n    </div>\n</div>')}]),angular.module("staticContentAppAdd.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("staticContentAppAdd.html",'<div>\n    <div create-content model="content"></div>\n    <input checkbox ng-model="internalData.displayAddedContent" label="Display added?" />\n</div>')}]),angular.module("staticContentAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("staticContentAppEdit.html",'<div>\n    <div class="row">\n        <h5><label>General</label></h5>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.showTitles" label="Show titles"/>\n        </div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.showComments" label="Show comments"/>\n        </div>\n    </div>\n    <div class="row">\n        <h5><label>Ratings</label></h5>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.showRatings" label="Show ratings"/>\n\n        </div>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.showCommentsRatings" label="Show comments ratings"/>\n        </div>\n    </div>\n</div>')}]),angular.module("staticContentAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("staticContentAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("staticContentAppSelectContent.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("staticContentAppSelectContent.html",'<div>\n    <auto-complete ng-model="model.selectedContentId" ng-options="contentList" label-key="title"\n                   placeholder="Start typing to select content..."></auto-complete>\n</div>\n')}]),angular.module("staticContentAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("staticContentAppView.html",'<div>\n    <div ng-show="!model.selectedContentId"><em>Please select a content from the edit panel</em></div>\n    <div ng-show="model.selectedContentId">\n        <div class="contentHeader cf">\n            <h3 ng-show="model.showTitles" class="title">\n                <a href="#">\n                    <div content-editable ng-model="internalData.title" type="type"\n                         on-blur="onContentUpdated()" class="noBorder" i18n-db-input></div>\n                </a>\n            </h3>\n            <div rating="internalData.avgRating" target-id="model.selectedContentId" target-collection="content"\n                 target-author-id="internalData.create.author._id" ux-show="model.showRatings"></div>\n        </div>\n        <div content-editable ng-model="internalData.summary" type="type"\n             on-blur="onContentUpdated()" class="noBorder" i18n-db-input></div>\n        <div content-editable ng-model="internalData.content" type="type"\n             on-blur="onContentUpdated()" class="noBorder" i18n-db-input></div>\n        <comments target-id="model.selectedContentId" placeholder="comments.addComment.placeholder"\n                  ux-show="model.showComments" allow-ratings="model.showCommentsRatings"></comments>\n    </div>\n</div>\n')}]),angular.module("userListAppAdd.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userListAppAdd.html",'<div>\n    <div create-user model="user"></div>\n</div>')}]),angular.module("userListAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userListAppEdit.html","<div list-edit></div>")}]),angular.module("userListAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userListAppHelp.html","<b>This is</b>The HELP! page of USER LIST :)")}]),angular.module("userListAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userListAppView.html",'<div>\n    <user-list config="model"></user-list>\n</div>')}]),angular.module("videoAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("videoAppEdit.html",'<div>\n    Video ID:\n    <input type="text" ng-model="model.videoId"></textarea>\n    Height:\n    <input type="text" ng-model="model.height"></textarea>\n</div>\n')}]),angular.module("videoAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("videoAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("videoAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("videoAppView.html",'<iframe width="100%" height="{{model.height}}" src="http://www.youtube.com/embed/{{model.videoId}}"\n        frameborder="0" allowfullscreen></iframe>')}]),angular.module("webGlAppEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("webGlAppEdit.html","<div>3D Edit</div>")}]),angular.module("webGlAppHelp.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("webGlAppHelp.html","<b>This is</b>The HELP! page :)")}]),angular.module("webGlAppView.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("webGlAppView.html","<div></div>")}]),angular.module("addAppPanel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("addAppPanel.html",'<div id="addAppPanel" class="addAppPanel" state="hidden">\n    <div class="collapsedView">\n        <file-uploader endpoint="rest/availableApps/deploy/" on-upload="onAvailableAppDeployed()"></file-uploader>\n        <div class="filterContainer"><input type="text" ng-model="filter"></div>\n        <ul class="apps">\n            <div ng-repeat="availableApp in availableApps.model | filter: filter" ng-class="getBlockStyleClass(availableApp.id)">\n                <div class="category" ng-show="availableApp.firstInCategory">{{availableApp.category}}</div>\n                <li sortable-add-app class="newItem" type="{{availableApp.id}}" ng-class="getAppClasses($index)">\n                    <div class="text">{{availableApp.title}}</div>\n                    <button class="infoIcon" ng-click="toggleExpandedView(availableApp)"></button>\n                </li>\n            </div>\n        </ul>\n    </div>\n    <div class="expandedView">\n        <div class="content">\n            <div class="header">\n                <div class="main">\n                    <h3 class="title">{{highlight.title}}</h3>\n                    <div rating="highlight.avgRating" target-id="highlight._id" target-collection="{{highlight.collection}}" height="32"></div>\n                    <div class="actions">\n                        <button class="addIcon">Add!</button>\n                        <button class="removeIcon" ng-click="undeploy()"><label i18n="app.remove"></label></button>\n                    </div>\n                </div>\n                <div class="metadata">\n                    <label class="key" i18n="addApp.version"></label>: <label class="value">{{highlight.version}}</label>\n                    <label class="key" i18n="addApp.category"></label>: <label class="value">{{highlight.category}}</label>\n                    <label class="key" i18n="addApp.creationDate"></label>: <label class="value">{{highlight.create.date}}</label>\n                    <label class="key" i18n="addApp.provider"></label>: <label class="value">{{highlight.provider}}</label>\n                </div>\n                <div class="description">{{highlight.desc}}</div>\n            </div>\n            <div class="preview" app-container>\n                <div app ng-class="highlight.id" model="highlight.model" type="highlight.id"></div>\n            </div>\n            <div class="details">\n                <line-chart data="highlight.stats"></line-chart>\n                <comments target-id="highlight._id" placeholder="addApp.addComment" on-add="onAddedComment"></comments>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("adminPanel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("adminPanel.html",'<div class="admin cf">\n    <add-app-panel></add-app-panel>\n    <edit ng-model="portal" edit="edit" panels="panels" on-cancel="onCancel()" on-save="onSave()"\n          active-tab="activeTab" limit-layer-height="false"></edit>\n</div>\n')}]),angular.module("createMedia.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("createMedia.html",'<div>\n    Name:\n    <div ng-show="multipleFilesUploaded">{{getMultipleFilesUploadedNames()}}</div>\n    <input type="text" ng-model="media[0].name" mandatory ng-show="!multipleFilesUploaded" />\n    content: <file-uploader on-upload="onUpload()"></file-uploader>\n    Tags:\n    <auto-complete ng-model="media.tags" ng-options="availableTags" label-key="text"\n                   placeholder="Start typing to retrieve tags" multiple="true"></auto-complete>\n</div>\n')}]),angular.module("edit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("edit.html",'<div class="edit cf">\n    <div class="actions">\n        <button class="saveIcon" ng-click="save()"></button>\n        <button class="cancelIcon" ng-click="cancel()"></button>\n    </div>\n	<ul class="tabs level1" ng-show="showIfMultipleTabs()">\n		<li ng-repeat="panel in panels" style="width:{{tabWidth}}%" ng-style="panel.ngStyle()" ng-click="clickTab($index)"\n            class="tab button" ng-class="getTabClasses(panel, $index)" title="{{panel.description}}" i18n-title>\n            <label i18n="{{panel.title}}"></label>\n            <label ux-show="isEditedMarkVisible($parent[panel.type])" ng-class="getEditedMarkColor($parent[panel.type])"\n                   class="editedMark">*</label>\n		</li>\n	</ul>\n	<div class="content level1" ng-show="activeTab >= 0">\n		<ul></ul>\n	</div>\n</div>\n')
}]),angular.module("editAppGeneral.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editAppGeneral.html",'<div class="cf">\n    <div class="row">\n        <h5><label i18n="editApp.general"></label></h5>\n        <div class="columns large-25">\n            <input checkbox ng-model="model.showTitle" label="editApp.showAppTitles"/>\n        </div>\n        <label i18n="editApp.align"></label>\n        <select ng-model="model.align" ng-options="obj.id as obj.text for obj in aligns"></select>\n    </div>\n</div>\n')}]),angular.module("editAppStyles.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editAppStyles.html",'<div>\n    <div styles="model.styles"></div>\n</div>\n')}]),angular.module("editBox.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editBox.html",'<div id="editBox{{target.id}}" class="editBox cf" arrowPos="{{arrowPos}}" ng-style="getStyles()" type="{{target.type}}">\n    <div class="content cf">\n        <edit ng-model="model" internal-data="internalData" panels="panels" active-tab="activeTab"\n              on-save="save()" on-change="change()" on-cancel="cancel()" limit-layer-height="true"></edit>\n    </div>\n</div>\n')}]),angular.module("editContent.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editContent.html",'<div>\n    <label i18n="editContent.title"></label>: <input type="text" ng-model="content.title" i18n-db-input mandatory />\n    <label i18n="editContent.summary"></label>: <div content-editable ng-model="content.summary" type="type" i18n-db-input></div>\n    <label i18n="editContent.content"></label>: <div content-editable ng-model="content.content" type="type" i18n-db-input></div>\n    <label i18n="tags"></label>:\n    <auto-complete ng-model="content.tags" ng-options="availableTags" label-key="text"\n                   placeholder="Start typing to retrieve tags" multiple="true"></auto-complete>\n</div>')}]),angular.module("editContentList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editContentList.html",'<div>\n    <content-list config="config"></content-list>\n</div>')}]),angular.module("editCurrentUser.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editCurrentUser.html",'<div>\n    <div class="actions">\n        <button ng-click="logout()">Logout</button>\n    </div>\n    <div edit-user model="userSession" on-layer="onLayer" class="clearBoth"></div>\n</div>')}]),angular.module("editGeneral.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editGeneral.html",'<li class="hasSubmenu">\n    <ul vertical-tabs="level2Tabs"></ul>\n    <div class="content level2">\n        <ul>\n            <li class="layer">\n                <div class="columns large-25">\n                    <label i18n="editGeneral.general.portalTitle"></label>\n                    <div><input type="text" ng-model="model.title" mandatory /></div>\n                </div>\n                <div class="columns large-25">\n                    <label i18n="editGeneral.general.portalDescription"></label>\n                    <div><textarea content-editable ng-model="model.desc"></textarea></div>\n                </div>\n                <div class="columns large-25">\n                    <label i18n="editGeneral.general.favicon"></label>\n                    <file-uploader preview="true" ng-model="favicon" on-upload="updateFavicon($uploadedFile)"\n                                   default-media-url="defaultFaviconUrl"></file-uploader>\n                </div>\n                <div class="columns large-25">\n                    <h5><label i18n="editGeneral.general.fullscreenMode"></label></h5>\n                    <input radio ng-model="model.fullscreenMode" label="editGeneral.general.fullscreenMode.real"\n                    value="real" name="fullscreenMode" title="editGeneral.general.fullscreenMode.real.desc" i18n-title />\n                    <input radio ng-model="model.fullscreenMode" label="editGeneral.general.fullscreenMode.maximized"\n                    value="maximized" name="fullscreenMode" title="editGeneral.general.fullscreenMode.maximized.desc" i18n-title />\n                    <input radio ng-model="model.fullscreenMode" label="editGeneral.general.fullscreenMode.template"\n                    value="template" name="fullscreenMode" title="editGeneral.general.fullscreenMode.template.desc" i18n-title />\n                </div>\n            </li>\n            <li class="layer">\n                <div edit-app-general model="model.app"></div>\n            </li>\n            <li class="layer">\n                <input checkbox ng-model="model.comments.allowRatings" label="editGeneral.comments.allowRatings" />\n            </li>\n            <li class="layer">\n                <div class="columns large-8">\n                    <label i18n="editGeneral.email.sourceAddress"></label>\n                    <div><input type="text" ng-model="model.email.user" /></div>\n                </div>\n                <div class="columns large-8">\n                    <label i18n="editGeneral.email.sourcePassword"></label>\n                    <div><input type="password" ng-model="model.email.password" /></div>\n                </div>\n                <div class="columns large-7">\n                    <label i18n="editGeneral.email.host"></label>\n                    <div><input type="text" ng-model="model.email.host" /></div>\n                </div>\n                <div class="columns large-2">\n                    <label>SSL?:</label>\n                    <input checkbox ng-model="model.email.ssl" />\n                </div>\n            </li>\n            <li class="layer">\n                <div class="columns large-8 textAlignRight">\n                    <label i18n="editGeneral.statistics.trackingCode"></label>\n                </div>\n                <div class="columns large-16">\n                    <div><input type="text" ng-model="model.trackingCode" /></div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</li>\n\n')}]),angular.module("editMedia.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editMedia.html",'<div>\n    <label i18n="editMedia.name"></label>: <input type="text" ng-model="media.name" mandatory ng-show="!multipleFilesUploaded" />\n    <label i18n="editMedia.content"></label>: <file-uploader on-upload="onUpload()" endpoint="media/upload/{{media._id}}"></file-uploader>\n    <label i18n="tags"></label>:\n    <auto-complete ng-model="media.tags" ng-options="availableTags" label-key="text"\n                   placeholder="tags.placeholder" multiple="true"></auto-complete>\n</div>\n')}]),angular.module("editMediaList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editMediaList.html",'<div>\n    <media-list config="config"></media-list>\n</div>')}]),angular.module("editNotifications.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editNotifications.html",'<li class="hasSubmenu">\n    <ul vertical-tabs="level2Tabs"></ul>\n    <div class="content level2">\n        <ul>\n            <li class="layer">\n                <div class="block">\n                    <h4><label i18n="editNotifications.email.selectAddressees"></label></h4>\n                    <auto-complete ng-model="model.notifications.email.selectedUsers" ng-options="usersList" label-key="fullName" value-key="email"\n                                   placeholder="editNotifications.email.typeToGetUsers" multiple="true"></auto-complete>\n                </div>\n                <div class="block">\n                    <h4><label i18n="editNotifications.email.writeMessage"></label></h4>\n                    <h6><label i18n="editNotifications.title"></label></h6>\n                    <input type="text" ng-model="model.notifications.email.subject" />\n                    <h6><label i18n="editNotifications.content"></label></h6>\n                    <div content-editable ng-model="model.notifications.email.text" class="content"></div>\n                </div>\n            </li>\n            <li class="layer">\n                <h6><i><label i18n="editNotifications.liveMessage.sendMessage"></label></i></h6>\n                <div class="block">\n                    <h6><label i18n="editNotifications.title"></label></h6>\n                    <input type="text" ng-model="model.notifications.liveMessage.subject" />\n                    <h6><label i18n="editNotifications.content"></label></h6>\n                    <div content-editable ng-model="model.notifications.liveMessage.text" class="content"></div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</li>')}]),angular.module("editPages.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editPages.html",'<li class="hasSubmenu">\n	<div class="submenu">\n        <nested-pages-wrapper pages="pages" items="items" selected-item="selectedPage" on-add="onAddPage($page)"></nested-pages-wrapper>\n	</div>\n    <ul vertical-tabs="level2Tabs"></ul>\n	<div class="content level2">\n        <ul ng-form="editPages">\n            <li class="layer" id="currentLayout{{$id}}">\n                <div class="columns large-9 textAlignRight"><label i18n="editPages.id"></label></div>\n                <div class="columns large-16">/{{selectedPage.url}}</div>\n                <div class="columns large-9 textAlignRight"><label i18n="editPages.text"></label></div>\n                <div class="columns large-16">\n                    <input type="text" ng-model="selectedPage.text" i18n-db-input ng-change="updateSelectedPageUrl()"\n                           mandatory placeholder="editPages.text.placeholder" />\n                </div>\n                <div class="columns large-9 textAlignRight"><label i18n="editPages.description"></label></div>\n                <div class="columns large-16">\n                    <textarea content-editable ng-model="selectedPage.description" i18n-db-input\n                              ux-change="registerSelectedPageChange()" placeholder="editPages.description.placeholder"></textarea>\n                </div>\n                <div class="columns large-9 textAlignRight"><label i18n="editPages.type"></label></div>\n                <div class="columns large-16">\n                    <select ng-model="selectedPage.type" ng-options="obj.id as obj.text for obj in pageTypes"\n                            ng-change="registerSelectedPageChange()"></select>\n                </div>\n                <div ux-show="selectedPage.type==\'externalLink\'">\n                    <div class="columns large-8 textAlignRight"><label i18n="editPages.url"></label></div>\n                    <div class="columns large-11">\n                        <input type="text" ng-model="selectedPage.externalLinkUrl" mandatory ng-change="registerSelectedPageChange()" />\n                    </div>\n                    <div class="columns large-2 textAlignRight"><label i18n="editPages.target"></label></div>\n                    <div class="columns large-4">\n                        <select ng-model="selectedPage.target" ng-options="obj.id as obj.text for obj in targets"\n                                ng-change="registerSelectedPageChange()"></select>\n                    </div>\n                </div>\n            </li>\n            <li class="layer" id="changeLayout{{$id}}">\n                <padding>\n                    34\n                </padding>\n            </li>\n            <li class="layer" id="section2c{{$id}}">\n                <padding>\n                    <h2>Section 6</h2>\n                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Suspendisse et turpis sed metus fermentum pellentesque. Vestibulum auctor neque ac nunc elementum malesuada. Praesent non est sed libero vestibulum consectetuer. Sed vehicula. Vivamus quis tellus sit amet erat ultrices luctus. Fusce a ligula. Fusce viverra libero vitae velit. Aenean bibendum nibh non lorem. Suspendisse quis velit. Integer sit amet lacus. Curabitur tristique. Morbi eu lectus. Vestibulum tristique aliquam quam. Sed neque.</p>\n                    <p>Nulla facilisi. Quisque eleifend libero. Sed eros. Morbi vel leo. Morbi varius tincidunt sem. Nam sodales volutpat velit. Suspendisse potenti. Duis vehicula pede non nisi. Proin elit pede</p>\n                </padding>\n            </li>\n        </ul>\n	</div>\n</li>\n')}]),angular.module("editStyles.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editStyles.html",'<li class="hasSubmenu">\n    <ul vertical-tabs="level2Tabs"></ul>\n    <div class="content level2">\n        <ul>\n            <li class="layer">\n                <div styles="model.styles"></div>\n            </li>\n            <li class="layer">\n                <div styles="model.app.styles"></div>\n            </li>\n        </ul>\n    </div>\n</li>\n')}]),angular.module("editTag.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editTag.html",'<div>\n    <div class="columns large-8 textAlignRight"><label i18n="editTag.tagName"></label>:</div>\n    <div class="columns large-16"><input type="text" ng-model="tag.text" mandatory /></div>\n</div>')}]),angular.module("editTagList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editTagList.html",'<div>\n    <tag-list config="config"></tag-list>\n</div>')}]),angular.module("editUser.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editUser.html",'<div>\n    <div class="columns large-8">\n        <media-picker preview="true" ng-model="user.media" default-media-url="defaultAvatarUrl"></media-picker>\n    </div>\n    <div class="columns large-16">\n        <div><label i18n="editUser.fullName"></label>: <input type="text" ng-model="user.fullName" mandatory /></div>\n        <div><label i18n="editUser.email"></label>: <input type="text" ng-model="user.email" email-mandatory mandatory /></div>\n        <div>\n            <label i18n="editUser.password"></label>:\n            <input password ng-model="user.password" click-to-change="clickToChangePassword" />\n        </div>\n        <div>\n            <label i18n="editUser.role"></label>\n            <select ng-model="user.role" ng-options="obj.karma as obj.title for obj in roles"></select>\n        </div>\n        <div>\n            <label i18n="editUser.language"></label>\n            <select ng-model="user.language" ng-options="obj.code as obj.text for obj in languages"></select>\n        </div>\n        <div><label i18n="tags"></label>:\n            <auto-complete ng-model="user.tags" ng-options="availableTags" label-key="text"\n                           placeholder="Start typing to retrieve tags" multiple="true"></auto-complete>\n        </div>\n    </div>\n</div>')}]),angular.module("editUserList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("editUserList.html",'<div>\n    <user-list config="config"></user-list>\n</div>')}]),angular.module("stats.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("stats.html",'<div>\n    <div class="columns large-12 chartBlock">\n        <h4 class="title"><label i18n="stats.createdNewsPerDay"></label></h4>\n        <line-chart data="newsPerDay"></line-chart>\n    </div>\n    <div class="columns large-12 chartBlock">\n        <h4 class="title"><label i18n="stats.createdUsersPerDay"></label></h4>\n        <line-chart data="usersPerDay"></line-chart>\n    </div>\n    <div class="columns large-8 chartBlock">\n        <h4 class="title"><label i18n="stats.createdContentPerUser"></label></h4>\n        <pie-chart data="contentPerUser"></pie-chart>\n    </div>\n    <div class="columns large-8 chartBlock">\n        <h4 class="title"><label i18n="stats.usersPerRole"></label></h4>\n        <pie-chart data="usersPerRole"></pie-chart>\n    </div>\n    <div class="columns large-8 chartBlock">\n        <h4 class="title"><label i18n="stats.commentsPerUser"></label></h4>\n        <pie-chart data="commentsPerUser"></pie-chart>\n    </div>\n</div>')}]),angular.module("styles.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("styles.html",'<div>\n    <div class="cf">\n        <label i18n="editStyles.backgroundColor"></label>\n        <div>\n            <input color-picker placeholder="Specify the color" ng-model="model.backgroundColor" />\n        </div>\n    </div>\n    <div class="cf">\n        <label i18n="editStyles.fontColor"></label>\n        <div>\n            <input color-picker placeholder="Specify the color" ng-model="model.color" />\n        </div>\n    </div>\n    <div class="cf">\n        <label i18n="editStyles.padding"></label>\n        <div><input type="text" ng-model="model.padding"/></div>\n    </div>\n    <div class="cf">\n        <label i18n="editStyles.fontSize"></label>\n        <div><input type="text" ng-model="model.fontSize"/></div>\n    </div>\n</div>')}]),angular.module("app.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("app.html",'<div class="app {{type}} {{getCurrentUserAdminAccessStyleClass()}} cf" ng-style="setAppStyles()">\n    <div app-header class="cf"></div>\n	<div class="content cf">\n        <div class="title" ng-show="isTitleVisible()"><h5>{{model.title || appInfo.title}}</h5></div>\n        <div app-bridge model="model" internal-data="internalData" src="{{type}}" view="{{view}}"\n             ng-class="{alignCenter: model.align==\'center\', alignRight: model.align==\'right\'}"\n             on-event="onEvent"></div>\n	</div>\n</div>\n')}]),angular.module("appHeader.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("appHeader.html",'<div>\n    <div class="headerToggle" ng-click="toggleHeader()" ng-show="showAdminActions()"></div>\n    <div class="header cf" ng-show="showHeader()" title="{{getAppHelpText()}}">\n        <div class="title">\n            <h5>{{model.title || appInfo.title}}</h5>\n        </div>\n        <div class="actions">\n            <button class="editIcon" ng-click="showEditTemplate()" ng-show="showEditActions()" title="app.edit" i18n-title></button>\n            <button class="fullscreenIcon" ng-click="toggleFullscreen()" ng-show="showAdminActions()" title="app.fullscreen"\n                    ng-disabled="templateApp==\'true\' && isTemplateFullscreen" i18n-title></button>\n            <button class="removeIcon" ng-click="removeApp()" ng-show="showAdminActions()" title="app.remove" i18n-title></button>\n        </div>\n    </div>\n</div>')}]),angular.module("bannerCanvas.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("bannerCanvas.html",'<div class="bannerCanvas" ng-class="{readOnly: isReadOnly()}">\n    <div class="addArea" ux-show="!isReadOnly()">\n        <button class="addImage addIcon" ng-click="addImage()">Add image</button>\n        <button class="addText addIcon" ng-click="addText()">Add text</button>\n    </div>\n    <div class="grid" ng-class="{overflowVisible: overflowVisible}">\n        <div banner-item ng-repeat="item in items.data" data="item" on-change="onItemChange()"\n             overflow-visible="overflowVisible" read-only="isReadOnly()"></div>\n    </div>\n</div>')}]),angular.module("bannerItem.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("bannerItem.html",'<div id="{{item.id}}" class="bannerItem" ng-class="{readOnly: readOnly}">\n    <button class="edit editIcon" ng-click="editItem()"></button>\n    <div class="item text" ux-show="item.type==\'text\'">\n        <div>{{item.value}}</div>\n    </div>\n    <img class="item image" ux-show="item.type==\'image\'" ng-src="{{item.value}}" />\n    <input type="text" class="selectHandler" />\n</div>')}]),angular.module("comment.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("comment.html",'<li class="comment cf" ng-hide="comment.deleted">\n    <img class="avatar" ng-src="{{getDownloadUrl(comment.create.author.media)}}" />\n    <div class="metaData avatarSibling">\n        <div class="header">\n            <div class="floatLeft">\n                <div class="author"><a href="#">{{comment.create.author.fullName}}</a></div>\n            </div>\n            <div class="floatRight">\n                <div class="date">{{getFormattedDate()}}</div>\n                <div rating="comment.avgRating" target-id="comment._id" target-author-id="comment.create.author._id"\n                     target-collection="comments" height="16" ux-show="showRatings()"></div>\n                <button class="toggleReply replyIcon small" ng-click="toggleReply()" i18n-title title="comments.addReply"\n                        ng-show="isLoggedUser"></button>\n                <button class="toggleEdit editIcon small" ng-click="toggleEdit()" i18n-title title="comments.edit"\n                        ng-show="isSelfActionAllowed"></button>\n                <button class="deleteComment removeIcon small" i18n-title title="comments.deleteComment"\n                        confirm-action="deleteComment()" ng-show="isSelfActionAllowed"></button>\n            </div>\n        </div>\n        <div content-editable="comment.isEditable" ng-model="comment.text" type="type"\n             on-blur="updateComment()" class="message"></div>\n        <div class="repliesWrapper"></div>\n    </div>\n</li>')}]),angular.module("comments.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("comments.html",'<div class="comments">\n    <h5 class="title" ng-hide="parentComment"><label i18n="comments"></label></h5>\n    <div ng-show="comments.length == 0 && !parentComment" class="noComments">\n        <label i18n="comments.noItems"></label>\n    </div>\n    <ul ng-show="comments.length > 0">\n        <li ng-repeat="comment in comments" comment="comment"></li>\n    </ul>\n    <div class="cf" ng-hide="hideAdd || !loggedUser">\n        <img class="avatar" ng-src="{{getUserAvatarUrl()}}" />\n        <textarea content-editable ng-model="newCommentText" class="newCommentInput avatarSibling" placeholder="{{placeholder}}"></textarea>\n        <button class="addIcon createComment floatRight" ng-click="createComment()">\n            <label i18n="{{placeholder}}"></label>\n        </button>\n    </div>\n</div>\n')}]),angular.module("contentEditable.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentEditable.html",'<div>\n    <div class="actionsArea" ng-show="isEditable() && showActions" >\n        <media-picker ng-model="newMedia" multiple="false" on-close="onClose()"></media-picker>\n    </div>\n    <div class="editableArea">\n        <div ux-keyup="onKeyup()" ng-mouseup="showEditBox()" contenteditable="{{isEditable()}}"></div>\n        <div class="placeholder" ng-show="placeholder && showPlaceholder">\n            <label i18n="{{placeholder}}"></label>\n        </div>\n        <div class="background"></div>\n    </div>\n</div>')}]),angular.module("richContent.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("richContent.html",'<div>\n    <div class="columns large-9 textAlignRight"><label i18n="richContent.color"></label></div>\n    <div class="columns large-16">\n        <input color-picker placeholder="richContent.color.placeholder" ng-model="model.color" on-change="propagateChanges()" />\n    </div>\n    <div class="columns large-9 textAlignRight"><label i18n="richContent.style"></label></div>\n    <div class="columns large-16">\n        <button toggle-style ng-model="model.fontWeight" active-when="bold" inactive-when="normal" class="boldIcon"></button>\n        <button toggle-style ng-model="model.fontStyle" active-when="italic" inactive-when="normal" class="italicIcon"></button>\n        <button toggle-style ng-model="model.textDecoration" active-when="underline" inactive-when="none" class="underlineIcon"></button>\n    </div>\n    <div class="columns large-9 textAlignRight"><label i18n="richContent.size"></label></div>\n    <div class="columns large-16">\n        <select ng-model="heading" ng-init="heading=heading||\'normal\'"\n                ng-options="obj.value as obj.text for obj in headingOptions" ng-change="setHeading()"></select>\n    </div>\n    <div class="columns large-9 textAlignRight"><label i18n="richContent.link"></label></div>\n    <div class="columns large-6">\n        <select ng-model="linkType" ng-init="linkType=linkType||\'internal\'" ng-options="obj.id as obj.text for obj in linkTypes"></select>\n    </div>\n    <div class="columns large-10">\n        <div ng-show="linkType==\'internal\'" >\n            <auto-complete ng-model="internalLink" ng-options="pagesList" label-key="text" value-key="url"\n                           ux-change="setInternalLink()" placeholder="richContent.link.placeholder"></auto-complete>\n        </div>\n        <input type="text" ng-model="externalLink" ux-blur="setExternalLink()" ng-show="linkType==\'external\'" />\n    </div>\n</div>\n')}]),angular.module("selectMedia.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("selectMedia.html",'<div>\n    <div>\n        <div class="columns large-10 textAlignRight">\n            <label i18n="selectMedia.source"></label>\n        </div>\n        <div class="columns large-15">\n            <media-picker ng-model="internalData.updatedMedia" multiple="false" on-change="onMediaChange()"></media-picker>\n        </div>\n    </div>\n    <div ng-hide="config.editSize==false">\n        <div class="columns large-10 textAlignRight">\n            <label i18n="selectMedia.size"></label>\n        </div>\n        <div class="columns large-15">\n            <select ng-model="internalData.mediaSize" ng-init="internalData.mediaSize=internalData.mediaSize||\'original\'"\n                    ng-options="obj.id as obj.text for obj in internalData.mediaSizes" ng-change="propagateChanges()"></select>\n        </div>\n    </div>\n</div>')}]),angular.module("fileUploader.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("fileUploader.html",'<form enctype="multipart/form-data" action="{{endpoint||\'media/upload/\'}}" method="post" class="fileUploader">\n    <input type="file" ng-model="files" ux-change="submit()" name="upload" multiple-files="{{multiple}}" />\n</form>')}]),angular.module("password.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("password.html",'<div>\n    <a href="#" ng-click="togglePassword()" ng-show="clickToChange">\n        <label class="change" ng-show="!changePasswordActive"><label i18n="password.change"></label></label>\n        <label class="cancelChanges" ng-show="changePasswordActive"><label i18n="password.cancelChanges"></label></label>\n    </a>\n    <input ng-show="changePasswordActive  || !clickToChange" type="password" ng-model="model" password-mandatory />\n</div>')}]),angular.module("rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("rating.html",'<ul class="rating">\n    <li ng-repeat="rating in normalizedRating" ng-click="rate($index+1)" ng-class="getStarStyleClass($index+1, rating)"\n        ng-mouseenter="hoverRate($index+1)" ng-mouseleave="clearHoverRate()">\n            <div class="star" ng-style="getStarSize()"></div>\n    </li>\n</ul>\n')}]),angular.module("contentList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contentList.html",'<div>\n    <div list-db="items" id="_id" collection="collection" config="config" template="template"\n         on-edit-panels="onEditPanels" search-targets="searchTargets" config="config"></div>\n</div>')}]),angular.module("list.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("list.html",'<div ng-class="getWrapperClass()" class="scrollable">\n    <div class="searchArea" ng-show="isSearchable() && !detailId">\n        <label i18n="list.search"></label>\n        <input type="text" ng-model="searchText" ux-keyup="executeSearch()"/>\n    </div>\n    <div ng-show="isPageActionsTop()" list-actions class="top" collection="collection"></div>\n    <div class="noItems" ng-show="items.length == 0"><i><label i18n="list.noItems"></label></i></div>\n    <div ng-show="items.length > 0" ng-hide="detailId && detailId!=item._id" id="{{item._id}}"\n         ng-repeat="item in items | filter: getFilter()" class="item columns"\n         ng-class="getItemStyleClasses(item)" ng-style="setItemHeight()">\n        <div class="selectFromCheckbox" ng-show="isMultiSelectable()">\n            <input checkbox class="white" ng-model="item.isSelected" ng-click="clickOnItem(item, $index, $event, false)"\n                   block-update-model="true" />\n        </div>\n        <div class="text" ng-click="clickOnItem(item, $index, $event, true)">\n             <div ux-transclude="template"></div>\n         </div>\n        <button class="remove removeIcon" ng-click="clickOnItem(item, $index, $event, false)" ng-show="isDeletable()"\n                title confirm-action="deleteItem(item._id)">\n            <label i18n="list.deleteItem"></label>\n        </button>\n    </div>\n    <a href="#" class="detailArea floatRight" ng-show="detailId" ng-click="deleteDetailId()">\n        &lt;&lt; <label i18n="list.goBack"></label>\n    </a>\n    <div ng-show="isPageActionsBottom()" list-actions class="bottom" collection="collection"></div>\n</div>\n')}]),angular.module("listDb.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("listDb.html",'<div>\n    <div list="items" collection="collection" id="_id" config="config" projection="projection"\n         transcluded-data="transcludedData" on-search="onSearch($text)" on-select="selectItem($item)"\n         on-create="createItem($item)" on-delete="deleteItem($id)" internal-data="internalData"\n         current-page="currentPage" db-source="true" template="template"\n         on-create-panels="onCreatePanels" on-edit-panels="onEditPanels"></div>\n</div>')}]),angular.module("mediaList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaList.html",'<div>\n    <file-uploader ux-show="config.uploadable" on-upload="onUpload()" multiple="true"></file-uploader>\n    <div list-db="items" collection="collection" config="config" projection="projection"\n         template="template" on-edit-panels="onEditPanels" search-targets="searchTargets"\n         transcluded-data="transcludedData" on-select="selectItem($item)">\n    </div>\n</div>')}]),angular.module("tagList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("tagList.html",'<div>\n    <div list-db="items" collection="collection" config="config" on-edit-panels="onEditPanels"\n         search-targets="searchTargets">\n        <h3><a href="#">{{item.text}}</a></h3>\n    </div>\n</div>')}]),angular.module("userList.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userList.html",'<div class="userList">\n    <div list="userList" collection="collection" config="config" transcluded-data="transcludedData"\n         template="template" internal-data="internalData" on-edit-panels="onEditPanels"\n         on-create="onCreate($item)" on-delete="onDelete($id)"></div>\n</div>')}]),angular.module("login.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("login.html",'<div>\n    <div ng-show="userSession">\n        Hello, {{userSession.fullName}}. [<a href="#" ng-click="logout()">Logout</a>]\n    </div>\n    <form class="login cf" action="rest/login" method="POST" ng-show="!userSession">\n        <div class="user columns large-12">\n            <div class="label columns large-8 textAlignRight">E-mail:</div><div class="field columns large-16">\n            <input type="text" name="email" ng-model="email" />\n        </div>\n        </div>\n        <div class="password columns large-11">\n            <div class="label columns large-8 textAlignRight">Password:</div><div class="field columns large-16">\n            <input type="password" name="password" ng-model="password" />\n        </div>\n        </div>\n        <!--<div class="remember rows">\n            <input checkbox ng-model="remember" label="Remember" />\n        </div>-->\n        <div class="submit columns large-2">\n            <button type="submit" class="okIcon floatRight"></button>\n        </div>\n    </form>\n</div>')
}]),angular.module("mediaPicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mediaPicker.html",'<div class="mediaPicker">\n    <button class="mediaIcon" ng-click="selectFromMediaList()">\n        <label i18n="fileUploader.selectFromMediaList"></label>\n    </button>\n    <img class="current" ng-src="{{getDownloadUrl(model)}}" ng-show="preview==\'true\'" title="{{getFileTitle(model)}}" />\n    <button class="removeIcon small" ng-click="deleteSelection()" ng-show="model._id">\n        <label i18n="fileUploader.deleteSelection"></label>\n    </button>\n</div>')}]),angular.module("pages.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("pages.html",'<ul class="pages" ng-style="setPagesStyles()" ng-class="getCurrentUserAdminAccessStyleClass()">\n    <li ng-repeat="row in portal.template.rows" class="rows">\n        <ul>\n            <li ng-repeat="column in row.columns" resizable-app="{{isAppResizeAllowed()}}" class="columns large-{{column.size}}"\n                ng-class="{template: column.apps}">\n                <ul ux-show="column.apps" sortable-app="{{isAppSortAllowed()}}" ui-sortable="sortableOptions"\n                    ng-model="column.apps" class="appContainer">\n                    <li app="app.id" ng-repeat="app in column.apps" model="app.model" type="app.type" template-app="true" width="column.size"></li>\n                </ul>\n                <ul ux-show="column.rows">\n                    <li ng-repeat="row in column.rows" class="rows">\n                        <ul>\n                            <li ng-repeat="column in row.columns" resizable-app="{{isAppResizeAllowed()}}" class="columns large-{{column.size}} page" >\n                                <ul sortable-app="{{isAppSortAllowed()}}" ui-sortable="sortableOptions" ng-model="column.apps" class="appContainer">\n                                    <li app="app.id" ng-repeat="app in column.apps" model="app.model" type="app.type" template-app="false" width="column.size"></li>\n                                </ul>\n                            </li>\n                        </ul>\n                    </li>\n                </ul>\n            </li>\n        </ul>\n    </li>\n</ul>')}]),angular.module("errorPage.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("errorPage.html",'<div class="errorPage">\n    <div class="container">\n        <div class="inner">\n            <div class="cf">\n                <img class="columns large-8" src="/client/images/error.png"/>\n                <div class="text columns large-17">\n                    <h2 class="title" ng-bind="errorTitle"></h2>\n                    <button class="addIcon" ng-click="goToPortalHome()" ng-show="showPortalHomeButton">\n                        <label i18n="errorPage.goToPortalHome"></label>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("loginPage.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("loginPage.html",'<div global-msg></div>\n<div class="loginPage">\n    <img src="/client/images/logo.svg"/>\n    <login></login>\n</div>\n\n')}]),angular.module("portalPage.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portalPage.html",'Hello Cloud!\n<div global-msg></div>\n<admin-panel ux-show="isAdmin()"></admin-panel>\n<pages></pages>')}]),angular.module("listActions.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("listActions.html",'<div class="cf">\n    <div class="leftActions floatLeft" ng-show="isMultiSelectable() && items.length">\n        <button class="okIcon" ng-click="toggleSelectAll()"><label i18n="list.selectItems"></label></button>\n        <label ng-show="selectedIds.length">{{selectedIds.length}} <label i18n="list.selectedItems"></label></label>\n        <button class="removeIcon" ng-click="deleteSelected()" ng-show="selectedIds.length && isDeletable()">\n            <label i18n="list.deleteSelected"></label>\n        </button>\n    </div>\n    <div class="leftActions floatLeft" ng-show="isCreatable()">\n        <button create-item-button class="addIcon" ng-click="createItem()" collection="collection"\n                on-create="createItem($item)" on-create-panels="onCreatePanels">\n            <label i18n="list.createItem"></label>\n        </button>\n    </div>\n    <div class="rightActions floatRight getPage" ng-show="showPrevPageLink()||showNextPageLink()">\n        <button class="getPrevPage" ng-click="getPrevPage()" ng-show="showPrevPageLink()">&lt;</button>\n        <button class="getNextPage" ng-click="getNextPage()" ng-show="showNextPageLink()">&gt;</button>\n    </div>\n</div>')}]),angular.module("listEdit.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("listEdit.html",'<div>\n\n    <div class="columns large-12">\n        <div class="columns large-25"><input checkbox ng-model="model.searchable" label="Enable search"/></div>\n    </div>\n\n    <div class="columns large-12">\n        <div class="columns large-13 textAlignRight">Page size:</div>\n        <div class="columns large-12"><input type="text" ng-model="model.pageSize" /></div>\n    </div>\n\n    <div class="columns large-12">\n        <div class="columns large-13 textAlignRight">Skip:</div>\n        <div class="columns large-12"><input type="text" ng-model="model.skip" /></div>\n    </div>\n\n    <div class="columns large-12">\n        <div class="columns large-13 textAlignRight">Sort field:</div>\n        <div class="columns large-12">\n            <select ng-model="model.sort.field" ng-options="obj.id as obj.text for obj in sortTypes.field"></select>\n        </div>\n    </div>\n\n    <div class="columns large-12">\n        <div class="columns large-13 textAlignRight">Sort order:</div>\n        <div class="columns large-12">\n            <select ng-model="model.sort.order" ng-options="obj.id as obj.text for obj in sortTypes.order"></select>\n        </div>\n    </div>\n\n    <label>\n        Pagination position:\n        <select ng-model="model.pageActionPos" >\n            <option value="0">Top</option>\n            <option value="1">bottom</option>\n            <option value="2">topAndBottom</option>\n        </select>\n    </label>\n\n    Filter:\n    <auto-complete ng-model="model.tags" ng-options="availableTags" label-key="text"\n                   placeholder="Select tags to filter" multiple="true"></auto-complete>\n\n    <div class="columns large-12">\n        <div class="columns large-13 textAlignRight">Columns:</div>\n        <div class="columns large-12">\n            <select ng-model="model.columns" ng-options="obj.value as obj.text for obj in columnOptions"></select>\n        </div>\n    </div>\n</div>')}]);